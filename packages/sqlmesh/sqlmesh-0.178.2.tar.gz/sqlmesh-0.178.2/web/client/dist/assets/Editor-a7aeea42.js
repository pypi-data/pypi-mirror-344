import{r as u,R as ne,h as ke,j as t,c as b,i as I,w as Q,g as lt,b as M,a as D,n as E,J as de,B as z,m as F,am as nt,I as ae,S as Ne,Q as Pe,a6 as Qe,a7 as rt,a8 as at,an as qe,_ as ot,d as Ve,t as it,e as ct,s as dt,G as $,F as ut,a9 as ft,ao as mt}from"./index-cbd2ced8.js";import{u as ee,M as xt}from"./project-edea2745.js";import{S as Be}from"./SplitPane-1c997d05.js";import{E as J,M as ht}from"./file-f7b22a8f.js";import{u as N}from"./editor-75015442.js";import{I as T}from"./Input-87ebe65e.js";import{X as pt,L as gt}from"./ListboxShow-1eae146d.js";import{B as We}from"./Banner-42281a9e.js";import{f as bt,b as Ye,c as vt,j as Ge,U as ue,R as ge,y as fe,o as K,i as je,C as me,I as Ze,T as jt,u as ce,P as ie,N as be,G as wt,z as B,O as le,M as W,t as Nt}from"./transition-23195d83.js";import{g as Me,G as yt,F as Tt,T as Et}from"./help-5bb5648e.js";import{M as Pt,u as Xe,a as De,b as St,c as Ct,C as It}from"./context-fc6e9b66.js";import{A as Se,M as kt,P as Dt}from"./PlusCircleIcon-ce877688.js";import{D as Rt}from"./ReportErrors-09cd1229.js";import"./index-3717ba7a.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./help-68063aae.js";import"./SourceList-2f9d9c08.js";function Mt({onFocus:e}){let[s,l]=u.useState(!0),n=bt();return s?ne.createElement(Ye,{as:"button",type:"button",features:vt.Focusable,onFocus:i=>{i.preventDefault();let r,c=50;function d(){if(c--<=0){r&&cancelAnimationFrame(r);return}if(e()){if(cancelAnimationFrame(r),!n.current)return;l(!1);return}r=requestAnimationFrame(d)}r=requestAnimationFrame(d)}}):null}const Je=u.createContext(null);function _t(){return{groups:new Map,get(e,s){var l;let n=this.groups.get(e);n||(n=new Map,this.groups.set(e,n));let i=(l=n.get(s))!=null?l:0;n.set(s,i+1);let r=Array.from(n.keys()).indexOf(s);function c(){let d=n.get(s);d>1?n.set(s,d-1):n.delete(s)}return[r,c]}}}function Lt({children:e}){let s=u.useRef(_t());return u.createElement(Je.Provider,{value:s},e)}function Ke(e){let s=u.useContext(Je);if(!s)throw new Error("You must wrap your component in a <StableCollection>");let l=Ft(),[n,i]=s.current.get(e,l);return u.useEffect(()=>i,[]),n}function Ft(){var e,s,l;let n=(l=(s=(e=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED)==null?void 0:e.ReactCurrentOwner)==null?void 0:s.current)!=null?l:null;if(!n)return Symbol();let i=[],r=n;for(;r;)i.push(r.index),r=r.return;return"$."+i.join(".")}var At=(e=>(e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards",e))(At||{}),zt=(e=>(e[e.Less=-1]="Less",e[e.Equal=0]="Equal",e[e.Greater=1]="Greater",e))(zt||{}),Ot=(e=>(e[e.SetSelectedIndex=0]="SetSelectedIndex",e[e.RegisterTab=1]="RegisterTab",e[e.UnregisterTab=2]="UnregisterTab",e[e.RegisterPanel=3]="RegisterPanel",e[e.UnregisterPanel=4]="UnregisterPanel",e))(Ot||{});let $t={0(e,s){var l;let n=ie(e.tabs,f=>f.current),i=ie(e.panels,f=>f.current),r=n.filter(f=>{var g;return!((g=f.current)!=null&&g.hasAttribute("disabled"))}),c={...e,tabs:n,panels:i};if(s.index<0||s.index>n.length-1){let f=ce(Math.sign(s.index-e.selectedIndex),{[-1]:()=>1,0:()=>ce(Math.sign(s.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(r.length===0)return c;let g=ce(f,{0:()=>n.indexOf(r[0]),1:()=>n.indexOf(r[r.length-1])});return{...c,selectedIndex:g===-1?e.selectedIndex:g}}let d=n.slice(0,s.index),p=[...n.slice(s.index),...d].find(f=>r.includes(f));if(!p)return c;let a=(l=n.indexOf(p))!=null?l:e.selectedIndex;return a===-1&&(a=e.selectedIndex),{...c,selectedIndex:a}},1(e,s){if(e.tabs.includes(s.tab))return e;let l=e.tabs[e.selectedIndex],n=ie([...e.tabs,s.tab],r=>r.current),i=e.selectedIndex;return e.info.current.isControlled||(i=n.indexOf(l),i===-1&&(i=e.selectedIndex)),{...e,tabs:n,selectedIndex:i}},2(e,s){return{...e,tabs:e.tabs.filter(l=>l!==s.tab)}},3(e,s){return e.panels.includes(s.panel)?e:{...e,panels:ie([...e.panels,s.panel],l=>l.current)}},4(e,s){return{...e,panels:e.panels.filter(l=>l!==s.panel)}}},_e=u.createContext(null);_e.displayName="TabsDataContext";function re(e){let s=u.useContext(_e);if(s===null){let l=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,re),l}return s}let Le=u.createContext(null);Le.displayName="TabsActionsContext";function Fe(e){let s=u.useContext(Le);if(s===null){let l=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,Fe),l}return s}function Qt(e,s){return ce(s.type,$t,e,s)}let Bt=u.Fragment;function Wt(e,s){let{defaultIndex:l=0,vertical:n=!1,manual:i=!1,onChange:r,selectedIndex:c=null,...d}=e;const p=n?"vertical":"horizontal",a=i?"manual":"auto";let f=c!==null,g=ge({isControlled:f}),P=fe(s),[m,v]=u.useReducer(Qt,{info:g,selectedIndex:c??l,tabs:[],panels:[]}),R=u.useMemo(()=>({selectedIndex:m.selectedIndex}),[m.selectedIndex]),j=ge(r||(()=>{})),o=ge(m.tabs),y=u.useMemo(()=>({orientation:p,activation:a,...m}),[p,a,m]),x=K(C=>(v({type:1,tab:C}),()=>v({type:2,tab:C}))),S=K(C=>(v({type:3,panel:C}),()=>v({type:4,panel:C}))),q=K(C=>{Z.current!==C&&j.current(C),f||v({type:0,index:C})}),Z=ge(f?e.selectedIndex:m.selectedIndex),X=u.useMemo(()=>({registerTab:x,registerPanel:S,change:q}),[]);je(()=>{v({type:0,index:c??l})},[c]),je(()=>{if(Z.current===void 0||m.tabs.length<=0)return;let C=ie(m.tabs,w=>w.current);C.some((w,_)=>m.tabs[_]!==w)&&q(C.indexOf(m.tabs[Z.current]))});let te={ref:P};return ne.createElement(Lt,null,ne.createElement(Le.Provider,{value:X},ne.createElement(_e.Provider,{value:y},y.tabs.length<=0&&ne.createElement(Mt,{onFocus:()=>{var C,w;for(let _ of o.current)if(((C=_.current)==null?void 0:C.tabIndex)===0)return(w=_.current)==null||w.focus(),!0;return!1}}),me({ourProps:te,theirProps:d,slot:R,defaultTag:Bt,name:"Tabs"}))))}let Gt="div";function Ht(e,s){let{orientation:l,selectedIndex:n}=re("Tab.List"),i=fe(s);return me({ourProps:{ref:i,role:"tablist","aria-orientation":l},theirProps:e,slot:{selectedIndex:n},defaultTag:Gt,name:"Tabs.List"})}let Ut="button";function qt(e,s){var l,n;let i=Ze(),{id:r=`headlessui-tabs-tab-${i}`,...c}=e,{orientation:d,activation:p,selectedIndex:a,tabs:f,panels:g}=re("Tab"),P=Fe("Tab"),m=re("Tab"),v=u.useRef(null),R=fe(v,s);je(()=>P.registerTab(v),[P,v]);let j=Ke("tabs"),o=f.indexOf(v);o===-1&&(o=j);let y=o===a,x=K(w=>{var _;let se=w();if(se===be.Success&&p==="auto"){let Ee=(_=wt(v))==null?void 0:_.activeElement,oe=m.tabs.findIndex(pe=>pe.current===Ee);oe!==-1&&P.change(oe)}return se}),S=K(w=>{let _=f.map(se=>se.current).filter(Boolean);if(w.key===B.Space||w.key===B.Enter){w.preventDefault(),w.stopPropagation(),P.change(o);return}switch(w.key){case B.Home:case B.PageUp:return w.preventDefault(),w.stopPropagation(),x(()=>le(_,W.First));case B.End:case B.PageDown:return w.preventDefault(),w.stopPropagation(),x(()=>le(_,W.Last))}if(x(()=>ce(d,{vertical(){return w.key===B.ArrowUp?le(_,W.Previous|W.WrapAround):w.key===B.ArrowDown?le(_,W.Next|W.WrapAround):be.Error},horizontal(){return w.key===B.ArrowLeft?le(_,W.Previous|W.WrapAround):w.key===B.ArrowRight?le(_,W.Next|W.WrapAround):be.Error}}))===be.Success)return w.preventDefault()}),q=u.useRef(!1),Z=K(()=>{var w;q.current||(q.current=!0,(w=v.current)==null||w.focus({preventScroll:!0}),P.change(o),Nt(()=>{q.current=!1}))}),X=K(w=>{w.preventDefault()}),te=u.useMemo(()=>{var w;return{selected:y,disabled:(w=e.disabled)!=null?w:!1}},[y,e.disabled]),C={ref:R,onKeyDown:S,onMouseDown:X,onClick:Z,id:r,role:"tab",type:jt(e,v),"aria-controls":(n=(l=g[o])==null?void 0:l.current)==null?void 0:n.id,"aria-selected":y,tabIndex:y?0:-1};return me({ourProps:C,theirProps:c,slot:te,defaultTag:Ut,name:"Tabs.Tab"})}let Vt="div";function Yt(e,s){let{selectedIndex:l}=re("Tab.Panels"),n=fe(s),i=u.useMemo(()=>({selectedIndex:l}),[l]);return me({ourProps:{ref:n},theirProps:e,slot:i,defaultTag:Vt,name:"Tabs.Panels"})}let Zt="div",Xt=Ge.RenderStrategy|Ge.Static;function Jt(e,s){var l,n,i,r;let c=Ze(),{id:d=`headlessui-tabs-panel-${c}`,tabIndex:p=0,...a}=e,{selectedIndex:f,tabs:g,panels:P}=re("Tab.Panel"),m=Fe("Tab.Panel"),v=u.useRef(null),R=fe(v,s);je(()=>m.registerPanel(v),[m,v,d]);let j=Ke("panels"),o=P.indexOf(v);o===-1&&(o=j);let y=o===f,x=u.useMemo(()=>({selected:y}),[y]),S={ref:R,id:d,role:"tabpanel","aria-labelledby":(n=(l=g[o])==null?void 0:l.current)==null?void 0:n.id,tabIndex:y?p:-1};return!y&&((i=a.unmount)==null||i)&&!((r=a.static)!=null&&r)?ne.createElement(Ye,{as:"span","aria-hidden":"true",...S}):me({ourProps:S,theirProps:a,slot:x,defaultTag:Zt,features:Xt,visible:y,name:"Tabs.Panel"})}let Kt=ue(qt),es=ue(Wt),ts=ue(Ht),ss=ue(Yt),ls=ue(Jt),k=Object.assign(Kt,{Group:es,List:ts,Panels:ss,Panel:ls});function ns({title:e,titleId:s,...l},n){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},l),e?u.createElement("title",{id:s},e):null,u.createElement("path",{fillRule:"evenodd",d:"M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z",clipRule:"evenodd"}))}const rs=u.forwardRef(ns),et=rs;function as({title:e,titleId:s,...l},n){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},l),e?u.createElement("title",{id:s},e):null,u.createElement("path",{fillRule:"evenodd",d:"M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z",clipRule:"evenodd"}))}const os=u.forwardRef(as),is=os;function cs({title:e,titleId:s,...l},n){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},l),e?u.createElement("title",{id:s},e):null,u.createElement("path",{d:"M15 3.75H9v16.5h6V3.75ZM16.5 20.25h3.375c1.035 0 1.875-.84 1.875-1.875V5.625c0-1.036-.84-1.875-1.875-1.875H16.5v16.5ZM4.125 3.75H7.5v16.5H4.125a1.875 1.875 0 0 1-1.875-1.875V5.625c0-1.036.84-1.875 1.875-1.875Z"}))}const ds=u.forwardRef(cs),us=ds;function fs(e){switch(e){case J.SQL:return"SQL";case J.PY:return"Python";case J.YAML:case J.YML:return"YAML";default:return"Plain Text"}}function ms(e,s){return e.file.extension===J.SQL&&e.file.isLocal&&ke(s)}const A=function({text:s,children:l,className:n}){return t.jsxs("small",{className:b("font-bold whitespace-nowrap text-xs",n),children:[I(s)&&t.jsxs("span",{children:[s,": "]}),l]})};function xs({text:e,className:s}){return t.jsx("span",{className:b("font-normal",s),children:e})}function hs({ok:e,className:s}){return t.jsx("span",{className:b("inline-block w-2 h-2 rounded-full",Q(e)&&"bg-warning-500",lt(e)&&"bg-success-500",M(e)&&"bg-danger-500",s)})}A.Text=xs;A.Light=hs;const O={Model:"model",Test:"test",Audit:"audit",Macro:"macro",Hook:"hook",Log:"log",Config:"config",Seed:"seed",Metric:"metric",Schema:"schema",Unknown:"unknown"};function ps({tab:e}){const s=D(c=>c.isModel),l=N(c=>c.engine),n=N(c=>c.dialects),i=N(c=>c.refreshTab);u.useEffect(()=>{var d;const c=(d=n[0])==null?void 0:d.dialect_name;Q(e.dialect)&&I(c)&&r(c)},[n,e]);function r(c){e.dialect=c,i(e),l.postMessage({topic:"dialect",payload:e.dialect})}return t.jsxs("div",{className:"flex w-full items-center px-2 min-h-[2rem] overflow-hidden",children:[e.file.isRemote&&t.jsx(A,{className:"mr-2",text:"Saved",children:t.jsx(A.Light,{ok:M(e.file.isChanged)})}),e.file.isRemote&&e.file.isSQL&&t.jsx(A,{className:"mr-2",text:"Formatted",children:t.jsx(A.Light,{ok:e.file.isFormatted})}),t.jsx(A,{className:"mr-2",text:"Language",children:t.jsx(A.Text,{text:fs(e.file.extension)})}),ms(e,n)&&t.jsx(A,{className:"mr-2",text:"Dialect",children:t.jsx(T,{size:E.sm,children:({className:c,size:d})=>t.jsx(T.Selector,{className:c,size:d,list:n.map(p=>({text:p.dialect_title,value:de(p.dialect_name)?"sqlglot":p.dialect_name})),onChange:r,value:e.dialect})})}),s(e.file.path)&&!de(e.dialect)&&t.jsx(A,{className:"mr-2",text:"Dialect",children:t.jsx(A.Text,{text:e.dialect})}),t.jsx(A,{className:"mr-2",text:"SQLMesh Type",children:t.jsx(A.Text,{text:gs(e.file.path)})})]})}function gs(e){return de(e)?O.Unknown:e.startsWith("models")?O.Model:e.startsWith("tests")?O.Test:e.startsWith("logs")?O.Log:e.startsWith("macros")?O.Macro:e.startsWith("hooks")?O.Hook:e.startsWith("seeds")?O.Seed:e.startsWith("metrics")?O.Metric:["config.yaml","config.yml","config.py"].includes(e)?O.Config:["external_models.yaml","schema.yaml"].includes(e)?O.Schema:O.Unknown}function He({tab:e,title:s}){const l=u.useRef(null),n=D(g=>g.addConfirmation),i=ee(g=>g.setSelectedFile),r=N(g=>g.closeTab),c=N(g=>g.tab),d=e.file.id===(c==null?void 0:c.file.id);return u.useEffect(()=>{Q(e)||(e.el=l.current??void 0)},[l,e]),u.useEffect(()=>{Q(c)||setTimeout(()=>{var g;(g=c.el)==null||g.scrollIntoView({behavior:"smooth",inline:"center"})},300)},[c]),t.jsx("li",{ref:l,className:b("inline-block py-1 pr-2 last-child:pr-0 overflow-hidden text-center overflow-ellipsis cursor-pointer"),onClick:p,children:t.jsxs("span",{className:b("flex border-2 justify-between items-center pl-1 pr-1 py-[0.125rem] min-w-[8rem] rounded-md group border-transparent border-r border-r-theme-darker dark:border-r-theme-lighter",d?"bg-neutral-200 border-neutral-200 text-neutral-900 dark:bg-dark-lighter dark:border-dark-lighter dark:text-primary-500":"bg-trasparent hover:bg-theme-darker dark:hover:bg-theme-lighter"),children:[t.jsx("small",{className:"text-xs",children:s}),t.jsx("small",{className:b("group-hover:hidden text-xs inline-block ml-3 mr-1 w-2 h-2 rounded-full",e.file.isChanged?"bg-warning-500":"bg-transparent")}),t.jsx(pt,{className:"hidden group-hover:inline-block text-neutral-600 dark:text-neutral-100 w-4 h-4 ml-2 mr-0 cursor-pointer",onClick:a})]})});function p(g){g.stopPropagation(),i(e.file)}function a(g){g.stopPropagation(),f()}function f(){e.file.isChanged?n({headline:"Closing Tab",description:"All unsaved changes will be lost. Do you want to close the tab anyway?",yesText:"Yes, Close Tab",noText:"No, Cancel",action:()=>r(e.file)}):r(e.file)}}function bs(){const e=D(o=>o.modules),s=D(o=>o.models),l=D(o=>o.lastSelectedModel),n=D(o=>o.setLastSelectedModel),i=ee(o=>o.files),r=ee(o=>o.selectedFile),c=ee(o=>o.setSelectedFile),d=N(o=>o.tab),p=N(o=>o.tabs),a=N(o=>o.replaceTab),f=N(o=>o.createTab),g=N(o=>o.selectTab),P=N(o=>o.addTab),[m,v]=u.useMemo(()=>{const o=[],y=[];return p.forEach(x=>{x.file.isLocal&&o.push(x),x.file.isRemote&&y.push(x)}),[o,y]},[p]);return u.useEffect(()=>{if(Q(r)||(d==null?void 0:d.file)===r||r instanceof xt||M(e.hasFiles))return;n(s.get(r.path));const o=f(r);I(d)&&d.file instanceof ht&&M(d.file.isChanged)&&d.file.isRemote&&M(p.has(r))?a(d,o):P(o),g(o)},[r,e]),u.useEffect(()=>{if(Q(l))return;const o=i.get(l.path);Q(o)||c(o)},[l]),t.jsxs("div",{className:"flex items-center bg-neutral-5",children:[t.jsx(z,{className:"h-6 m-0 ml-1 mr-2 border-none",variant:F.Alternative,size:E.sm,onClick:R,children:t.jsx(is,{className:"inline-block w-3 h-4"})}),t.jsxs("ul",{className:"w-full whitespace-nowrap min-h-[2rem] max-h-[2rem] overflow-hidden overflow-x-auto hover:scrollbar scrollbar--horizontal",children:[m.map((o,y)=>t.jsx(He,{tab:o,title:`Custom SQL ${y+1}`},o.id)),v.map(o=>t.jsx(He,{tab:o,title:o.file.name},o.id))]})]});function R(o){o.stopPropagation(),j()}function j(){const o=f();P(o),g(o),c(o.file)}}function Ae({list:e,children:s=[],className:l,disabled:n=!1}){return t.jsxs(k.List,{className:b("w-full whitespace-nowrap px-2 flex justify-center items-center",n&&"cursor-not-allowed"),children:[t.jsx("div",{className:b("flex w-full overflow-hidden overflow-x-auto py-1 hover:scrollbar scrollbar--horizontal",l,n&&"opacity-50 pointer-events-none"),children:t.jsx("div",{className:"flex p-1 items-center bg-secondary-10 dark:bg-primary-10 cursor-pointer rounded-full overflow-hidden",children:e.map(i=>t.jsx(k,{className:({selected:r})=>b("text-xs px-2 py-0.5 mr-2 last:mr-0 rounded-full relative align-middle",r?"bg-secondary-500 text-secondary-100 cursor-default font-bold":"cursor-pointer font-medium text-secondary-400 dark:text-secondary-400"),children:i},i))})}),s]})}const Ue=24*60*60*1e3,vs=1e3,we=50;function js({tab:e,isOpen:s=!0,toggle:l}){const n=D(c=>c.models),i=D(c=>c.isModel),r=u.useMemo(()=>n.get(e.file.path),[e,n]);return t.jsx("div",{className:b("flex flex-col w-full h-full items-center overflow-hidden"),children:i(e.file.path)?I(r)&&t.jsx(ws,{tab:e,model:r,isOpen:s,toggle:l}):t.jsx(Ns,{tab:e,isOpen:s,toggle:l})})}function ws({tab:e,model:s,isOpen:l=!0,toggle:n}){const i=D(d=>d.environment),r=D(d=>d.environments),c=Array.from(r).filter(({isRemote:d})=>d).map(({name:d})=>({text:d,value:d}));return t.jsxs(k.Group,{children:[t.jsxs("div",{className:"flex w-full items-center",children:[t.jsx(z,{className:b("h-6 w-6 !px-0 border-none bg-neutral-10 dark:bg-neutral-20",l?"text-secondary-500 dark:text-secondary-300":"text-neutral-500 dark:text-neutral-300"),variant:F.Info,size:E.sm,onClick:d=>{d.stopPropagation(),n==null||n()},children:t.jsx(et,{className:"w-4 h-4"})}),l&&t.jsx(Ae,{className:"flex justify-center items-center",list:["Evaluate","Columns",c.length>1&&i.isRemote&&"Diff"].filter(Boolean)})]}),l&&t.jsxs(k.Panels,{className:"h-full w-full overflow-hidden",children:[t.jsx(k.Panel,{unmount:!1,className:b("flex flex-col w-full h-full relative overflow-hidden","ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:t.jsx(Es,{model:s})}),t.jsx(k.Panel,{unmount:!1,className:"text-xs w-full h-full ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2 px-2",children:t.jsx(Pt,{nodeId:s.fqn,columns:s.columns,disabled:M(s.isModelSQL),withHandles:!1,withSource:!1,withDescription:!0,limit:10})}),c.length>1&&i.isRemote&&t.jsx(k.Panel,{unmount:!1,className:b("flex flex-col w-full h-full relative overflow-hidden","ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:t.jsx(Ps,{tab:e,model:s,list:c.filter(({value:d})=>i.name!==d),target:{text:i.name,value:i.name}})})]})]})}function Ns({tab:e,isOpen:s=!0,toggle:l}){return t.jsxs(k.Group,{children:[t.jsxs("div",{className:"flex w-full items-center",children:[t.jsx(z,{className:b("h-6 w-6 !px-0 border-none bg-neutral-10 dark:bg-neutral-20",s?"text-secondary-500 dark:text-secondary-300":"text-neutral-500 dark:text-neutral-300"),variant:F.Info,size:E.sm,onClick:n=>{n.stopPropagation(),l==null||l()},children:t.jsx(et,{className:"w-4 h-4"})}),s&&t.jsx(Ae,{className:"flex justify-center items-center",list:["Run Query","Diff"]})]}),s&&t.jsxs(k.Panels,{className:"h-full w-full overflow-hidden",children:[t.jsx(k.Panel,{unmount:!1,className:b("flex flex-col w-full h-full relative overflow-hidden","ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:t.jsx(Ts,{tab:e})}),t.jsx(k.Panel,{unmount:!1,className:b("flex flex-col w-full h-full relative overflow-hidden","ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:t.jsx(Ss,{})})]})]})}function ys({children:e}){return t.jsx("fieldset",{className:"flex my-3",children:e})}function ye({children:e}){return t.jsx("div",{className:"flex w-full h-full py-1 overflow-hidden overflow-y-auto hover:scrollbar scrollbar--vertical",children:e})}function Te({children:e}){return t.jsx("div",{className:"flex w-full py-1 px-1 justify-end",children:e})}function Ts({tab:e}){const s=N(p=>p.setPreviewQuery),l=N(p=>p.setPreviewTable),n=N(p=>p.engine),{refetch:i,isFetching:r,cancel:c}=nt({sql:e.file.content});u.useEffect(()=>()=>{c()},[]);function d(){l(void 0),s(e.file.content),i().then(({data:p})=>{l(Me(p))})}return t.jsxs(t.Fragment,{children:[t.jsx(ye,{}),t.jsx(ae,{}),t.jsxs(Te,{children:[t.jsx(z,{size:E.sm,variant:F.Alternative,onClick:p=>{p.stopPropagation(),n.postMessage({topic:"format",payload:{sql:e.file.content,dialect:e.dialect}})},children:"Format"}),r?t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ne,{className:"w-3"}),t.jsx("small",{className:"text-xs text-neutral-400 block mx-2",children:"Running Query..."}),t.jsx(z,{size:E.sm,variant:F.Danger,onClick:p=>{p.stopPropagation(),c()},children:"Cancel"})]}):t.jsx(z,{size:E.sm,variant:F.Alternative,disabled:r,onClick:p=>{p.stopPropagation(),d()},children:"Run Query"})]})]})}function Es({model:e}){const s=D(m=>m.environment),l=D(m=>m.isModel),n=N(m=>m.setPreviewQuery),i=N(m=>m.setPreviewTable),[r,c]=u.useState({model:e.displayName,start:Pe(Qe(Date.now()-Ue)),end:Pe(new Date),execution_time:Pe(Qe(Date.now()-Ue)),limit:1e3}),{refetch:d}=rt({model:r.model,start:r.start,end:r.end,execution_time:r.execution_time,dialect:e.dialect,pretty:!0}),{refetch:p,isFetching:a,cancel:f}=at(r),g=l(e.path)&&Object.values(r).every(Boolean);u.useEffect(()=>()=>{f()},[]);function P(){n(void 0),i(void 0),d().then(({data:m})=>{n(m==null?void 0:m.sql)}),p().then(({data:m})=>{i(Me(m))})}return t.jsxs(t.Fragment,{children:[t.jsx(ye,{children:t.jsxs("form",{className:"w-full",children:[M(g)&&t.jsx(ys,{children:t.jsx(We,{variant:F.Warning,children:t.jsxs(We.Description,{className:"w-full mr-2 text-sm",children:["Please fill out all fields to ",t.jsx("b",{children:"evaluate the model"}),"."]})})}),t.jsxs("fieldset",{className:"px-2 w-full text-neutral-500",children:[t.jsx(T,{className:"w-full mx-0",label:"Start Date",size:E.sm,children:({className:m})=>t.jsx(T.Textfield,{className:b(m,"w-full"),placeholder:"02/11/2023",value:r.start,onInput:v=>{v.stopPropagation(),c({...r,start:v.target.value??""})}})}),t.jsx(T,{className:"w-full mx-0",label:"End Date",size:E.sm,children:({className:m})=>t.jsx(T.Textfield,{className:b(m,"w-full"),placeholder:"02/13/2023",value:r.end,onInput:v=>{v.stopPropagation(),c({...r,end:v.target.value??""})}})}),t.jsx(T,{className:"w-full mx-0",label:"Execution Time",size:E.sm,children:({className:m})=>t.jsx(T.Textfield,{className:b(m,"w-full"),placeholder:"02/13/2023",value:r.execution_time,onInput:v=>{v.stopPropagation(),c({...r,execution_time:v.target.value??""})}})}),I(r.limit)&&t.jsx(T,{className:"w-full mx-0",label:"Limit",size:E.sm,children:({className:m})=>t.jsx(T.Textfield,{className:b(m,"w-full"),type:"number",placeholder:"1000",value:r.limit,onInput:v=>{v.stopPropagation(),c({...r,limit:v.target.valueAsNumber??vs})}})})]})]})}),t.jsx(ae,{}),t.jsx(Te,{children:t.jsx("div",{className:"flex w-full justify-end",children:l(e.path)&&a?t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ne,{className:"w-3"}),t.jsx("small",{className:"text-xs text-neutral-400 block mx-2",children:"Evaluating..."}),t.jsx(z,{size:E.sm,variant:F.Danger,onClick:m=>{m.stopPropagation(),f()},children:"Cancel"})]}):t.jsx(z,{size:E.sm,variant:F.Alternative,disabled:M(g)||a||s.isInitialProd,onClick:m=>{m.stopPropagation(),P()},children:"Evaluate"})})})]})}function Ps({tab:e,model:s,list:l,target:n}){const i=D(x=>x.isModel),r=N(x=>x.setPreviewDiff),[c,d]=u.useState(l[0].value),[p,a]=u.useState(we),[f,g]=u.useState(""),[P,m]=u.useState(""),{refetch:v,isFetching:R,cancel:j}=qe({source:c,target:n.value,model_or_snapshot:s.name,limit:p,on:f,where:P}),o=u.useCallback(()=>{r(void 0),v().then(({data:x})=>{r(x)})},[s.name,s.hash]);u.useEffect(()=>()=>{j()},[]),u.useEffect(()=>{d(l[0].value)},[l]);const y=i(e.file.path)&&[c,n,p].every(Boolean);return t.jsxs(t.Fragment,{children:[t.jsx(ye,{children:t.jsx("form",{className:"w-full",children:t.jsxs("fieldset",{className:"px-2 w-full text-neutral-500",children:[t.jsx(T,{className:"w-full mx-0",label:"Source",disabled:l.length<2,size:E.sm,children:({disabled:x,className:S})=>t.jsx(T.Selector,{className:b(S,"w-full"),list:l,value:c,disabled:x,onChange:d})}),t.jsx(T,{className:"w-full mx-0",label:"Target",disabled:!0,children:({disabled:x,className:S})=>t.jsx(T.Textfield,{className:b(S,"w-full"),disabled:x,value:n.value})}),t.jsx(T,{className:"w-full mx-0",label:"Limit",size:E.sm,children:({className:x})=>t.jsx(T.Textfield,{className:b(x,"w-full"),type:"number",placeholder:"1000",value:p,onInput:S=>{S.stopPropagation(),a(S.target.valueAsNumber??we)}})}),t.jsx(T,{className:"w-full mx-0",label:"ON",size:E.sm,children:({className:x})=>t.jsx(T.Textfield,{className:b(x,"w-full"),placeholder:"s.id = t.id",value:f,onInput:S=>{S.stopPropagation(),g(S.target.value)}})}),t.jsx(T,{className:"w-full mx-0",label:"WHERE",size:E.sm,children:({className:x})=>t.jsx(T.Textfield,{className:b(x,"w-full"),placeholder:"id > 10",value:P,onInput:S=>{S.stopPropagation(),m(S.target.value)}})})]})})}),t.jsx(ae,{}),t.jsx(Te,{children:t.jsx("div",{className:"flex w-full justify-end items-center px-2",children:R?t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ne,{className:"w-3"}),t.jsx("small",{className:"text-xs text-neutral-400 block mx-2",children:"Getting Diff..."}),t.jsx(z,{size:E.sm,variant:F.Danger,onClick:x=>{x.stopPropagation(),j()},children:"Cancel"})]}):t.jsx(z,{className:"ml-2",size:E.sm,variant:F.Alternative,disabled:M(y)||R,onClick:x=>{x.stopPropagation(),o()},children:"Get Diff"})})})]})}function Ss(){const e=N(j=>j.setPreviewDiff),[s,l]=u.useState(""),[n,i]=u.useState(""),[r,c]=u.useState(we),[d,p]=u.useState(""),[a,f]=u.useState(""),{refetch:g,isFetching:P,cancel:m}=qe({source:s,target:n,limit:r,on:d,where:a});u.useEffect(()=>()=>{m()},[]);function v(){e(void 0),g().then(({data:j})=>{e(j)})}const R=[s,n,r,d].every(Boolean);return t.jsxs(t.Fragment,{children:[t.jsx(ye,{children:t.jsx("form",{className:"w-full",children:t.jsxs("fieldset",{className:"px-2 w-full text-neutral-500",children:[t.jsx(T,{className:"w-full mx-0",label:"Source",size:E.sm,children:({className:j})=>t.jsx(T.Textfield,{className:b(j,"w-full"),placeholder:"exp.tst_model__dev",value:s,onInput:o=>{o.stopPropagation(),l(o.target.value)}})}),t.jsx(T,{className:"w-full mx-0",label:"Target",size:E.sm,children:({className:j})=>t.jsx(T.Textfield,{className:b(j,"w-full"),placeholder:"exp.tst_snapshot__1353336088",value:n,onInput:o=>{o.stopPropagation(),i(o.target.value)}})}),t.jsx(T,{className:"w-full mx-0",label:"Limit",size:E.sm,children:({className:j})=>t.jsx(T.Textfield,{className:b(j,"w-full"),type:"number",placeholder:"1000",value:r,onInput:o=>{o.stopPropagation(),c(o.target.valueAsNumber??we)}})}),t.jsx(T,{className:"w-full mx-0",label:"ON",size:E.sm,children:({className:j})=>t.jsx(T.Textfield,{className:b(j,"w-full"),placeholder:"s.id = t.id",value:d,onInput:o=>{o.stopPropagation(),p(o.target.value)}})}),t.jsx(T,{className:"w-full mx-0",label:"WHERE",size:E.sm,children:({className:j})=>t.jsx(T.Textfield,{className:b(j,"w-full"),placeholder:"id > 10",value:a,onInput:o=>{o.stopPropagation(),f(o.target.value)}})})]})})}),t.jsx(ae,{}),t.jsx(Te,{children:P?t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ne,{className:"w-3"}),t.jsx("small",{className:"text-xs text-neutral-400 block mx-2",children:"Getting Diff..."}),t.jsx(z,{size:E.sm,variant:F.Danger,onClick:j=>{j.stopPropagation(),m()},children:"Cancel"})]}):t.jsx(z,{className:"ml-2",size:E.sm,variant:F.Alternative,disabled:M(R)||P,onClick:j=>{j.stopPropagation(),v()},children:"Get Diff"})})]})}const xe="s__",he="t__",ze="NULL";function Cs({source_schema:e,target_schema:s},l,n){const i=Array.from(new Set(n.flat())),r=Object.keys(e),c=Object.keys(s),p=Array.from(new Set(r.concat(c))).filter(g=>r.includes(g)&&c.includes(g)),a=r.filter(g=>!c.includes(g)),f=c.filter(g=>!r.includes(g));return{all:Array.from(new Set([i,l.modifiedColumns&&p,l.addedColumns&&f,l.removedColumns&&a].filter(Boolean).flat())),added:f.length,deleted:a.length,modified:p.length-i.length}}function Is(e,s,l){const n=Object.values(e.row_diff.sample)[0]??{},i=[],r=[],c=[];return Object.keys(n).forEach(d=>{Y(e,d,l)?r.push(d):V(e,d,l)?i.push(d):c.push(d)}),{all:[s.modifiedRows&&c,s.addedRows&&r,s.removedRows&&i].filter(Boolean).flat(),added:r.length,deleted:i.length,modified:c.length}}function Re(e,s,l){const n=G(e,xe,s,l),i=G(e,he,s,l);return n!==i}function V(e,s,l){return l.every(([n,i])=>{const r=G(e,xe,n,s),c=G(e,he,i,s);return I(r)&&Q(c)})}function Y(e,s,l){return l.every(([n,i])=>{const r=G(e,xe,n,s),c=G(e,he,i,s);return Q(r)&&I(c)})}function Ce(e,s,l,n){return l in e.schema_diff.added||l in e.schema_diff.removed?!1:s.some(i=>M(Y(e,i,n))&&M(V(e,i,n))&&Re(e,l,i))}function G(e,s,l,n){var i;return(i=e.row_diff.sample[`${s}${l}`])==null?void 0:i[n]}function ks(e,s,l){return G(e,xe,s,l)??ze}function Ds(e,s,l){return G(e,he,s,l)??ze}function Rs({diff:e}){const[s,l]=u.useState({modifiedRows:!0,addedRows:!0,removedRows:!0,modifiedColumns:!0,addedColumns:!0,removedColumns:!0}),n=Cs(e.schema_diff,s,e.on),i=Is(e,s,e.on),r=s.addedRows&&!s.removedRows&&!s.modifiedRows,c=!s.addedRows&&s.removedRows&&!s.modifiedRows,d=Array.from(new Set(e.on.flat())),p=Object.values(e.row_diff.sample).some(a=>Object.keys(a).length>0);return t.jsxs("div",{className:"px-2 h-full flex flex-col rounded-lg",children:[p&&t.jsxs(t.Fragment,{children:[t.jsx(Ls,{diff:e,rows:i,columns:n}),t.jsx("div",{className:"mt-2 mb-1 flex rounded-lg items-center",children:t.jsx("div",{className:"w-full flex justify-end items-center",children:t.jsx(gt,{options:Object.keys(s).reduce((a,f)=>(a[f]=g=>l(P=>({...P,[f]:g})),a),{}),value:Object.keys(s).map(a=>M(s[a])?void 0:a).filter(Boolean)})})})]}),t.jsx("div",{className:"overflow-auto h-full hover:scrollbar scrollbar--horizontal scrollbar--vertical",children:t.jsxs("table",{cellPadding:0,cellSpacing:0,className:"w-full text-xs text-neutral-600 dark:text-neutral-200 font-normal border-separate",children:[t.jsx("thead",{className:"sticky bg-theme top-0 z-10",children:t.jsx("tr",{children:n.all.map(a=>t.jsx("th",{colSpan:Ce(e,i.all,a,e.on)?2:1,className:b("text-left whitespace-nowrap py-1 px-2 font-bold",a in e.schema_diff.added?"border-t-2 border-l-2 border-r-2 border-success-500":a in e.schema_diff.removed?"border-t-2 border-l-2 border-r-2 border-danger-500":d.includes(a)?"border-brand-500 border-l-2 border-t-2 border-r-2":"border-r border-b border-neutral-100 dark:border-neutral-700 last:border-r-0",d.includes(a)?"bg-brand-10":"bg-neutral-5"),children:t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("div",{className:"mr-2",children:[t.jsx("span",{children:a})," ",t.jsxs("small",{className:"text-neutral-500 font-medium",children:["(",e.schema_diff.source_schema[a]??e.schema_diff.target_schema[a],")"]})]}),M(d.includes(a))&&t.jsx("div",{className:"ml-2",children:t.jsxs("small",{className:"inline-block bg-neutral-10 px-2 py-0.5 rounded-full",children:[Math.round(i.all.filter(f=>Re(e,a,f)).length/i.all.length*100),"%"]})})]})},a))})}),t.jsx("tbody",{children:ke(i.all)?i.all.map(a=>t.jsx("tr",{children:n.all.map(f=>Ce(e,i.all,f,e.on)?t.jsxs(t.Fragment,{children:[t.jsx("td",{className:b("p-1 border-r border-b border-neutral-100 dark:border-neutral-700 last:border-r-0",Y(e,a,e.on)&&"bg-success-10 text-success-500",V(e,a,e.on)&&"bg-danger-5 text-danger-500"),children:t.jsx("div",{className:b("px-2 py-1 whitespace-nowrap font-bold rounded-md ",Y(e,a,e.on)&&"bg-success-10 text-success-500",V(e,a,e.on)&&"bg-danger-5 text-danger-500"),children:ks(e,f,a)})},`${a}-${f}-source`),t.jsx("td",{className:b("p-1 border-r border-b border-neutral-100 dark:border-neutral-700 last:border-r-0",Y(e,a,e.on)&&"bg-success-10 text-success-500",V(e,a,e.on)&&"bg-danger-5 text-danger-500"),children:t.jsx("div",{className:b("px-2 py-1 whitespace-nowrap font-bold rounded-md",Re(e,f,a)&&"bg-primary-10 text-primary-500",Y(e,a,e.on)&&"!bg-success-10 !text-success-500",V(e,a,e.on)&&"!bg-danger-5 !text-danger-500"),children:Ds(e,f,a)})},`${a}-${f}-target`)]}):t.jsx("td",{className:b("p-1",f in e.schema_diff.added?"bg-success-10 border-l-2 border-r-2 border-success-500 text-success-500 font-bold":f in e.schema_diff.removed?"bg-danger-5 border-l-2 border-r-2 border-danger-500 !text-danger-500 font-bold":d.includes(f)?"border-brand-500 border-l-2 border-r-2":"border-r border-b border-neutral-100 dark:border-neutral-700 last:border-r-0",V(e,a,e.on)&&"!bg-danger-5 text-danger-500 font-bold",Y(e,a,e.on)&&"bg-success-10 text-success-500 font-bold"),children:t.jsx("div",{className:b("px-2 py-1 whitespace-nowrap rounded-md",(f in e.schema_diff.added||Y(e,a,e.on))&&"bg-success-10 text-success-500 font-bold",(f in e.schema_diff.removed||V(e,a,e.on))&&"!bg-danger-5 !text-danger-500 font-bold"),children:G(e,xe,f,a)??G(e,he,f,a)??ze})},`${a}-${f}`))},a)):t.jsx(yt,{columns:n.all.length>0?n.all.length:void 0})}),ke(i.all)&&t.jsx("tfoot",{className:"sticky bg-theme bottom-0",children:t.jsx("tr",{children:n.all.map(a=>Ce(e,i.all,a,e.on)?t.jsxs(t.Fragment,{children:[t.jsx("th",{className:b("text-left whitespace-nowrap px-2 py-1 border-r border-t border-neutral-100 dark:border-neutral-700 last:border-r-0",d.includes(a)?"bg-brand-10":"bg-neutral-10"),children:"Source"},`${a}-source`),t.jsx("th",{className:b("text-left whitespace-nowrap px-2 py-1 border-r border-t border-neutral-100 dark:border-neutral-700 last:border-r-0",d.includes(a)?"bg-brand-10":"bg-primary-10"),children:"Target"},`${a}-target`)]}):t.jsxs("th",{className:b("text-left whitespace-nowrap px-2 py-1 font-bold",a in e.schema_diff.added?"border-b-2 border-l-2 border-r-2 border-success-500":a in e.schema_diff.removed?"border-b-2 border-l-2 border-r-2 border-danger-500":d.includes(a)?"border-brand-500 border-l-2 border-b-2 border-r-2":"border-r border-t border-neutral-100 dark:border-neutral-700 last:border-r-0",d.includes(a)?"bg-brand-10":"bg-neutral-10"),children:[(a in e.schema_diff.removed||c)&&t.jsx("span",{children:"Source"}),(a in e.schema_diff.added||r)&&t.jsx("span",{children:"Target"})]},a))})})]})}),t.jsxs("div",{className:"flex justify-between items-center px-2 mt-2",children:[t.jsx(Tt,{count:i.all.length}),t.jsx(Ms,{})]})]})}function Ms(){const e=[["Grain","bg-brand-500"],["Changed","bg-primary-500"],["Added","bg-success-500"],["Deleted","bg-danger-500"]];return t.jsx("div",{className:"flex text-xs",children:e.map(([s="",l])=>t.jsx(_s,{text:s,className:l},s))})}function _s({text:e,className:s}){return t.jsxs("div",{className:"flex ml-2 items-center",children:[t.jsx("span",{className:b("inline-block w-3 h-3 mr-2 rounded-full",s)}),t.jsx("small",{className:"text-neutral-600 dark:text-neutral-400",children:e})]})}function Ls({diff:e,rows:s,columns:l}){return t.jsx(Se,{defaultOpen:!1,children:({open:n})=>t.jsxs(t.Fragment,{children:[t.jsxs(Se.Button,{className:"flex items-center w-full justify-between rounded-lg text-left text-sm px-4 pt-3 pb-2 bg-neutral-10 hover:bg-theme-darker dark:hover:bg-theme-lighter text-neutral-600 dark:text-neutral-400",children:[t.jsx("h2",{className:"whitespace-nowrap text-xl font-bold mb-1",children:"Stats"}),n?t.jsx(kt,{className:"h-6 w-6 text-primary-500"}):t.jsx(Dt,{className:"h-6 w-6 text-primary-500"})]}),t.jsx(Se.Panel,{className:"px-4 pb-2 text-sm text-neutral-500",children:t.jsxs("div",{className:"p-2 grid grid-cols-3 gap-4 mb-3",children:[t.jsx(Ie,{text:"Row Count Change",children:t.jsxs("p",{className:"text-6xl font-light text-primary-500 mt-3",children:[Math.round(Math.abs(e.row_diff.count_pct_change)),t.jsx("small",{className:"text-sm",children:"%"})]})}),t.jsxs(Ie,{text:"Column Count Change",count:s.all.length,children:[t.jsx("p",{className:"text-center text-6xl font-light text-primary-500 mt-3",children:s.modified}),t.jsx("p",{className:"text-center text-6xl font-light text-success-500 mt-3",children:s.added}),t.jsx("p",{className:"text-center text-6xl font-light text-danger-500 mt-3",children:s.deleted})]}),t.jsxs(Ie,{text:"Column Changes",count:l.all.length,children:[t.jsx("p",{className:"text-center text-6xl font-light text-primary-500 mt-3",children:l.modified}),t.jsx("p",{className:"text-center text-6xl font-light text-success-500 mt-3",children:l.added}),t.jsx("p",{className:"text-center text-6xl font-light text-danger-500 mt-3",children:l.deleted})]})]})})]})})}function Ie({text:e,children:s,className:l,count:n}){return t.jsxs("div",{className:b("rounded-xl overflow-hidden px-3 py-6 bg-primary-10",l),children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("h3",{className:"text-neutral-500 dark:text-neutral-300 text-sm font-bold",children:e}),I(n)&&t.jsx("div",{children:t.jsx("small",{className:"inline-block px-2 py-0.5 bg-neutral-10 rounded-full",children:n})})]}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:s})]})}const Fs=u.lazy(async()=>await ot(()=>import("./ModelLineage-b169bff1.js"),[])),U={Query:"Query",Table:"Data Preview",Console:"Logs",Lineage:"Lineage",Diff:"Diff",Errors:"Errors"};function As({tab:e,className:s}){const{errors:l,removeError:n}=Ve(),i=it(),r=D(x=>x.models),c=D(x=>x.isModel),d=N(x=>x.direction),p=N(x=>x.previewQuery),a=N(x=>x.previewTable),f=N(x=>x.previewDiff),g=N(x=>x.setDirection),[P,m]=u.useState(-1),v=Xe(e.file.path,x=>{i(`${ct.DataCatalogModels}/${x.name}`)}),R=r.get(e.file.path),j=M(e.file.isEmpty)&&I(R)&&c(e.file.path),o=l.size>0,y=u.useMemo(()=>[I(a)&&U.Table,I(p)&&e.file.isRemote&&U.Query,j&&U.Lineage,I(f)&&U.Diff,o&&U.Errors].filter(Boolean),[e.id,a,p,f,j,l,o]);return u.useEffect(()=>{I(a)?m(y.indexOf(U.Table)):m(0)},[a]),u.useEffect(()=>{I(f)?m(y.indexOf(U.Diff)):m(0)},[f]),u.useEffect(()=>{I(j)?m(y.indexOf(U.Lineage)):m(0)},[j]),u.useEffect(()=>{m(o?y.indexOf(U.Errors):0)},[o]),u.useEffect(()=>{for(const x of l)dt([$.Fetchdf,$.EvaluateModel,$.RenderQuery,$.ColumnLineage,$.ModelLineage,$.TableDiff,$.Table,$.SaveFile],x.key)&&n(x)},[a,f,p,j]),t.jsx("div",{className:b("w-full h-full flex flex-col text-prose overflow-auto hover:scrollbar scrollbar--vertical",s),children:ut(y)?t.jsx("div",{className:"flex justify-center items-center w-full h-full",children:t.jsx("h3",{className:"text-md",children:"No Data To Preview"})}):t.jsxs(k.Group,{onChange:m,selectedIndex:P,children:[t.jsx(Ae,{list:y,children:t.jsx("div",{className:"ml-2",children:t.jsx(z,{className:"!m-0 !py-0.5 px-[0.25rem] border-none",variant:F.Alternative,size:E.sm,onClick:()=>{g(d==="horizontal"?"vertical":"horizontal")},children:t.jsx(us,{"aria-label":d==="horizontal"?"Use vertical layout":"Use horizontal layout",className:"text-primary-500 w-5"})})})},y.join("-")),t.jsxs(k.Panels,{className:"h-full w-full overflow-hidden",children:[I(a)&&t.jsx(k.Panel,{unmount:!1,className:b("w-full h-full pt-4 relative px-2","ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:t.jsx(Et,{data:a})}),I(p)&&e.file.isRemote&&t.jsx(k.Panel,{unmount:!1,className:"w-full h-full ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2 p-2",children:t.jsx("div",{className:"w-full h-full p-2 bg-primary-10 rounded-lg overflow-auto hover:scrollbar scrollbar--horizontal scrollbar--vertical",children:t.jsx(De,{type:J.SQL,content:p??"",extensions:v,className:"text-xs"})})}),j&&t.jsx(k.Panel,{unmount:!1,className:b("w-full h-full ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:t.jsx(u.Suspense,{fallback:t.jsx(ft,{children:"Loading Model page..."}),children:t.jsx(Fs,{model:R})})}),I(f==null?void 0:f.row_diff)&&t.jsx(k.Panel,{unmount:!1,className:b("w-full h-full ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2 py-2"),children:t.jsx(Rs,{diff:f},e.id)}),o&&t.jsx(k.Panel,{unmount:!1,className:"w-full h-full ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2 py-2",children:t.jsx("ul",{className:"w-full h-full p-2 overflow-auto hover:scrollbar scrollbar--vertical scrollbar--horizontal",children:Array.from(l).reverse().map(x=>t.jsx("li",{className:"bg-danger-10 mb-4 last:m-0 p-2 rounded-md",children:t.jsx(Rt,{scope:x.key,error:x})},x.id))})})]})]},e.id)})}const ve=32,zs=2;function Oe(){const e=N(s=>s.tab);return t.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",children:[t.jsx(bs,{}),t.jsx(ae,{}),Q(e)?t.jsx($e,{}):t.jsx(tt,{tab:e})]})}function $e(){return t.jsx("div",{className:"flex justify-center items-center w-full h-full",children:t.jsx("div",{className:"p-4 text-center text-theme-darker dark:text-theme-lighter",children:t.jsx("h2",{className:"text-3xl",children:"Select File or Add New SQL Tab"})})})}function tt({tab:e}){const{errors:s,addError:l,removeError:n}=Ve(),i=D(h=>h.environment),r=D(h=>h.models),c=D(h=>h.isModel),d=ee(h=>h.files),p=ee(h=>h.selectedFile),a=ee(h=>h.setSelectedFile),f=N(h=>h.direction),g=N(h=>h.engine),P=N(h=>h.previewTable),m=N(h=>h.previewDiff),v=N(h=>h.refreshTab),R=N(h=>h.updateStoredTabsIds),j=N(h=>h.setPreviewQuery),o=N(h=>h.setPreviewTable),y=N(h=>h.setPreviewDiff),x=N(h=>h.setDialects),{setManuallySelectedColumn:S}=St(),q=u.useCallback(function(h){a(d.get(h.path))},[d]),Z=u.useCallback(function(h,L){S([h,L])},[]),X=Ct(),te=Xe(e.file.path,q,Z),[C,w]=u.useState(!1),_=u.useMemo(()=>[...X,{key:"Mod-Enter",win:"Ctrl-Enter",preventDefault:!0,stopPropagation:!0,run(h){const L=h.state.doc.toString();o(void 0),j(L);for(const H of s)H.key===$.Fetchdf&&n(H);return mt({sql:L}).then(H=>{o(Me(H))}).catch(H=>{l($.Fetchdf,{...H,errorKey:$.Fetchdf,trigger:"Editor -> customSQLKeymaps",message:H.message,timestamp:Date.now(),origin:"useQueryTimeout"})}),!0}}],[X,s]);u.useEffect(()=>{w(!1),Q(p)&&a(e==null?void 0:e.file)},[e.id]),u.useEffect(()=>(g.addEventListener("message",pe),()=>{g.removeEventListener("message",pe)}),[e.id,e.dialect]),u.useEffect(()=>{j(void 0),o(void 0),y(void 0),R()},[e.id,e.file.fingerprint]),u.useEffect(()=>{y(void 0)},[i]);function se(){const h=r.get(e.file.path),L=M(e.file.isEmpty)&&I(h)&&c(e.file.path);return s.size>0||[P,m].some(Boolean)||L?[70,30]:[100,0]}function Ee(){const h=r.get(e==null?void 0:e.file.path);return C&&(I(h)&&c(e.file.path)||e.file.isLocal)&&M(de(e.file.content))?[70,30]:[100,0]}function oe(h){e.file.content=h,v(e)}function pe(h){if(h.data.topic==="dialects"){const L=r.get(e.file.path);e.dialect=(L==null?void 0:L.dialect)??e.dialect??"",x(h.data.payload),v(e)}if(h.data.topic==="format"){if(de(h.data.payload))return;e.file.content=h.data.payload,v(e)}}return t.jsxs(Be,{className:b("w-full h-full overflow-hidden",f==="vertical"?"flex flex-col":"flex"),sizes:se(),direction:f,minSize:[ve,0],snapOffset:0,children:[t.jsxs("div",{className:b("flex flex-col",f==="vertical"?"w-full ":"h-full"),children:[t.jsxs(Be,{className:"flex h-full overflow-hidden",sizes:Ee(),minSize:ve,snapOffset:ve,handleDrag:(h,L)=>{const st=L.parent.getBoundingClientRect().width*(h[1]??0)/100;w(st>=ve+zs)},children:[t.jsxs("div",{className:"flex flex-col h-full",children:[e.file.isLocal&&t.jsx(De,{type:J.SQL,dialect:e.dialect,keymaps:_,content:e.file.content,extensions:te,onChange:oe}),e.file.isRemote&&t.jsx(It,{keymaps:X,path:e.file.path,children:({file:h,keymaps:L})=>t.jsx(De,{type:h.extension,dialect:e.dialect,extensions:te,keymaps:L,content:h.content,onChange:oe})})]}),t.jsx("div",{className:"flex flex-col h-full",children:t.jsx(js,{tab:e,toggle:()=>w(h=>!h),isOpen:C})})]},e.id),t.jsx(ae,{}),t.jsx(ps,{tab:e},e.file.fingerprint)]}),t.jsx(As,{tab:e,className:b(f==="vertical"?"flex flex-col":"flex")})]},f)}Oe.Empty=$e;Oe.Loading=$e;Oe.Main=tt;export{Oe as default};
