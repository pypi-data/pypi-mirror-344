(this["webpackJsonpstreamlit-video-timeline"]=this["webpackJsonpstreamlit-video-timeline"]||[]).push([[0],{15:function(e,t,r){},16:function(e,t,r){"use strict";r.r(t);var o=r(1),n=r.n(o),a=r(5),c=r.n(a),s=r(4),l=r(0);var i=Object(s.b)((e=>{let{args:t,theme:r}=e;const n=Object(o.useRef)(!1),a=Object(o.useRef)(null),c=r||{base:"light",primaryColor:"#000",backgroundColor:"#fff",secondaryBackgroundColor:"#f0f0f0",textColor:"#000",font:"sans-serif"},i=Object(o.useRef)(null),d=Object(o.useRef)(null),[u,m]=Object(o.useState)(!1),[b,j]=Object(o.useState)(0),[h,f]=Object(o.useState)(0),[g,v]=Object(o.useState)(0),[O,p]=Object(o.useState)([]),x=Object(o.useRef)(null),A=Object(o.useRef)(null),[y,C]=Object(o.useState)(100),[k,w]=Object(o.useState)(100),M=(Object(o.useRef)(0),Object(o.useRef)(0)),N=Object(o.useRef)(0);Object(o.useEffect)((()=>{s.a.setComponentReady();const e=i.current;if(e)return e.addEventListener("loadedmetadata",(()=>{console.log(`Video loaded with duration: ${e.duration} seconds`),v(e.duration);const t=Math.min(300,Math.max(50,Math.ceil(e.duration/3)));console.log(`Setting thumbnail count to: ${t} based on duration: ${e.duration}`),C(t);const r=Math.min(1e3,Math.max(100,Math.ceil(2*e.duration)));console.log(`Setting waveform count to: ${r} based on duration: ${e.duration}`),w(r),B(e)})),e.addEventListener("error",(t=>{var r,o;console.error("Video loading error:",t),console.error("Video error code:",null===(r=e.error)||void 0===r?void 0:r.code),console.error("Video error message:",null===(o=e.error)||void 0===o?void 0:o.message)})),()=>{x.current&&x.current.close(),e.removeEventListener("loadedmetadata",(()=>{}))}}),[]);const $=e=>{const t=Math.floor(e/60),r=Math.floor(e%60);return`${t}:${r<10?"0"+r:r}.${Math.floor(e%1*10)}`},E=e=>t=>{t.preventDefault(),d.current&&(n.current=!0,a.current=e,M.current=t.clientX,N.current="start"===e?b:h,console.log("Drag start",{markerType:e,initialMouseX:t.clientX,initialTime:N.current}),document.addEventListener("mousemove",R),document.addEventListener("mouseup",S))},R=e=>{if(!n.current||!d.current||!a.current||g<=0)return;const t=d.current.getBoundingClientRect().width,r=e.clientX-M.current,o=r/t*g;let c=N.current+o;c=Math.max(0,Math.min(g,c)),c=Math.round(20*c)/20,console.log("Dragging",{deltaX:r,deltaTime:o,newTime:c}),"start"===a.current?c<h&&j(c):c>b&&f(c)},S=()=>{n.current=!1,a.current=null,document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",S)},D=e=>()=>{i.current&&(i.current.currentTime=e)},B=e=>{const t=new AudioContext,r=t.createAnalyser();r.fftSize=256;const o=r.frequencyBinCount,n=new Uint8Array(o);t.createMediaElementSource(e).connect(r),r.connect(t.destination),x.current=t,A.current=r;const a=()=>{A.current&&(A.current.getByteFrequencyData(n),p(Array.from(n)),requestAnimationFrame(a))};a()};return Object(l.jsx)("div",{style:{fontFamily:c.font,color:c.textColor,backgroundColor:c.backgroundColor,padding:"10px"},children:Object(l.jsxs)("div",{className:"container",children:[Object(l.jsxs)("video",{ref:i,controls:!0,style:{width:"100%",maxWidth:"100%"},onLoadedData:()=>console.log("Video data loaded successfully"),onError:e=>console.error("Video loading error:",e),onTimeUpdate:()=>{i.current&&console.log(`Current time: ${i.current.currentTime}, Duration: ${i.current.duration}`)},children:[Object(l.jsx)("source",{src:t.video_url,type:"video/mp4"}),"Your browser does not support the video tag."]}),Object(l.jsxs)("div",{className:"timeline-wrapper",children:[Object(l.jsxs)("div",{className:"timeline-labels",children:[Object(l.jsx)("div",{className:"timeline-label",style:{paddingBottom:"10px",paddingTop:"10px"},children:"VIDEO"}),Object(l.jsx)("div",{className:"timeline-label",children:"AUDIO"})]}),Object(l.jsxs)("div",{className:"timeline-container",ref:d,children:[Object(l.jsx)("div",{className:"video-track",children:Object(l.jsx)("div",{className:"frame-thumbnails",children:t.frame_data&&t.frame_data.length>0?t.frame_data.map(((e,r)=>Object(l.jsx)("div",{className:"frame-thumbnail",style:{backgroundImage:`url("${e}")`,width:100/t.frame_data.length+"%"}},r))):Array.from({length:y}).map(((e,t)=>Object(l.jsx)("div",{className:"frame-thumbnail",style:{backgroundImage:'url("data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==")',width:100/y+"%"}},t)))})}),Object(l.jsx)("div",{className:"audio-track",children:Object(l.jsx)("div",{className:"audio-waveform",children:t.waveform_data&&t.waveform_data.length>0?t.waveform_data.map(((e,t)=>{const r=100*Math.max(e,.2);return Object(l.jsx)("div",{className:"waveform-bar",style:{height:`${r}%`,backgroundColor:c.primaryColor||"rgba(255, 75, 75, 0.8)"}},t)})):Array.from({length:k}).map(((e,t)=>{const r=20+15*Math.sin(t*Math.PI/10);return Object(l.jsx)("div",{className:"waveform-bar",style:{height:`${r}%`,backgroundColor:c.primaryColor||"rgba(255, 75, 75, 0.8)",flexBasis:100/k+"%",minWidth:0}},t)}))})}),u&&Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("div",{className:"crop-marker",style:{left:`calc(${b/g*100}% - 1px)`,cursor:"ew-resize"},onMouseDown:E("start"),onDoubleClick:D(b),children:Object(l.jsx)("div",{className:"crop-label",children:$(b)})}),Object(l.jsx)("div",{className:"crop-marker",style:{left:`calc(${h/g*100}% - 1px)`,cursor:"ew-resize"},onMouseDown:E("end"),onDoubleClick:D(h),children:Object(l.jsx)("div",{className:"crop-label",children:$(h)})})]})]})]}),Object(l.jsx)("div",{className:"button-container",children:u?Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("button",{className:"btn",onClick:()=>{s.a.setComponentValue({start:b,end:h,shouldRefreshTaskList:!0}),m(!1)},style:{backgroundColor:c.primaryColor},children:"Aplicar Corte"}),Object(l.jsx)("button",{className:"btn",onClick:()=>m(!1),style:{backgroundColor:c.primaryColor},children:"Cancelar"})]}):Object(l.jsx)("button",{className:"btn",onClick:()=>{if(!u){i.current&&i.current.pause(),console.log(`Setting crop markers for toggle: video duration = ${g}`);const e=Math.round(20)/20,t=Math.round(20*Math.max(g-1,.75*g))/20;console.log(`Setting crop markers at: start=${e}, end=${t}`),j(e),f(t)}m(!u)},style:{backgroundColor:c.primaryColor},children:"Modo de Corte"})})]})})}));r(15);c.a.render(Object(l.jsx)(n.a.StrictMode,{children:Object(l.jsx)(i,{})}),document.getElementById("root"))}},[[16,1,2]]]);