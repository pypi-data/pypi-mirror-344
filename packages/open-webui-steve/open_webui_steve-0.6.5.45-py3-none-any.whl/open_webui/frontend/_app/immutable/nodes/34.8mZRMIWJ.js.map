{"version":3,"file":"34.8mZRMIWJ.js","sources":["../../../../../../src/routes/(app)/workspace/tools/edit/+page.svelte"],"sourcesContent":["<script>\r\n\timport { goto } from '$app/navigation';\r\n\timport { page } from '$app/stores';\r\n\timport { getToolById, getTools, updateToolById } from '$lib/apis/tools';\r\n\timport Spinner from '$lib/components/common/Spinner.svelte';\r\n\timport ToolkitEditor from '$lib/components/workspace/Tools/ToolkitEditor.svelte';\r\n\timport { WEBUI_VERSION } from '$lib/constants';\r\n\timport { tools } from '$lib/stores';\r\n\timport { compareVersion, extractFrontmatter } from '$lib/utils';\r\n\timport { onMount, getContext } from 'svelte';\r\n\timport { toast } from 'svelte-sonner';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\tlet tool = null;\r\n\r\n\tconst saveHandler = async (data) => {\r\n\r\n\t\tconst manifest = extractFrontmatter(data.content);\r\n\t\tif (compareVersion(manifest?.required_open_webui_version ?? '0.0.0', WEBUI_VERSION)) {\r\n\t\t\ttoast.error(\r\n\t\t\t\t$i18n.t(\r\n\t\t\t\t\t'Open WebUI version (v{{OPEN_WEBUI_VERSION}}) is lower than required version (v{{REQUIRED_VERSION}})',\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tOPEN_WEBUI_VERSION: WEBUI_VERSION,\r\n\t\t\t\t\t\tREQUIRED_VERSION: manifest?.required_open_webui_version ?? '0.0.0'\r\n\t\t\t\t\t}\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst res = await updateToolById(localStorage.token, tool.id, {\r\n\t\t\tid: data.id,\r\n\t\t\tname: data.name,\r\n\t\t\tmeta: data.meta,\r\n\t\t\tcontent: data.content,\r\n\t\t\taccess_control: data.access_control\r\n\t\t}).catch((error) => {\r\n\t\t\ttoast.error(`${error}`);\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (res) {\r\n\t\t\ttoast.success($i18n.t('Tool updated successfully'));\r\n\t\t\ttools.set(await getTools(localStorage.token));\r\n\r\n\t\t\t// await goto('/workspace/tools');\r\n\t\t}\r\n\t};\r\n\r\n\tonMount(async () => {\r\n\t\tconst id = $page.url.searchParams.get('id');\r\n\r\n\t\tif (id) {\r\n\t\t\ttool = await getToolById(localStorage.token, id).catch((error) => {\r\n\t\t\t\ttoast.error(`${error}`);\r\n\t\t\t\tgoto('/workspace/tools');\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t});\r\n</script>\r\n\r\n{#if tool}\r\n\t<ToolkitEditor\r\n\t\tedit={true}\r\n\t\tid={tool.id}\r\n\t\tname={tool.name}\r\n\t\tmeta={tool.meta}\r\n\t\tcontent={tool.content}\r\n\t\taccessControl={tool.access_control}\r\n\t\tonSave={(value) => {\r\n\t\t\tsaveHandler(value);\r\n\t\t}}\r\n\t/>\r\n{:else}\r\n\t<div class=\"flex items-center justify-center h-full\">\r\n\t\t<div class=\" pb-16\">\r\n\t\t\t<Spinner />\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n"],"names":["insert_hydration","target","div1","anchor","append_hydration","div0","ctx","dirty","toolkiteditor_changes","i18n","getContext","tool","saveHandler","data","manifest","extractFrontmatter","compareVersion","WEBUI_VERSION","toast","$i18n","updateToolById","error","tools","getTools","onMount","id","$page","getToolById","goto","value"],"mappings":"g5BA8ECA,EAIMC,EAAAC,EAAAC,CAAA,EAHLC,EAEMF,EAAAG,CAAA,+JAdA,GACF,GAAAC,KAAK,GACH,KAAAA,KAAK,KACL,KAAAA,KAAK,KACF,QAAAA,KAAK,QACC,cAAAA,KAAK,sHAJhBC,EAAA,IAAAC,EAAA,GAAAF,KAAK,IACHC,EAAA,IAAAC,EAAA,KAAAF,KAAK,MACLC,EAAA,IAAAC,EAAA,KAAAF,KAAK,MACFC,EAAA,IAAAC,EAAA,QAAAF,KAAK,SACCC,EAAA,IAAAC,EAAA,cAAAF,KAAK,8KAPjBA,EAAI,CAAA,EAAA,8WArDFG,EAAOC,EAAW,MAAM,qBAE1B,IAAAC,EAAO,KAEL,MAAAC,QAAqBC,GAAI,CAExB,MAAAC,EAAWC,EAAmBF,EAAK,OAAO,EAC5C,GAAAG,GAAeF,GAAA,YAAAA,EAAU,8BAA+B,QAASG,CAAa,EAAA,CACjFC,EAAM,MACLC,EAAM,EACL,sGAAqG,CAEpG,mBAAoBF,EACpB,kBAAkBH,GAAA,YAAAA,EAAU,8BAA+B,kBAOtD,MAASM,EAAe,aAAa,MAAOT,EAAK,GAAE,CAC3D,GAAIE,EAAK,GACT,KAAMA,EAAK,KACX,KAAMA,EAAK,KACX,QAASA,EAAK,QACd,eAAgBA,EAAK,cACnB,CAAA,EAAA,MAAOQ,IACTH,EAAM,MAAK,GAAIG,CAAK,EAAA,EACb,SAIPH,EAAM,QAAQC,EAAM,EAAE,2BAA2B,CAAA,EACjDG,EAAM,IAAG,MAAOC,EAAS,aAAa,KAAK,CAAA,IAM7C,OAAAC,EAAO,SAAA,OACAC,EAAKC,EAAM,IAAI,aAAa,IAAI,IAAI,EAEtCD,OACHd,EAAI,MAASgB,EAAY,aAAa,MAAOF,CAAE,EAAE,MAAOJ,IACvDH,EAAM,MAAK,GAAIG,CAAK,EAAA,EACpBO,EAAK,kBAAkB,EAChB,iBAeAC,GAAK,CACbjB,EAAYiB,CAAK"}