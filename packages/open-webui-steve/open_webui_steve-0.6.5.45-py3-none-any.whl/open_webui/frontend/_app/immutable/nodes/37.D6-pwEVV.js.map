{"version":3,"file":"37.D6-pwEVV.js","sources":["../../../../../../src/routes/s/[id]/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\r\n\timport { onMount, tick, getContext } from 'svelte';\r\n\timport { goto } from '$app/navigation';\r\n\timport { page } from '$app/stores';\r\n\r\n\timport dayjs from 'dayjs';\r\n\r\n\timport { settings, chatId, WEBUI_NAME, models, config } from '$lib/stores';\r\n\timport { convertMessagesToHistory, createMessagesList } from '$lib/utils';\r\n\r\n\timport { getChatByShareId, cloneSharedChatById } from '$lib/apis/chats';\r\n\r\n\timport Messages from '$lib/components/chat/Messages.svelte';\r\n\timport Navbar from '$lib/components/layout/Navbar.svelte';\r\n\r\n\timport { getUserById, getUserSettings } from '$lib/apis/users';\r\n\timport { getModels } from '$lib/apis';\r\n\timport { toast } from 'svelte-sonner';\r\n\timport localizedFormat from 'dayjs/plugin/localizedFormat';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\tdayjs.extend(localizedFormat);\r\n\r\n\tlet loaded = false;\r\n\r\n\tlet autoScroll = true;\r\n\tlet processing = '';\r\n\tlet messagesContainerElement: HTMLDivElement;\r\n\r\n\t// let chatId = $page.params.id;\r\n\tlet showModelSelector = false;\r\n\tlet selectedModels = [''];\r\n\r\n\tlet chat = null;\r\n\tlet user = null;\r\n\r\n\tlet title = '';\r\n\tlet files = [];\r\n\r\n\tlet messages = [];\r\n\tlet history = {\r\n\t\tmessages: {},\r\n\t\tcurrentId: null\r\n\t};\r\n\r\n\t$: messages = createMessagesList(history, history.currentId);\r\n\r\n\t$: if ($page.params.id) {\r\n\t\t(async () => {\r\n\t\t\tif (await loadSharedChat()) {\r\n\t\t\t\tawait tick();\r\n\t\t\t\tloaded = true;\r\n\t\t\t} else {\r\n\t\t\t\tawait goto('/');\r\n\t\t\t}\r\n\t\t})();\r\n\t}\r\n\r\n\t//////////////////////////\r\n\t// Web functions\r\n\t//////////////////////////\r\n\r\n\tconst loadSharedChat = async () => {\r\n\t\tconst userSettings = await getUserSettings(localStorage.token).catch((error) => {\r\n\t\t\tconsole.error(error);\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (userSettings) {\r\n\t\t\tsettings.set(userSettings.ui);\r\n\t\t} else {\r\n\t\t\tlet localStorageSettings = {} as Parameters<(typeof settings)['set']>[0];\r\n\r\n\t\t\ttry {\r\n\t\t\t\tlocalStorageSettings = JSON.parse(localStorage.getItem('settings') ?? '{}');\r\n\t\t\t} catch (e: unknown) {\r\n\t\t\t\tconsole.error('Failed to parse settings from localStorage', e);\r\n\t\t\t}\r\n\r\n\t\t\tsettings.set(localStorageSettings);\r\n\t\t}\r\n\r\n\t\tawait models.set(\r\n\t\t\tawait getModels(\r\n\t\t\t\tlocalStorage.token,\r\n\t\t\t\t$config?.features?.enable_direct_connections && ($settings?.directConnections ?? null)\r\n\t\t\t)\r\n\t\t);\r\n\t\tawait chatId.set($page.params.id);\r\n\t\tchat = await getChatByShareId(localStorage.token, $chatId).catch(async (error) => {\r\n\t\t\tawait goto('/');\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (chat) {\r\n\t\t\tuser = await getUserById(localStorage.token, chat.user_id).catch((error) => {\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\r\n\t\t\tconst chatContent = chat.chat;\r\n\r\n\t\t\tif (chatContent) {\r\n\t\t\t\tselectedModels =\r\n\t\t\t\t\t(chatContent?.models ?? undefined) !== undefined\r\n\t\t\t\t\t\t? chatContent.models\r\n\t\t\t\t\t\t: [chatContent.models ?? ''];\r\n\t\t\t\thistory =\r\n\t\t\t\t\t(chatContent?.history ?? undefined) !== undefined\r\n\t\t\t\t\t\t? chatContent.history\r\n\t\t\t\t\t\t: convertMessagesToHistory(chatContent.messages);\r\n\t\t\t\ttitle = chatContent.title;\r\n\r\n\t\t\t\tautoScroll = true;\r\n\t\t\t\tawait tick();\r\n\r\n\t\t\t\tif (messages.length > 0) {\r\n\t\t\t\t\thistory.messages[messages.at(-1).id].done = true;\r\n\t\t\t\t}\r\n\t\t\t\tawait tick();\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst cloneSharedChat = async () => {\r\n\t\tif (!chat) return;\r\n\r\n\t\tconst res = await cloneSharedChatById(localStorage.token, chat.id).catch((error) => {\r\n\t\t\ttoast.error(`${error}`);\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (res) {\r\n\t\t\tgoto(`/c/${res.id}`);\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<svelte:head>\r\n\t<title>\r\n\t\t{title\r\n\t\t\t? `${title.length > 30 ? `${title.slice(0, 30)}...` : title} | ${$WEBUI_NAME}`\r\n\t\t\t: `${$WEBUI_NAME}`}\r\n\t</title>\r\n</svelte:head>\r\n\r\n{#if loaded}\r\n\t<div\r\n\t\tclass=\"h-screen max-h-[100dvh] w-full flex flex-col text-gray-700 dark:text-gray-100 bg-white dark:bg-gray-900\"\r\n\t>\r\n\t\t<div class=\"flex flex-col flex-auto justify-center relative\">\r\n\t\t\t<div class=\" flex flex-col w-full flex-auto overflow-auto h-0\" id=\"messages-container\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tclass=\"pt-5 px-2 w-full {($settings?.widescreenMode ?? null)\r\n\t\t\t\t\t\t? 'max-w-full'\r\n\t\t\t\t\t\t: 'max-w-5xl'} mx-auto\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div class=\"px-3\">\r\n\t\t\t\t\t\t<div class=\" text-2xl font-semibold line-clamp-1\">\r\n\t\t\t\t\t\t\t{title}\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div class=\"flex text-sm justify-between items-center mt-1\">\r\n\t\t\t\t\t\t\t<div class=\"text-gray-400\">\r\n\t\t\t\t\t\t\t\t{dayjs(chat.chat.timestamp).format('LLL')}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\" h-full w-full flex flex-col py-2\">\r\n\t\t\t\t\t<div class=\"w-full\">\r\n\t\t\t\t\t\t<Messages\r\n\t\t\t\t\t\t\tclassName=\"h-full flex pt-4 pb-8 \"\r\n\t\t\t\t\t\t\t{user}\r\n\t\t\t\t\t\t\tchatId={$chatId}\r\n\t\t\t\t\t\t\treadOnly={true}\r\n\t\t\t\t\t\t\t{selectedModels}\r\n\t\t\t\t\t\t\t{processing}\r\n\t\t\t\t\t\t\tbind:history\r\n\t\t\t\t\t\t\tbind:messages\r\n\t\t\t\t\t\t\tbind:autoScroll\r\n\t\t\t\t\t\t\tbottomPadding={files.length > 0}\r\n\t\t\t\t\t\t\tsendPrompt={() => {}}\r\n\t\t\t\t\t\t\tcontinueResponse={() => {}}\r\n\t\t\t\t\t\t\tregenerateResponse={() => {}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div\r\n\t\t\t\tclass=\"absolute bottom-0 right-0 left-0 flex justify-center w-full bg-linear-to-b from-transparent to-white dark:to-gray-900\"\r\n\t\t\t>\r\n\t\t\t\t<div class=\"pb-5\">\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full\"\r\n\t\t\t\t\t\ton:click={cloneSharedChat}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{$i18n.t('Clone Chat')}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n"],"names":["dayjs","ctx","_a","insert_hydration","target","div11","anchor","append_hydration","div10","div7","div4","div3","div0","div2","div1","div6","div5","div9","div8","button","set_data","t2","t2_value","t5","t5_value","create_if_block","processing","i18n","getContext","localizedFormat","loaded","autoScroll","selectedModels","chat","user","title","files","messages","history","loadSharedChat","userSettings","getUserSettings","error","settings","localStorageSettings","e","models","getModels","$config","$settings","chatId","$page","$$invalidate","getChatByShareId","$chatId","goto","getUserById","chatContent","convertMessagesToHistory","tick","cloneSharedChat","res","cloneSharedChatById","toast","createMessagesList"],"mappings":"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"}