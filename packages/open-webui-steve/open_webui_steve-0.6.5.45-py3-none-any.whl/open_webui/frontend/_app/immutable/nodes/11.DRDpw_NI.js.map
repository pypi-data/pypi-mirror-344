{"version":3,"file":"11.DRDpw_NI.js","sources":["../../../../../../src/routes/(app)/admin/functions/create/+page.svelte"],"sourcesContent":["<script>\r\n\timport { toast } from 'svelte-sonner';\r\n\timport { onMount, getContext } from 'svelte';\r\n\timport { goto } from '$app/navigation';\r\n\r\n\timport { config, functions, models, settings } from '$lib/stores';\r\n\timport { createNewFunction, getFunctions } from '$lib/apis/functions';\r\n\timport FunctionEditor from '$lib/components/admin/Functions/FunctionEditor.svelte';\r\n\timport { getModels } from '$lib/apis';\r\n\timport { compareVersion, extractFrontmatter } from '$lib/utils';\r\n\timport { WEBUI_VERSION } from '$lib/constants';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\tlet mounted = false;\r\n\tlet clone = false;\r\n\tlet func = null;\r\n\r\n\tconst saveHandler = async (data) => {\r\n\r\n\t\tconst manifest = extractFrontmatter(data.content);\r\n\t\tif (compareVersion(manifest?.required_open_webui_version ?? '0.0.0', WEBUI_VERSION)) {\r\n\t\t\ttoast.error(\r\n\t\t\t\t$i18n.t(\r\n\t\t\t\t\t'Open WebUI version (v{{OPEN_WEBUI_VERSION}}) is lower than required version (v{{REQUIRED_VERSION}})',\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tOPEN_WEBUI_VERSION: WEBUI_VERSION,\r\n\t\t\t\t\t\tREQUIRED_VERSION: manifest?.required_open_webui_version ?? '0.0.0'\r\n\t\t\t\t\t}\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst res = await createNewFunction(localStorage.token, {\r\n\t\t\tid: data.id,\r\n\t\t\tname: data.name,\r\n\t\t\tmeta: data.meta,\r\n\t\t\tcontent: data.content\r\n\t\t}).catch((error) => {\r\n\t\t\ttoast.error(`${error}`);\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (res) {\r\n\t\t\ttoast.success($i18n.t('Function created successfully'));\r\n\t\t\tfunctions.set(await getFunctions(localStorage.token));\r\n\t\t\tmodels.set(\r\n\t\t\t\tawait getModels(\r\n\t\t\t\t\tlocalStorage.token,\r\n\t\t\t\t\t$config?.features?.enable_direct_connections && ($settings?.directConnections ?? null)\r\n\t\t\t\t)\r\n\t\t\t);\r\n\r\n\t\t\tawait goto('/admin/functions');\r\n\t\t}\r\n\t};\r\n\r\n\tonMount(() => {\r\n\t\twindow.addEventListener('message', async (event) => {\r\n\t\t\tif (\r\n\t\t\t\t!['https://openwebui.com', 'https://www.openwebui.com', 'http://localhost:9999'].includes(\r\n\t\t\t\t\tevent.origin\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tfunc = JSON.parse(event.data);\r\n\t\t});\r\n\r\n\t\tif (window.opener ?? false) {\r\n\t\t\twindow.opener.postMessage('loaded', '*');\r\n\t\t}\r\n\r\n\t\tif (sessionStorage.function) {\r\n\t\t\tfunc = JSON.parse(sessionStorage.function);\r\n\t\t\tsessionStorage.removeItem('function');\r\n\r\n\t\t\tclone = true;\r\n\t\t}\r\n\r\n\t\tmounted = true;\r\n\t});\r\n</script>\r\n\r\n{#if mounted}\r\n\t{#key func?.content}\r\n\t\t<FunctionEditor\r\n\t\t\tid={func?.id ?? ''}\r\n\t\t\tname={func?.name ?? ''}\r\n\t\t\tmeta={func?.meta ?? { description: '' }}\r\n\t\t\tcontent={func?.content ?? ''}\r\n\t\t\t{clone}\r\n\t\t\tonSave={(value) => {\r\n\t\t\t\tsaveHandler(value);\r\n\t\t\t}}\r\n\t\t/>\r\n\t{/key}\r\n{/if}\r\n"],"names":["previous_key","_a","ctx","dirty","safe_not_equal","_b","_c","_d","functioneditor_changes","create_if_block","i18n","getContext","mounted","clone","func","saveHandler","data","manifest","extractFrontmatter","compareVersion","WEBUI_VERSION","toast","$i18n","createNewFunction","error","functions","getFunctions","models","getModels","$config","$settings","goto","onMount","event","$$invalidate","value"],"mappings":"miBAsFO,IAAAA,GAAAC,EAAAC,OAAA,YAAAD,EAAM,0GAANE,EAAA,GAAAC,EAAAJ,EAAAA,GAAAC,EAAAC,OAAA,YAAAD,EAAM,OAAO,kMAEbA,EAAAC,EAAI,CAAA,IAAJ,YAAAD,EAAM,KAAM,UACVI,EAAAH,EAAI,CAAA,IAAJ,YAAAG,EAAM,OAAQ,GACd,OAAAC,EAAAJ,EAAM,CAAA,IAAN,YAAAI,EAAM,OAAU,CAAA,YAAa,EAAE,YAC5BC,EAAAL,EAAI,CAAA,IAAJ,YAAAK,EAAM,UAAW,8IAHtBN,EAAAC,EAAI,CAAA,IAAJ,YAAAD,EAAM,KAAM,mBACVI,EAAAH,EAAI,CAAA,IAAJ,YAAAG,EAAM,OAAQ,IACdF,EAAA,IAAAK,EAAA,OAAAF,EAAAJ,EAAM,CAAA,IAAN,YAAAI,EAAM,OAAU,CAAA,YAAa,EAAE,qBAC5BC,EAAAL,EAAI,CAAA,IAAJ,YAAAK,EAAM,UAAW,0IANxBL,EAAO,CAAA,GAAAO,EAAAP,CAAA,8FAAPA,EAAO,CAAA,+OAzELQ,EAAOC,EAAW,MAAM,qBAE1B,IAAAC,EAAU,GACVC,EAAQ,GACRC,EAAO,KAEL,MAAAC,QAAqBC,GAAI,OAExB,MAAAC,EAAWC,EAAmBF,EAAK,OAAO,EAC5C,GAAAG,GAAeF,GAAA,YAAAA,EAAU,8BAA+B,QAASG,CAAa,EAAA,CACjFC,EAAM,MACLC,EAAM,EACL,sGAAqG,CAEpG,mBAAoBF,EACpB,kBAAkBH,GAAA,YAAAA,EAAU,8BAA+B,kBAO7C,MAAAM,EAAkB,aAAa,MAAK,CACrD,GAAIP,EAAK,GACT,KAAMA,EAAK,KACX,KAAMA,EAAK,KACX,QAASA,EAAK,OACZ,CAAA,EAAA,MAAOQ,IACTH,EAAM,MAAK,GAAIG,CAAK,EAAA,EACb,SAIPH,EAAM,QAAQC,EAAM,EAAE,+BAA+B,CAAA,EACrDG,EAAU,IAAG,MAAOC,EAAa,aAAa,KAAK,CAAA,EACnDC,EAAO,IAAG,MACHC,EACL,aAAa,QACb3B,EAAA4B,GAAA,YAAAA,EAAS,WAAT,YAAA5B,EAAmB,8BAA8B6B,GAAA,YAAAA,EAAW,oBAAqB,KAAI,CAAA,EAIjF,MAAAC,EAAK,kBAAkB,IAI/B,OAAAC,EAAO,IAAA,CACN,OAAO,iBAAiB,gBAAkBC,GAAK,EAE3C,wBAAyB,4BAA6B,yBAAyB,SAChFA,EAAM,MAAM,GAKdC,EAAA,EAAApB,EAAO,KAAK,MAAMmB,EAAM,IAAI,CAAA,KAGzB,OAAO,QAAU,KACpB,OAAO,OAAO,YAAY,SAAU,GAAG,EAGpC,eAAe,WAClBC,EAAA,EAAApB,EAAO,KAAK,MAAM,eAAe,QAAQ,CAAA,EACzC,eAAe,WAAW,UAAU,EAEpCoB,EAAA,EAAArB,EAAQ,EAAI,GAGbqB,EAAA,EAAAtB,EAAU,EAAI,eAYJuB,GAAK,CACbpB,EAAYoB,CAAK"}