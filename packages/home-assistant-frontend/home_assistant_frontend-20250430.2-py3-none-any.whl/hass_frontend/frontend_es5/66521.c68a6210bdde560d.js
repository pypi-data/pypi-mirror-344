"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["66521"],{55815:function(t,e,s){s.d(e,{Eu:()=>o,hZ:()=>r,o9:()=>c});var a=s(28105),i=s(45657);const n=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function o(t){return n[t%n.length]}function r(t,e){const s=e.getPropertyValue(`--graph-color-${t+1}`)||o(t);return(0,i.Rq)(s)}const c=(0,a.Z)((t=>n.map(((e,s)=>r(s,t)))),((t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1")))},9924:function(t,e,s){s.d(e,{t:()=>o});s(40777),s(2394),s(81738),s(22960),s(21700),s(87799),s(64510);var a=s(59048);class i{addFromStorage(t){if(!this._storage[t]){const e=this.storage.getItem(t);e&&(this._storage[t]=JSON.parse(e))}}subscribeChanges(t,e){return this._listeners[t]?this._listeners[t].push(e):this._listeners[t]=[e],()=>{this.unsubscribeChanges(t,e)}}unsubscribeChanges(t,e){if(!(t in this._listeners))return;const s=this._listeners[t].indexOf(e);-1!==s&&this._listeners[t].splice(s,1)}hasKey(t){return t in this._storage}getValue(t){return this._storage[t]}setValue(t,e){const s=this._storage[t];this._storage[t]=e;try{void 0===e?this.storage.removeItem(t):this.storage.setItem(t,JSON.stringify(e))}catch(a){}finally{this._listeners[t]&&this._listeners[t].forEach((t=>t(s,e)))}}constructor(t=window.localStorage){this._storage={},this._listeners={},this.storage=t,this.storage===window.localStorage&&window.addEventListener("storage",(t=>{t.key&&this.hasKey(t.key)&&(this._storage[t.key]=t.newValue?JSON.parse(t.newValue):t.newValue,this._listeners[t.key]&&this._listeners[t.key].forEach((e=>e(t.oldValue?JSON.parse(t.oldValue):t.oldValue,this._storage[t.key]))))}))}}const n={};function o(t){return(e,s)=>{if("object"==typeof s)throw new Error("This decorator does not support this compilation type.");const o=t.storage||"localStorage";let r;o&&o in n?r=n[o]:(r=new i(window[o]),n[o]=r);const c=t.key||String(s);r.addFromStorage(c);const d=!1!==t.subscribe?t=>r.subscribeChanges(c,((e,a)=>{t.requestUpdate(s,e)})):void 0,l=()=>r.hasKey(c)?t.deserializer?t.deserializer(r.getValue(c)):r.getValue(c):void 0,u=(e,a)=>{let i;t.state&&(i=l()),r.setValue(c,t.serializer?t.serializer(a):a),t.state&&e.requestUpdate(s,i)},h=e.performUpdate;if(e.performUpdate=function(){this.__initialized=!0,h.call(this)},t.state&&t.subscribe){const t=e.connectedCallback,s=e.disconnectedCallback;e.connectedCallback=function(){t.call(this);const e=this;e.__unbsubLocalStorage||(e.__unbsubLocalStorage=null==d?void 0:d(this))},e.disconnectedCallback=function(){var t;s.call(this);const e=this;null===(t=e.__unbsubLocalStorage)||void 0===t||t.call(e),e.__unbsubLocalStorage=void 0}}t.state&&a.fl.createProperty(s,Object.assign({noAccessor:!0},t.stateOptions));const _=Object.getOwnPropertyDescriptor(e,s);let p;if(void 0===_)p={get(){return l()},set(t){(this.__initialized||void 0===l())&&(u(this,t),this.requestUpdate(s,void 0))},configurable:!0,enumerable:!0};else{const t=_.set;p=Object.assign(Object.assign({},_),{},{set(e){(this.__initialized||void 0===l())&&(u(this,e),this.requestUpdate(s,void 0)),null==t||t.call(this,e)}})}Object.defineProperty(e,s,p)}}},7214:function(t,e,s){s.d(e,{Cj:()=>h,F7:()=>i,Hs:()=>C,Kd:()=>S,Kj:()=>p,Nw:()=>m,PA:()=>n,Py:()=>c,Qm:()=>w,Z0:()=>v,_Y:()=>l,_m:()=>o,dL:()=>d,dO:()=>k,hN:()=>_,h_:()=>u,j2:()=>y,q6:()=>f,uR:()=>r});s(39710),s(26847),s(81738),s(72489),s(56389),s(27530);var a=s(15459),i=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const n=99387==s.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,o=t=>t.sendMessagePromise({type:"recorder/info"}),r=(t,e)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:e}),c=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),d=(t,e,s,a,i="hour",n,o)=>t.callWS({type:"recorder/statistics_during_period",start_time:e.toISOString(),end_time:null==s?void 0:s.toISOString(),statistic_ids:a,period:i,units:n,types:o}),l=(t,e,s,a)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:e,units:a,fixed_period:s.fixed_period?{start_time:s.fixed_period.start instanceof Date?s.fixed_period.start.toISOString():s.fixed_period.start,end_time:s.fixed_period.end instanceof Date?s.fixed_period.end.toISOString():s.fixed_period.end}:void 0,calendar:s.calendar,rolling_window:s.rolling_window}),u=t=>t.callWS({type:"recorder/validate_statistics"}),h=(t,e,s)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:s}),_=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),p=t=>{let e=null;if(!t)return null;for(const s of t)null!==s.change&&void 0!==s.change&&(null===e?e=s.change:e+=s.change);return e},f=(t,e)=>{let s=null;for(const a of e){if(!(a in t))continue;const e=p(t[a]);null!==e&&(null===s?s=e:s+=e)}return s},m=(t,e)=>t.some((t=>void 0!==t[e]&&null!==t[e])),b=["mean","min","max"],g=["sum","state","change"],v=(t,e)=>!(!b.includes(e)||0===t.mean_type)||!(!g.includes(e)||!t.has_sum),y=(t,e,s,a,i)=>{const n=new Date(s).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:n,adjustment:a,adjustment_unit_of_measurement:i})},S=(t,e,s)=>{const i=t.states[e];return i?(0,a.C)(i):(null==s?void 0:s.name)||e},k=(t,e,s)=>{let a;var i;e&&(a=null===(i=t.states[e])||void 0===i?void 0:i.attributes.unit_of_measurement);return void 0===a?null==s?void 0:s.statistics_unit_of_measurement:a},C=t=>t.includes(":"),w=t=>t.callWS({type:"recorder/update_statistics_issues"})},6291:function(t,e,s){s.d(e,{f:()=>n});s(39710),s(26847),s(81738),s(72489),s(1455),s(56389),s(27530);var a=s(73742),i=s(7616);const n=t=>{class e extends t{connectedCallback(){super.connectedCallback(),this._checkSubscribed()}disconnectedCallback(){if(super.disconnectedCallback(),this.__unsubs){for(;this.__unsubs.length;){const t=this.__unsubs.pop();t instanceof Promise?t.then((t=>t())):t()}this.__unsubs=void 0}}updated(t){if(super.updated(t),t.has("hass"))this._checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const e of t.keys())if(this.hassSubscribeRequiredHostProps.includes(e))return void this._checkSubscribed()}hassSubscribe(){return[]}_checkSubscribed(){var t;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(t=this.hassSubscribeRequiredHostProps)&&void 0!==t&&t.some((t=>void 0===this[t]))||(this.__unsubs=this.hassSubscribe())}}return(0,a.__decorate)([(0,i.Cb)({attribute:!1})],e.prototype,"hass",void 0),e}},94412:function(t,e,s){s.d(e,{H:()=>n});s(20655);var a=s(45657),i=s(66169);function n(t,e,s,n,o,r){const c=t.getPropertyValue(o+"-"+r).trim(),d=c.length>0?c:t.getPropertyValue(o).trim();let l=(0,a.Rq)(d);return 0===c.length&&r&&(l=(0,a.CO)((0,a.p3)(e?(0,i.C)((0,a.Rw)((0,a.wK)(l)),r):(0,i.W)((0,a.Rw)((0,a.wK)(l)),r)))),n?l+=s?"32":"7F":s&&(l+="7F"),l}},94969:function(t,e,s){s.a(t,(async function(t,a){try{s.d(e,{J:()=>S,MC:()=>v,Zx:()=>C,b4:()=>y,kT:()=>w});s(24674),s(26847),s(2394),s(18574),s(20678),s(81738),s(94814),s(22960),s(6989),s(87799),s(67886),s(65451),s(46015),s(38334),s(94880),s(75643),s(29761),s(44261),s(27530);var i=s(38039),n=s(7722),o=s(46363),r=s(5280),c=s(2061),d=s(6483),l=s(73228),u=s(98853),h=s(11736),_=s(72937),p=s(28598),f=s(40142),m=s(45691),b=t([f,m,p]);function v(t,e){let s=new Date(e);return t>2&&0===s.getHours()&&(s=(0,i.b)(s,1)),s.setMinutes(0,0,0),t>35&&s.setDate(1),t>2&&s.setHours(0),s.getTime()}function y(t){return t>35?"month":t>2?"day":"hour"}function S(t,e,s,a,i,o,r,c){const d=(0,n.j)(e,t),l=void 0!==o&&void 0!==r;return{xAxis:{type:"time",min:t,max:v(d,e)},yAxis:{type:"value",name:i,nameGap:2,nameTextStyle:{align:"left"},axisLabel:{formatter:t=>(0,p.uf)(Math.abs(t),s)},splitLine:{show:!0}},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0},tooltip:{trigger:"axis",formatter:t=>{if(Array.isArray(t)){const e=[],n=[];return t.forEach((t=>{var s;null!==(s=t.seriesId)&&void 0!==s&&s.startsWith("compare-")?n.push(t):e.push(t)})),[e,n].map((t=>k(t,s,a,d,l,i,c))).filter(Boolean).join("<br><br>")}return k([t],s,a,d,l,i,c)}}}}function k(t,e,s,a,i,n,r){var c,d,l,u;if(null===(c=t[0])||void 0===c||!c.value)return"";const h=new Date(null!==(d=null===(l=t[0].value)||void 0===l?void 0:l[2])&&void 0!==d?d:null===(u=t[0].value)||void 0===u?void 0:u[0]);let _;_=a>89?`${(0,f.NC)(h,e,s)}`:a>0?`${(0,f.ud)(h,e,s)}`:`${i?`${(0,f.ud)(h,e,s)}: `:""}${(0,m.mr)(h,e,s)} â€“ ${(0,m.mr)((0,o.T)(h,1),e,s)}`;const b=`<h4 style="text-align: center; margin: 0;">${_}</h4>`;let g=0,v=0,y=0,S=0;const k=t.map((t=>{var s;const a=null===(s=t.value)||void 0===s?void 0:s[1],i=(0,p.uf)(a,e);return"0"!==i&&("bar"===t.componentSubType&&(a>0?(g+=a,v++):(y+=a,S++)),`${t.marker} ${t.seriesName}: ${i} ${n}`)})).filter(Boolean);let C="";return 0!==g&&v>1&&r&&(C+=`<br><b>${r(g)}</b>`),0!==y&&S>1&&r&&(C+=`<br><b>${r(y)}</b>`),k.length>0?`${b}${k.join("<br>")}${C}`:""}function C(t){Array.from(new Set(t.map((t=>t.data.map((t=>Number(t[0]))))).flat())).sort(((t,e)=>t-e)).forEach(((e,s)=>{const a={},i={};for(let u=t.length-1;u>=0;u--){var n,o,r,c,d;const h=t[u].data[s],_=h&&"object"==typeof h&&"value"in h?h:{value:h},p=null===(n=_.value)||void 0===n?void 0:n[0],f=null!==(o=t[u].stack)&&void 0!==o?o:"";var l;if(void 0!==p)if(Number(p)!==e)null===(l=t[u].data)||void 0===l||l.splice(s,0,{value:[e,0],itemStyle:{borderWidth:0}});else 0===(null===(r=_.value)||void 0===r?void 0:r[1])?t[u].data[s]=Object.assign(Object.assign({},_),{},{itemStyle:Object.assign(Object.assign({},_.itemStyle),{},{borderWidth:0})}):!a[f]&&(null===(c=_.value)||void 0===c?void 0:c[1])>0?(t[u].data[s]=Object.assign(Object.assign({},_),{},{itemStyle:Object.assign(Object.assign({},_.itemStyle),{},{borderRadius:[4,4,0,0]})}),a[f]=!0):!i[f]&&(null===(d=_.value)||void 0===d?void 0:d[1])<0&&(t[u].data[s]=Object.assign(Object.assign({},_),{},{itemStyle:Object.assign(Object.assign({},_.itemStyle),{},{borderRadius:[0,0,4,4]})}),i[f]=!0)}}))}function w(t,e){if(!e)return t=>t;const s=(0,r.o)(t,e);if(0!==s&&t.getTime()===(0,c.e)(t).getTime())return t=>(0,d.B)(t,s);const a=(0,l.d)(t,e);if(0!==a&&t.getTime()===(0,u.N)(t).getTime())return t=>(0,h.z)(t,a);const i=t.getTime()-e.getTime();return t=>(0,_.n)(t,i)}[f,m,p]=b.then?(await b)():b,a()}catch(g){a(g)}}))},99153:function(t,e,s){s.a(t,(async function(t,a){try{s.r(e),s.d(e,{HuiEnergyDevicesDetailGraphCard:()=>j});s(26847),s(2394),s(44438),s(18574),s(81738),s(94814),s(29981),s(22960),s(6989),s(93190),s(87799),s(64455),s(6202),s(27530);var i=s(73742),n=s(66386),o=s(26062),r=s(59048),c=s(7616),d=s(31733),l=s(28105),u=s(55815),h=s(94412),_=(s(31138),s(37008)),p=s(6640),f=s(7214),m=s(6291),b=s(93647),g=s(94969),v=s(9924),y=s(28598),S=t([_,p,y,g]);[_,p,y,g]=S.then?(await S)():S;let k,C,w,O=t=>t;const $="kWh";class j extends((0,m.f)(r.oi)){hassSubscribe(){var t;return[(0,p.UB)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe((t=>{this._data=t,this._processStatistics()}))]}getCardSize(){return 3}setConfig(t){this._config=t}shouldUpdate(t){return(0,b.SN)(this,t)||t.size>1||!t.has("hass")}willUpdate(t){(t.has("_hiddenStats")||t.has("_config"))&&this._data&&this._processStatistics()}render(){return this.hass&&this._config?(0,r.dy)(k||(k=O` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base .hass="${0}" .data="${0}" .options="${0}" @dataset-hidden="${0}" @dataset-unhidden="${0}"></ha-chart-base> </div> </ha-card> `),this._config.title?(0,r.dy)(C||(C=O`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,d.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,$,this._compareStart,this._compareEnd),this._datasetHidden,this._datasetUnhidden):r.Ld}_datasetHidden(t){this._hiddenStats=[...this._hiddenStats,t.detail.name]}_datasetUnhidden(t){this._hiddenStats=this._hiddenStats.filter((e=>e!==t.detail.name))}_processStatistics(){const t=this._data;this._start=t.start,this._end=t.end||(0,n.p)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare;const e=t.stats,s=t.statsCompare,a=getComputedStyle(this),i=t.prefs.device_consumption,o={};i.forEach((t=>{t.included_in_stat&&(o[t.included_in_stat]=o[t.included_in_stat]||[],o[t.included_in_stat].push(t.stat_consumption))}));const r={};t.prefs.device_consumption.forEach((t=>{const s=t.stat_consumption in e&&(0,f.Kj)(e[t.stat_consumption])||0;r[t.stat_consumption]=s}));const c={};t.prefs.device_consumption.forEach((t=>{c[t.stat_consumption]=(o[t.stat_consumption]||[]).reduce(((t,e)=>t-r[e]),r[t.stat_consumption])}));const d=t.prefs.device_consumption.map((t=>t.stat_consumption));d.sort(((t,e)=>c[e]-c[t]));const l=[],{summedData:u,compareSummedData:h}=(0,p.EH)(t),_="from_grid"in u||"solar"in u||"from_battery"in u,{consumption:m,compareConsumption:b}=_?(0,p.E4)(u,h):{consumption:void 0,compareConsumption:void 0};if(s){const e=this._processDataSet(a,s,t.statsMetadata,t.prefs.device_consumption,d,o,!0);if(l.push(...e),_){const t=this._processUntracked(a,e,b,!0);l.push(t)}}l.push({id:"compare-placeholder",type:"bar",stack:t.statsCompare?"devicesCompare":"devices",data:[]});const v=this._processDataSet(a,e,t.statsMetadata,t.prefs.device_consumption,d,o);if(l.push(...v),_){const t=this._processUntracked(a,v,m,!1);l.push(t)}(0,g.Zx)(l),this._chartData=l}_processUntracked(t,e,s,a){const i={};e.forEach((t=>{t.data.forEach((t=>{i[t[a?2:0]]=(i[t[a?2:0]]||0)+t[1]}))}));const n=(0,g.kT)(this._start,this._compareStart),o=[];Object.keys(s.used_total).sort(((t,e)=>Number(t)-Number(e))).forEach((t=>{const e=Number(t),r=[e,s.used_total[t]-(i[t]||0)];a&&(r[2]=r[0],r[0]=n(new Date(e)).getTime()),o.push(r)}));const r=Date.now();return{type:"bar",cursor:"default",id:a?`compare-untracked-${r}`:`untracked-${r}`,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),itemStyle:{borderColor:(0,h.H)(t,this.hass.themes.darkMode,!1,a,"--state-unavailable-color")},barMaxWidth:50,color:(0,h.H)(t,this.hass.themes.darkMode,!0,a,"--state-unavailable-color"),data:o,stack:a?"devicesCompare":"devices"}}_processDataSet(t,e,s,a,i,n,o=!1){const r=[],c=(0,g.kT)(this._start,this._compareStart);return a.forEach(((a,d)=>{var l;const h=i.indexOf(a.stat_consumption);if(null!==(l=this._config)&&void 0!==l&&l.max_devices&&h>=this._config.max_devices)return void console.warn(`Max devices exceeded for ${a.name} (${h} >= ${this._config.max_devices})`);const _=(0,u.hZ)(d,t);let p=null;const m=[];if(a.stat_consumption in e){const t=e[a.stat_consumption];for(const s of t){if(null===s.change||void 0===s.change||0===s.change)continue;if(p===s.start)continue;let t=0;(n[a.stat_consumption]||[]).forEach((a=>{var i;const n=e[a];t+=(null==n||null===(i=n.find((t=>t.start===s.start)))||void 0===i?void 0:i.change)||0}));const i=[s.start,s.change-t];o&&(i[2]=i[0],i[0]=c(new Date(s.start)).getTime()),m.push(i),p=s.start}}const b=(a.name||(0,f.Kd)(this.hass,a.stat_consumption,s[a.stat_consumption]))+(a.stat_consumption in n?` (${this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked")})`:"");r.push({type:"bar",cursor:"default",id:o?`compare-${a.stat_consumption}-${h}`:`${a.stat_consumption}-${h}`,name:b,itemStyle:{borderColor:o?_+"7F":_},barMaxWidth:50,color:o?_+"32":_+"7F",data:m,stack:o?"devicesCompare":"devices"})})),i.map((t=>r.find((e=>this._getStatIdFromId(e.id)===t)))).filter(Boolean)}_getStatIdFromId(t){return t.replace(/^compare-/,"").replace(/-\d+$/,"")}constructor(...t){super(...t),this._chartData=[],this._start=(0,o.I)(),this._end=(0,n.p)(),this._hiddenStats=[],this.hassSubscribeRequiredHostProps=["_config"],this._formatTotal=t=>this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,y.uf)(t,this.hass.locale),unit:$}),this._createOptions=(0,l.Z)(((t,e,s,a,i,n,o)=>{const r=(0,g.J)(t,e,s,a,i,n,o,this._formatTotal);return Object.assign(Object.assign({},r),{},{legend:{show:!0,type:"scroll",animationDurationUpdate:400,selected:this._hiddenStats.reduce(((t,e)=>(t[e]=!1,t)),{}),icon:"circle"},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0}})}))}}j.styles=(0,r.iv)(w||(w=O`.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}`)),(0,i.__decorate)([(0,c.Cb)({attribute:!1})],j.prototype,"hass",void 0),(0,i.__decorate)([(0,c.SB)()],j.prototype,"_config",void 0),(0,i.__decorate)([(0,c.SB)()],j.prototype,"_chartData",void 0),(0,i.__decorate)([(0,c.SB)()],j.prototype,"_data",void 0),(0,i.__decorate)([(0,c.SB)()],j.prototype,"_start",void 0),(0,i.__decorate)([(0,c.SB)()],j.prototype,"_end",void 0),(0,i.__decorate)([(0,c.SB)()],j.prototype,"_compareStart",void 0),(0,i.__decorate)([(0,c.SB)()],j.prototype,"_compareEnd",void 0),(0,i.__decorate)([(0,v.t)({key:"energy-devices-hidden-stats",state:!0,subscribe:!1})],j.prototype,"_hiddenStats",void 0),j=(0,i.__decorate)([(0,c.Mo)("hui-energy-devices-detail-graph-card")],j),a()}catch(k){a(k)}}))}}]);
//# sourceMappingURL=66521.c68a6210bdde560d.js.map