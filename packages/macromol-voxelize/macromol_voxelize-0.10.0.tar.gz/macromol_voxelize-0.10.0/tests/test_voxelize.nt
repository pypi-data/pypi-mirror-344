test_get_voxel_center_coords:
  -
    id: grid-1
    grid: 1
    voxels:
      > 0 0 0
    coords:
      > 0 0 0
  -
    id: grid-2
    grid: 2
    voxels:
      > 0 0 0
      > 0 0 1
      > 0 1 0
      > 0 1 1
      > 1 0 0
      > 1 0 1
      > 1 1 0
      > 1 1 1
    coords:
      > -0.5 -0.5 -0.5
      > -0.5 -0.5  0.5
      > -0.5  0.5 -0.5
      > -0.5  0.5  0.5
      >  0.5 -0.5 -0.5
      >  0.5 -0.5  0.5
      >  0.5  0.5 -0.5
      >  0.5  0.5  0.5
  -
    id: grid-3
    grid: 3
    voxels:
      > 0 0 0
      > 0 0 1
      > 0 0 2
      > 0 1 0
      > 0 1 1
      > 0 1 2
      > 0 2 0
      > 0 2 1
      > 0 2 2

      > 1 0 0
      > 1 0 1
      > 1 0 2
      > 1 1 0
      > 1 1 1
      > 1 1 2
      > 1 2 0
      > 1 2 1
      > 1 2 2

      > 2 0 0
      > 2 0 1
      > 2 0 2
      > 2 1 0
      > 2 1 1
      > 2 1 2
      > 2 2 0
      > 2 2 1
      > 2 2 2

    coords:
      > -1 -1 -1
      > -1 -1  0
      > -1 -1  1
      > -1  0 -1
      > -1  0  0
      > -1  0  1
      > -1  1 -1
      > -1  1  0
      > -1  1  1

      >  0 -1 -1
      >  0 -1  0
      >  0 -1  1
      >  0  0 -1
      >  0  0  0
      >  0  0  1
      >  0  1 -1
      >  0  1  0
      >  0  1  1

      >  1 -1 -1
      >  1 -1  0
      >  1 -1  1
      >  1  0 -1
      >  1  0  0
      >  1  0  1
      >  1  1 -1
      >  1  1  0
      >  1  1  1
  -
    id: resolution
    grid:
      length_voxels: 2
      resolution_A: 0.5
    voxels:
      > 0 0 0
      > 0 0 1
      > 0 1 0
      > 0 1 1
      > 1 0 0
      > 1 0 1
      > 1 1 0
      > 1 1 1
    coords:
      > -0.25 -0.25 -0.25
      > -0.25 -0.25  0.25
      > -0.25  0.25 -0.25
      > -0.25  0.25  0.25
      >  0.25 -0.25 -0.25
      >  0.25 -0.25  0.25
      >  0.25  0.25 -0.25
      >  0.25  0.25  0.25
  -
    id: center
    grid:
      length_voxels: 2
      center_A: 1 2 3
    voxels:
      > 0 0 0
      > 0 0 1
      > 0 1 0
      > 0 1 1
      > 1 0 0
      > 1 0 1
      > 1 1 0
      > 1 1 1
    coords:
      > 0.5 1.5 2.5
      > 0.5 1.5 3.5
      > 0.5 2.5 2.5
      > 0.5 2.5 3.5
      > 1.5 1.5 2.5
      > 1.5 1.5 3.5
      > 1.5 2.5 2.5
      > 1.5 2.5 3.5
  -
    id: everything-2
    grid:
      length_voxels: 2
      resolution_A: 0.5
      center_A: 1 2 3
    voxels:
      > 0 0 0
      > 0 0 1
      > 0 1 0
      > 0 1 1
      > 1 0 0
      > 1 0 1
      > 1 1 0
      > 1 1 1
    coords:
      > 0.75 1.75 2.75
      > 0.75 1.75 3.25
      > 0.75 2.25 2.75
      > 0.75 2.25 3.25
      > 1.25 1.75 2.75
      > 1.25 1.75 3.25
      > 1.25 2.25 2.75
      > 1.25 2.25 3.25
  -
    id: everything-3
    grid:
      length_voxels: 3
      resolution_A: 0.5
      center_A: 1 2 3

    voxels:
      > 0 0 0
      > 0 0 1
      > 0 0 2
      > 0 1 0
      > 0 1 1
      > 0 1 2
      > 0 2 0
      > 0 2 1
      > 0 2 2

      > 1 0 0
      > 1 0 1
      > 1 0 2
      > 1 1 0
      > 1 1 1
      > 1 1 2
      > 1 2 0
      > 1 2 1
      > 1 2 2

      > 2 0 0
      > 2 0 1
      > 2 0 2
      > 2 1 0
      > 2 1 1
      > 2 1 2
      > 2 2 0
      > 2 2 1
      > 2 2 2

    coords:
      > 0.5 1.5 2.5
      > 0.5 1.5 3.0
      > 0.5 1.5 3.5
      > 0.5 2.0 2.5
      > 0.5 2.0 3.0
      > 0.5 2.0 3.5
      > 0.5 2.5 2.5
      > 0.5 2.5 3.0
      > 0.5 2.5 3.5

      > 1.0 1.5 2.5
      > 1.0 1.5 3.0
      > 1.0 1.5 3.5
      > 1.0 2.0 2.5
      > 1.0 2.0 3.0
      > 1.0 2.0 3.5
      > 1.0 2.5 2.5
      > 1.0 2.5 3.0
      > 1.0 2.5 3.5
      >
      > 1.5 1.5 2.5
      > 1.5 1.5 3.0
      > 1.5 1.5 3.5
      > 1.5 2.0 2.5
      > 1.5 2.0 3.0
      > 1.5 2.0 3.5
      > 1.5 2.5 2.5
      > 1.5 2.5 3.0
      > 1.5 2.5 3.5

test_discard_atoms_outside_image:
  -
    atoms:
      > c r    x     y     z
      > 0 0.5  1.49  0     0
      > 0 0.5 -1.49  0     0
      > 0 0.5  1.51  0     0
      > 0 0.5 -1.51  0     0
      > 0 0.5  0     1.49  0
      > 0 0.5  0    -1.49  0
      > 0 0.5  0     1.51  0
      > 0 0.5  0    -1.51  0
      > 0 0.5  0     0     1.49
      > 0 0.5  0     0    -1.49
      > 0 0.5  0     0     1.51
      > 0 0.5  0     0    -1.51

    img_params:
      grid: 2

    expected:
      > c r    x     y     z
      > 0 0.5  1.49  0     0
      > 0 0.5 -1.49  0     0
      > 0 0.5  0     1.49  0
      > 0 0.5  0    -1.49  0
      > 0 0.5  0     0     1.49
      > 0 0.5  0     0    -1.49
  -
    atoms:
      > c  x     y     z
      > 0  1.49  0     0
      > 0 -1.49  0     0
      > 0  1.51  0     0
      > 0 -1.51  0     0
      > 0  0     1.49  0
      > 0  0    -1.49  0
      > 0  0     1.51  0
      > 0  0    -1.51  0
      > 0  0     0     1.49
      > 0  0     0    -1.49
      > 0  0     0     1.51
      > 0  0     0    -1.51

    img_params:
      grid: 2
      max_radius_A: 0.5

    expected:
      > c  x     y     z
      > 0  1.49  0     0
      > 0 -1.49  0     0
      > 0  0     1.49  0
      > 0  0    -1.49  0
      > 0  0     0     1.49
      > 0  0     0    -1.49

test_discard_voxels_outside_image:
  -
    grid: 1
    voxels:
      > -1 -1 -1
      > -1 -1  0
      > -1 -1  1
      > -1  0 -1
      > -1  0  0
      > -1  0  1
      > -1  1 -1
      > -1  1  0
      > -1  1  1

      >  0 -1 -1
      >  0 -1  0
      >  0 -1  1
      >  0  0 -1
      >  0  0  0
      >  0  0  1
      >  0  1 -1
      >  0  1  0
      >  0  1  1

      >  1 -1 -1
      >  1 -1  0
      >  1 -1  1
      >  1  0 -1
      >  1  0  0
      >  1  0  1
      >  1  1 -1
      >  1  1  0
      >  1  1  1

    expected:
      > 0 0 0
  -
    grid: 2
    voxels:
      > -1 -1 -1
      > -1 -1  0
      > -1 -1  1
      > -1 -1  2
      > -1  0 -1
      > -1  0  0
      > -1  0  1
      > -1  0  2
      > -1  1 -1
      > -1  1  0
      > -1  1  1
      > -1  1  2
      > -1  2 -1
      > -1  2  0
      > -1  2  1
      > -1  2  2

      >  0 -1 -1
      >  0 -1  0
      >  0 -1  1
      >  0 -1  2
      >  0  0 -1
      >  0  0  0
      >  0  0  1
      >  0  0  2
      >  0  1 -1
      >  0  1  0
      >  0  1  1
      >  0  1  2
      >  0  2 -1
      >  0  2  0
      >  0  2  1
      >  0  2  2

      >  1 -1 -1
      >  1 -1  0
      >  1 -1  1
      >  1 -1  2
      >  1  0 -1
      >  1  0  0
      >  1  0  1
      >  1  0  2
      >  1  1 -1
      >  1  1  0
      >  1  1  1
      >  1  1  2
      >  1  2 -1
      >  1  2  0
      >  1  2  1
      >  1  2  2

      >  2 -1 -1
      >  2 -1  0
      >  2 -1  1
      >  2 -1  2
      >  2  0 -1
      >  2  0  0
      >  2  0  1
      >  2  0  2
      >  2  1 -1
      >  2  1  0
      >  2  1  1
      >  2  1  2
      >  2  2 -1
      >  2  2  0
      >  2  2  1
      >  2  2  2

    expected:
      >  0  0  0
      >  0  0  1
      >  0  1  0
      >  0  1  1
      >  1  0  0
      >  1  0  1
      >  1  1  0
      >  1  1  1

test_find_voxels_containing_coords:
  -
    id: grid-2-edges
    grid: 2
    coords:
      > -0.50 -0.50 -0.01
      > -0.50 -0.50  0.01
      > -0.50 -0.01 -0.50
      > -0.50  0.01 -0.50
      > -0.01 -0.50 -0.50
      >  0.01 -0.50 -0.50
    voxels:
      > 0 0 0
      > 0 0 1
      > 0 0 0
      > 0 1 0
      > 0 0 0
      > 1 0 0
  -
    id: grid-3-edges
    grid: 3
    coords:
      > -0.51  0     0
      > -0.49  0     0
      >  0.49  0     0
      >  0.51  0     0

      >  0    -0.51  0
      >  0    -0.49  0
      >  0     0.49  0
      >  0     0.51  0

      >  0     0    -0.51
      >  0     0    -0.49
      >  0     0     0.49
      >  0     0     0.51

    voxels:
      > 0 1 1
      > 1 1 1
      > 1 1 1
      > 2 1 1

      > 1 0 1
      > 1 1 1
      > 1 1 1
      > 1 2 1

      > 1 1 0
      > 1 1 1
      > 1 1 1
      > 1 1 2
  -
    id: resolution-edges
    grid:
      length_voxels: 2
      resolution_A: 0.5
    coords:
      > -0.25 -0.25 -0.01
      > -0.25 -0.25  0.01
      > -0.25 -0.01 -0.25
      > -0.25  0.01 -0.25
      > -0.01 -0.25 -0.25
      >  0.01 -0.25 -0.25
    voxels:
      > 0 0 0
      > 0 0 1
      > 0 0 0
      > 0 1 0
      > 0 0 0
      > 1 0 0
  -
    id: center-edges
    grid:
      length_voxels: 2
      center_A: 1 2 3
    coords:
      > 0.50 1.50 2.99
      > 0.50 1.50 3.01
      > 0.50 1.99 2.50
      > 0.50 2.01 2.50
      > 0.99 1.50 2.50
      > 1.01 1.50 2.50
    voxels:
      > 0 0 0
      > 0 0 1
      > 0 0 0
      > 0 1 0
      > 0 0 0
      > 1 0 0
  -
    id: everything-2-edges
    grid:
      length_voxels: 2
      resolution_A: 0.5
      center_A: 1 2 3
    coords:
      > 0.75 1.75 2.99
      > 0.75 1.75 3.01
      > 0.75 1.99 2.75
      > 0.75 2.01 2.75
      > 0.99 1.75 2.75
      > 1.01 1.75 2.75
    voxels:
      > 0 0 0
      > 0 0 1
      > 0 0 0
      > 0 1 0
      > 0 0 0
      > 1 0 0
  -
    id: everything-3-edges
    grid:
      length_voxels: 3
      resolution_A: 0.5
      center_A: 1 2 3

    coords:
      > 0.50 1.50 2.74
      > 0.50 1.50 2.76
      > 0.50 1.50 3.24
      > 0.50 1.50 3.26

      > 0.50 1.74 2.50
      > 0.50 1.76 2.50
      > 0.50 2.24 2.50
      > 0.50 2.26 2.50

      > 0.74 1.50 2.50
      > 0.76 1.50 2.50
      > 1.24 1.50 2.50
      > 1.26 1.50 2.50

    voxels:
      > 0 0 0
      > 0 0 1
      > 0 0 1
      > 0 0 2

      > 0 0 0
      > 0 1 0
      > 0 1 0
      > 0 2 0

      > 0 0 0
      > 1 0 0
      > 1 0 0
      > 2 0 0

test_find_voxels_possibly_contacting_sphere:
  -
    id: grid-1
    grid: 1
    sphere:
      center_A: 0 0 0
      radius_A: 1
    expected:
      min_index: 0 0 0
      max_index: 0 0 0
  -
    id: grid-2
    grid: 2
    sphere:
      center_A: 0 0 0
      radius_A: 1
    expected:
      min_index: 0 0 0
      max_index: 1 1 1
  -
    id: grid-3
    grid: 3
    sphere:
      center_A: 0 0 0 
      radius_A: 1
    expected:
      min_index: 0 0 0
      max_index: 2 2 2
  -
    id: radius-0.49
    grid: 3
    sphere:
      center_A: 0 0 0 
      radius_A: 0.49
    expected:
      min_index: 1 1 1
      max_index: 1 1 1
  -
    id: radius-0.51
    grid: 3
    sphere:
      center_A: 0 0 0 
      radius_A: 0.51
    expected:
      min_index: 0 0 0
      max_index: 2 2 2
  -
    id: center-xyz-0.49
    grid: 3
    sphere:
      center_A: 0.49 0.49 0.49 
      radius_A: 0.98
    expected:
      min_index: 1 1 1
      max_index: 2 2 2
  -
    id: center-x-0.49
    grid: 3
    sphere:
      center_A: 0.49 0 0 
      radius_A: 0.98
    expected:
      min_index: 1 0 0
      max_index: 2 2 2
  -
    id: center-y-0.49
    grid: 3
    sphere:
      center_A: 0 0.49 0 
      radius_A: 0.98
    expected:
      min_index: 0 1 0
      max_index: 2 2 2
  -
    id: center-z-0.49
    grid: 3
    sphere:
      center_A: 0 0 0.49
      radius_A: 0.98
    expected:
      min_index: 0 0 1
      max_index: 2 2 2
  -
    id: outside-image

    # I initially thought that this test case was triggering a bug, because the 
    # sum of all the overlaps was much less than the volume of the sphere.  It 
    # turns out this sphere is just partially outside the image; i.e. the 
    # voxel index "21" is out of bounds.
    #
    # I ended up deciding to change the `_find_voxels_possibly...()` function 
    # to return voxels that are outside the image, because this ended up 
    # simplifying the code and (I think) doing a better job of separating 
    # responsibilities.  This change incidentally caused this test case to 
    # pass, so I decided to keep it.  It's nice having test cases with 
    # "off-center" values, and I did validate these values by hand.

    grid:
      length_voxels: 21
      resolution_A: 0.75
      center_A: 0 0 0
    sphere:
      center_A: -4.89861 8.102 -7.10428
      radius_A: 0.375
    expected:
      min_index: 3 20 0
      max_index: 4 21 1

test_add_atom_to_image:
  -
    id: overlap-1
    img_params:
      grid: 3
    atom:
      center_A: 0 0 0
      radius_A: 0.5
      channels: 0
    expected:
      0 1 1 1: 1
  -
    id: overlap-2
    img_params:
      grid: 3
    atom:
      center_A: 0.5 0 0
      radius_A: 0.5
      channels: 0
    expected:
      0 1 1 1: 1/2
      0 2 1 1: 1/2
  -
    id: overlap-4
    img_params:
      grid: 3
    atom:
      center_A: 0.5 0.5 0
      radius_A: 0.5
      channels: 0
    expected:
      0 1 1 1: 1/4
      0 2 1 1: 1/4
      0 1 2 1: 1/4
      0 2 2 1: 1/4
  -
    id: overlap-8
    img_params:
      grid: 3
    atom:
      center_A: 0.5 0.5 0.5
      radius_A: 0.5
      channels: 0
    expected:
      0 1 1 1: 1/8
      0 2 1 1: 1/8
      0 1 2 1: 1/8
      0 2 2 1: 1/8
      0 1 1 2: 1/8
      0 2 1 2: 1/8
      0 1 2 2: 1/8
      0 2 2 2: 1/8
  -
    id: channel-1-2
    img_params:
      grid: 3
      channels: 2
    atom:
      center_A: 0 0 0
      radius_A: 0.5
      channels: 1
    expected:
      1 1 1 1: 1
  -
    id: channel-2-3
    img_params:
      grid: 3
      channels: 3
    atom:
      center_A: 0 0 0
      radius_A: 0.5
      channels: 0 2
    expected:
      0 1 1 1: 1
      2 1 1 1: 1
  -
    id: occupancy
    img_params:
      grid: 3
    atom:
      center_A: 0 0 0
      radius_A: 0.5
      channels: 0
      occupancy: 0.5
    expected:
      0 1 1 1: 0.5
  -
    id: fill-overlap-A3
    img_params:
      grid:
        length_voxels: 3
        resolution_A: 2
      fill_algorithm: OverlapA3
    atom:
      center_A: 0 0 0
      radius_A: 1
      channels: 0
    expected:
      0 1 1 1: 4/3 * pi
  -
    id: fill-fraction-atom
    img_params:
      grid:
        length_voxels: 3
        resolution_A: 2
      fill_algorithm: FractionAtom
    atom:
      center_A: 0 0 0
      radius_A: 1
      channels: 0
    expected:
      0 1 1 1: 1
  -
    id: fill-fraction-voxel
    img_params:
      grid:
        length_voxels: 3
        resolution_A: 2
      fill_algorithm: FractionVoxel
    atom:
      center_A: 0 0 0
      radius_A: 1
      channels: 0
    expected:
      0 1 1 1: 4/3 * pi / 2**3

test_image_from_atoms:
  -
    id: overlap-none
    atoms:
      > c r    x    y    z
      > 0 0.5  0.0 -0.5 -0.5
      > 1 0.5  0.0  0.5  0.5
    img_params:
      grid: 2
      channels: 2
    expected:
      0 0 0 0: 1/2
      0 1 0 0: 1/2
      1 0 1 1: 1/2
      1 1 1 1: 1/2
  -
    id: overlap-partial
    atoms:
      > c r    x    y    z
      > 0 0.5  0.0 -0.5 -0.5
      > 1 0.5 -0.5  0.0 -0.5
    img_params:
      grid: 2
      channels: 2
    expected:
      0 0 0 0: 1/2
      0 1 0 0: 1/2
      1 0 0 0: 1/2
      1 0 1 0: 1/2
  -
    id: overlap-complete
    atoms:
      > c r    x    y    z
      > 0 0.5  0.0 -0.5 -0.5
      > 1 0.5  0.0 -0.5 -0.5
    img_params:
      grid: 2
      channels: 2
    expected:
      0 0 0 0: 1/2
      0 1 0 0: 1/2
      1 0 0 0: 1/2
      1 1 0 0: 1/2
  -
    id: channels-2
    atoms:
      > c   r    x    y    z
      > 0,1 0.5  0.0 -0.5 -0.5
    img_params:
      grid: 2
      channels: 2
    expected:
      0 0 0 0: 1/2
      0 1 0 0: 1/2
      1 0 0 0: 1/2
      1 1 0 0: 1/2
  -
    id: out-of-bounds-partial
    atoms:
      > c r    x    y    z
      > 0 0.5 -1.0 -0.5 -0.5
    img_params:
      grid: 2
    expected:
      0 0 0 0: 1/2
  -
    id: out-of-bounds-complete
    atoms:
      > c r    x    y    z
      > 0 0.5 -1.5 -0.5 -0.5
    img_params:
      grid: 2
    expected:
      {}
  -
    id: dtype-float32
    atoms:
      > c r    x    y    z
      > 0 0.5  0.0 -0.5 -0.5
      > 1 0.5  0.0  0.5  0.5
    img_params:
      grid: 2
      channels: 2
      dtype: np.float32
    expected:
      0 0 0 0: 1/2
      0 1 0 0: 1/2
      1 0 1 1: 1/2
      1 1 1 1: 1/2
  -
    id: dtype-float64
    atoms:
      > c r    x    y    z
      > 0 0.5  0.0 -0.5 -0.5
      > 1 0.5  0.0  0.5  0.5
    img_params:
      grid: 2
      channels: 2
      dtype: np.float64
    expected:
      0 0 0 0: 1/2
      0 1 0 0: 1/2
      1 0 1 1: 1/2
      1 1 1 1: 1/2
  -
    id: agg-sum
    atoms:
      > c r    x    y    z
      > 0 0.5 -0.5 -0.5 -0.5
      > 0 0.5  0.0 -0.5 -0.5
    img_params:
      grid: 2
      channels: 1
      agg_algorithm: Sum
    expected:
      0 0 0 0: 3/2
      0 1 0 0: 1/2
  -
    id: agg-max
    atoms:
      > c r    x    y    z
      > 0 0.5 -0.5 -0.5 -0.5
      > 0 0.5  0.0 -0.5 -0.5
    img_params:
      grid: 2
      channels: 1
      agg_algorithm: Max
    expected:
      0 0 0 0: 1
      0 1 0 0: 1/2

test_check_channels:
  -
    id: ok
    atoms:
      > c
      > 0
      > 1
    num_channels: 2
    error: none
  -
    id: too-small
    atoms:
      > c
      > 0
      > -1
    num_channels: 2
    error:
      type: ValidationError
      message: channel indices must be between 0 and 1, not -1
  -
    id: too-big
    atoms:
      > c
      > 0
      > 2
    num_channels: 2
    error:
      type: ValidationError
      message: channel indices must be between 0 and 1, not 2

test_check_max_radius_A:
  -
    id: ok
    atoms:
      > r
      > 1
      > 1
    max_radius_A: 1
    error: none
  -
    id: too-big
    atoms:
      > r
      > 1
      > 1
    max_radius_A: 0.99
    error:
      type: ValidationError
      message: atom radii must not exceed

test_set_atom_radius_A:
  -
    atoms:
      > x y z
      > 1 2 3
    radius: 0.5
    expected:
      > x y z r   
      > 1 2 3 0.5 

test_set_atom_channels_by_element:
  -
    id: channels-distinct
    atoms:
      > element x y z
      > N       1 2 3
      > C       2 3 4
      > C       3 4 5
      > O       4 5 6
    channels:
      [[C], [N], [O]]
    expected:
      > element x y z c
      > N       1 2 3 1
      > C       2 3 4 0
      > C       3 4 5 0
      > O       4 5 6 2
  -
    id: channels-overlapping
    atoms:
      > element x y z
      > N       1 2 3
      > C       2 3 4
      > C       3 4 5
      > O       4 5 6
    channels:
      [[C], [N, O]]
    expected:
      > element x y z c
      > N       1 2 3 1
      > C       2 3 4 0
      > C       3 4 5 0
      > O       4 5 6 1
  -
    id: channels-star
    atoms:
      > element x y z
      > N       1 2 3
      > C       2 3 4
      > C       3 4 5
      > O       4 5 6
    channels:
      [[C], [*]]
    expected:
      > element x y z c
      > N       1 2 3 1
      > C       2 3 4 0
      > C       3 4 5 0
      > O       4 5 6 1
  -
    id: channels-substr-match
    # This test case was more relevant when I was using regular expressions to 
    # match element names, but there's no reason to get rid of it.
    atoms:
      > element x y z
      > S       1 2 3
      > SE      2 3 4
      > SI      3 4 5
    channels:
      [[S, SE]]
    kwargs:
      drop_missing_atoms: True
    expected:
      > element x y z c
      > S       1 2 3 0
      > SE      2 3 4 0
  -
    id: missing-atoms-err
    atoms:
      > element x y z
      > N       1 2 3
      > C       2 3 4
      > C       3 4 5
      > S       4 5 6
    channels:
      [[C], [N], [O]]
    error:
      type: ValidationError
      message:
        - all atoms must be assigned at least one channel
        - channels: [['C'], ['N'], ['O']]
        - unassigned elements: ['S']
  -
    id: missing-atoms-drop
    atoms:
      > element x y z
      > N       1 2 3
      > C       2 3 4
      > C       3 4 5
      > S       4 5 6
    channels:
      [[C], [N], [O]]
    kwargs:
      drop_missing_atoms: True
    expected:
      > element x y z c
      > N       1 2 3 1
      > C       2 3 4 0
      > C       3 4 5 0
  -
    id: err-str-not-list
    atoms:
      > element x y z
      > N       3 4 5
      > C       1 2 3
      > C       2 3 4
      > O       4 5 6
    channels:
      [C, N, O]
    error:
      type: ValidationError
      message:
        - expected list of elements, found str: 'C'

test_find_occupied_voxels:
  -
    id: atoms-1-occupied-1x1x1
    atoms:
      > c r      x    y    z
      > 0 0.49  -0.5 -0.5 -0.5
    img_params:
      grid: 4
    expected:
     - ...
     - slice(1, 2)
     - slice(1, 2)
     - slice(1, 2)
  -
    id: atoms-1-occupied-1x1x2
    atoms:
      > c r      x    y    z
      > 0 0.49  -0.5 -0.5  0
    img_params:
      grid: 4
    expected:
     - ...
     - slice(1, 2)
     - slice(1, 2)
     - slice(1, 3)
  -
    id: atoms-1-occupied-1x2x2
    atoms:
      > c r      x    y    z
      > 0 0.49  -0.5  0    0
    img_params:
      grid: 4
    expected:
     - ...
     - slice(1, 2)
     - slice(1, 3)
     - slice(1, 3)
  -
    id: atoms-1-occupied-2x2x2
    atoms:
      > c r      x    y    z
      > 0 0.49   0    0    0
    img_params:
      grid: 4
    expected:
     - ...
     - slice(1, 3)
     - slice(1, 3)
     - slice(1, 3)
  -
    id: atoms-2-occupied-2x2x2
    atoms:
      > c r      x    y    z
      > 0 0.49  -0.5 -0.5 -0.5
      > 1 0.49   0.5  0.5  0.5
    img_params:
      grid: 4
      channels: 2
    expected:
     - ...
     - slice(1, 3)
     - slice(1, 3)
     - slice(1, 3)
  -
    id: boundary-negative
    atoms:
      > c r      x    y    z
      > 0 0.49  -2.0 -0.5 -0.5
    img_params:
      grid: 4
    expected:
     - ...
     - slice(0, 1)
     - slice(1, 2)
     - slice(1, 2)
  -
    id: boundary-positive
    atoms:
      > c r      x    y    z
      > 0 0.49   2.0 -0.5 -0.5
    img_params:
      grid: 4
    expected:
     - ...
     - slice(3, 4)
     - slice(1, 2)
     - slice(1, 2)
