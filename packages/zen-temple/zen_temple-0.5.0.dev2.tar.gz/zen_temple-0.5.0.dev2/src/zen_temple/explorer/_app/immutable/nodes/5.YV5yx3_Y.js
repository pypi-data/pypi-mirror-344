import"../chunks/CWj6FrbW.js";import{p as at,a as i,b as T,s as f,f as ie,c as lt,d as p,e as a,g as e,u as K,r as g,h as Re}from"../chunks/DJ4-OfXg.js";import{s as Fe}from"../chunks/DpcWkFIJ.js";import{i as z,b as We}from"../chunks/DU3kBxd7.js";import{e as ot,i as rt}from"../chunks/DEb5Yw0n.js";import{t as h,a as m}from"../chunks/BBucZf18.js";import{d as it}from"../chunks/Bcqz6BHu.js";import{S as st,b as I,c as nt}from"../chunks/Cf3ghc6X.js";import{A as dt}from"../chunks/Czz333MM.js";import{f as J,B as Be}from"../chunks/UUmwxa9-.js";import{D as Ee}from"../chunks/BWiL5A4Q.js";import{g as Q}from"../chunks/CqS7hfz2.js";import{T as ct}from"../chunks/D0AwY0i3.js";var ut=h("<option> </option>"),_t=h('<h3>Carrier</h3> <select class="form-select"><!> </select> <h3>Year</h3> <!> <h3>Smoothing Window Size</h3> <!>',1),vt=h('<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">Data Selection</button></h2> <div id="collapseThree" class="accordion-collapse collapse show"><div class="accordion-body"><h3>Technology Subdivision</h3> <!> <h3>Node</h3> <!></div></div></div>'),pt=h('<div class="accordion-item variable-selction"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Variable Selection</button></h2> <div id="collapseTwo" class="accordion-collapse collapse show"><div class="accordion-body"><!></div></div></div> <!>',1),gt=h('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ft=h('<div class="text-center">No technologies with this selection.</div>'),mt=h('<div class="text-center">No carriers with this selection.</div>'),ht=h('<div class="text-center">No solution selected.</div>'),bt=h('<div class="text-center">No data with this selection.</div>'),yt=h('<div class="text-center">No locations with this selection.</div>'),wt=h('<div class="text-center">No data with this selection.</div>'),xt=h("<!> <!>",1),St=h('<h2>The Energy Balance Storage</h2> <div class="position-relative z-1"><div class="filters"><div class="accordion" id="accordionExample"><div class="accordion-item solution-selection"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Solution Selection</button></h2> <div id="collapseOne" class="accordion-collapse collapse show"><div class="accordion-body"><!></div></div></div> <!></div></div></div> <div class="mt-4"><!></div>',1);function Et(Pe,Ze){at(Ze,!0);let x=i(null),se=i(null),ne=i(null),L=i(null),V=i(null),k=i(null),U=i(null),X=i(null),he=i(null),be=i(null),j=i(T([])),W=i(T([])),R=i(T([])),ye=i(T({})),n=i(null);const Me="storage_level";let B=i(null),$=[],E=i(T([])),C=i(!1),S=i(!1),de=i(""),He="",ce=i(!0),ee=i(T([])),te=i(0);const Ke=["Hourly","Daily","Weekly","Monthly"];let ue=i("Hourly"),ae,le,Y=i(T([])),_e=i(T([])),P=i(T([])),we=K(()=>e(R).length>0?e(ye)[e(R)[0]]:""),Le=K(()=>({type:"line",data:{datasets:e(Y),labels:e(P)},options:{animation:!1,normalized:!0,elements:{point:{radius:0}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`Storage Level [${e(we)}]`}}},borderWidth:1,plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:t=>{le.zoom_rect(t.chart.scales.x.min,t.chart.scales.x.max)}},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:t=>{le.zoom_rect(t.chart.scales.x.min,t.chart.scales.x.max)}},limits:{x:{minRange:10}}}}}})),Ve=K(()=>({counter:1,type:"line",data:{datasets:e(_e),labels:e(P)},options:{animation:!1,normalized:!0,elements:{point:{radius:0}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{type:"linear",stacked:!0,beginAtZero:!0,title:{display:!0,text:`Storage Flow [${e(we)}]`}}},borderWidth:1,plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:t=>{ae.zoom_rect(t.chart.scales.x.min,t.chart.scales.x.max)}},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:t=>{ae.zoom_rect(t.chart.scales.x.min,t.chart.scales.x.max)}},limits:{x:{minRange:10}}}}}}));function xe(){a(E,e(W),!0),$=e(R)}async function Se(){var D;if(a(x,null),e(n)===null)return;let t=Math.floor((e(te)-e(n).detail.system.reference_year)/e(n).detail.system.interval_between_years),o=1;switch(e(ue)){case"Daily":o=24;break;case"Weekly":o=168;break;case"Monthly":o=720;break}const[c,b,l,_,u]=await Promise.all([I(e(n).solution_name,Q("storage_level"),e(n).scenario_name,t,o),I(e(n).solution_name,Q("flow_storage_charge"),e(n).scenario_name,t,o),I(e(n).solution_name,Q("flow_storage_discharge"),e(n).scenario_name,t,o),I(e(n).solution_name,Q("flow_storage_spillage"),e(n).scenario_name,t,o),I(e(n).solution_name,Q("flow_storage_inflow"),e(n).scenario_name,t,o)]);a(x,c.data,!0),(D=c.unit)!=null&&D.data&&a(ye,Object.fromEntries(c.unit.data.map(v=>[v.technology,v[0]||v.units])),!0),a(se,b.data,!0),a(ne,l.data,!0),a(L,_.data,!0),a(V,u.data,!0)}async function Ye(){e(n)!==null&&(a(S,!0),a(te,e(ee)[0],!0),await Se(),qe(),ke(),ze(),xe(),oe(),a(S,!1))}async function ve(){a(S,!0),await Se(),ke(),ze(),xe(),oe(),a(S,!1)}function ze(){a(W,Array.from(new Set(e(x).data.map(t=>t.node))),!0),a(E,e(W),!0)}function qe(){if(a(j,[],!0),!e(x))return;let t=Array.from(e(x).data.map(o=>o.technology));e(x).data.forEach(o=>{let c=o.technology,b=e(n).detail.reference_carrier[c];!e(j).includes(b)&&t.includes(o.technology)&&e(j).push(b)}),e(j).length>0&&a(B,e(j)[0],!0)}function ke(){let t=Array.from(new Set(e(x).data.map(o=>o.technology)));a(R,t.filter(o=>{var c;return((c=e(n))==null?void 0:c.detail.reference_carrier[o])==e(B)}),!0),$=e(R)}function oe(){var b;if(e(E).length==0||$.length==0||e(x)===null||e(se)===null||e(ne)===null||e(V)===null||e(L)===null){a(Y,[],!0),a(P,[],!0),a(de,"");return}let t={},o={};if(t.technology=$,o.node=e(E),a(k,J(e(x).data,t,o,[],!1,"line","").map(l=>({...l,fill:"origin"})),!0),a(U,J(e(se).data,t,o,[],!1,"line","_charge").map(l=>({...l,stepped:!0,fill:"origin"})),!0),a(X,J(e(ne).data,t,o,[],!1,"line","_discharge").map(l=>{let _={};for(let u in l.data)_[u]=l.data[u]>0?-l.data[u]:l.data[u];return{data:_,label:l.label,type:l.type,stepped:!0,fill:"origin"}}),!0),a(be,J(e(L).data,t,o,[],!1,"line","_spillage").map(l=>{let _={};for(let u in l.data)_[u]=l.data[u]>0?-l.data[u]:l.data[u];return{data:_,label:l.label,type:l.type,stepped:!0,fill:"origin"}}),!0),a(he,J(e(V).data,t,o,[],!1,"line","_inflow").map(l=>({...l,stepped:!0,fill:"origin"})),!0),a(Y,e(k),!0),a(_e,e(U).concat(e(X)).concat(e(he)).concat(e(be)),!0),a(P,Object.keys(e(k)[0].data),!0),e(ce))a(Y,e(k),!0),a(P,Object.keys(e(k)[0].data),!0);else{let l={};for(const s in e(k)[0].data)l[s]=e(k).map(r=>r.data[s]).reduce((r,d)=>r+d,0);let _={};for(const s in e(U)[0].data)_[s]=e(U).map(r=>r.data[s]).reduce((r,d)=>r+d,0);let u={};for(const s in e(X)[0].data)u[s]=e(X).map(r=>r.data[s]).reduce((r,d)=>r+d,0);let D={};for(const s in e(V).data[0])D[s]=e(V).data.map(r=>r.data[s]).reduce((r,d)=>r+d,0);let v={};for(const s in e(L).data[0])v[s]=e(L).data.map(r=>r.data[s]).reduce((r,d)=>r+d,0);a(Y,[{data:Object.values(l),label:"Storage level",type:"line",borderColor:"black",fill:"origin",stepped:!0}],!0),a(_e,[{data:Object.values(_),label:"Flow Storage Charge",type:"line",borderColor:"blue",stepped:!0},{data:Object.values(u),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0},{data:Object.values(D),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0},{data:Object.values(v),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0}],!0),a(P,Object.keys(l),!0)}let c=e(n).solution_name.split(".");a(de,[c[(c==null?void 0:c.length)-1],(b=e(n))==null?void 0:b.scenario_name,Me,e(B)].join("_"),!0)}var Ce=St(),pe=f(ie(Ce),2),De=p(pe),Oe=p(De),ge=p(Oe),Te=f(p(ge),2),je=p(Te),Ge=p(je);const Ie=K(()=>!e(S)&&!e(C));st(Ge,{solution_selected:Ye,get enabled(){return e(Ie)},get selected_solution(){return e(n)},set selected_solution(t){a(n,t,!0)},get loading(){return e(C)},set loading(t){a(C,t,!0)},get years(){return e(ee)},set years(t){a(ee,t,!0)}}),g(je),g(Te),g(ge);var Je=f(ge,2);{var Qe=t=>{var o=pt(),c=ie(o),b=f(p(c),2),l=p(b),_=p(l);{var u=s=>{var r=_t(),d=f(ie(r),2);d.__change=ve;var y=p(d);ot(y,17,()=>e(j),rt,(O,G)=>{var w=ut(),M={},fe=p(w,!0);g(w),Re(()=>{M!==(M=e(G))&&(w.value=(w.__value=e(G))??""),Fe(fe,e(G))}),m(O,w)});var A=f(y);g(d);var Z=f(d,4);const F=K(()=>!e(S)&&!e(C));Ee(Z,{get options(){return e(ee)},selection_changed:ve,get enabled(){return e(F)},get selected_option(){return e(te)},set selected_option(O){a(te,O,!0)}});var N=f(Z,4);const q=K(()=>!e(S)&&!e(C));Ee(N,{options:Ke,selection_changed:ve,get enabled(){return e(q)},get selected_option(){return e(ue)},set selected_option(O){a(ue,O,!0)}}),Re(()=>{d.disabled=e(S)||e(C),Fe(A,` disabled=${(e(S)||e(C))??""}`)}),nt(d,()=>e(B),O=>a(B,O)),m(s,r)};z(_,s=>{e(j).length>0&&s(u)})}g(l),g(b),g(c);var D=f(c,2);{var v=s=>{var r=vt(),d=f(p(r),2),y=p(d),A=f(p(y),2);ct(A,{change:oe,get value(){return e(ce)},set value(F){a(ce,F,!0)}});var Z=f(A,4);dt(Z,{get elements(){return e(W)},selection_changed:oe,get selected_elements(){return e(E)},set selected_elements(F){a(E,F,!0)}}),g(y),g(d),g(r),m(s,r)};z(D,s=>{e(x)&&e(B)&&e(R).length>0&&e(W).length>0&&s(v)})}m(t,o)};z(Je,t=>{!e(C)&&e(n)&&t(Qe)})}g(Oe),g(De),g(pe);var Ae=f(pe,2),Ue=p(Ae);{var Xe=t=>{var o=gt();m(t,o)},$e=(t,o)=>{{var c=l=>{var _=ft();m(l,_)},b=(l,_)=>{{var u=v=>{var s=mt();m(v,s)},D=(v,s)=>{{var r=y=>{var A=ht();m(y,A)},d=(y,A)=>{{var Z=N=>{var q=bt();m(N,q)},F=(N,q)=>{{var O=w=>{var M=yt();m(w,M)},G=(w,M)=>{{var fe=H=>{var re=wt();m(H,re)},et=H=>{var re=xt(),Ne=ie(re);We(Be(Ne,{get config(){return e(Le)},get plot_name(){return e(de)},zoom:!0}),me=>ae=me,()=>ae);var tt=f(Ne,2);We(Be(tt,{get config(){return e(Ve)},get plot_name(){return He},zoom:!0}),me=>le=me,()=>le),m(H,re)};z(w,H=>{e(k).length==0?H(fe):H(et,!1)},M)}};z(N,w=>{e(W).length==0?w(O):w(G,!1)},q)}};z(y,N=>{e(k)==null?N(Z):N(F,!1)},A)}};z(v,y=>{e(n)==null?y(r):y(d,!1)},s)}};z(l,v=>{e(j).length==0?v(u):v(D,!1)},_)}};z(t,l=>{e(R).length==0?l(c):l(b,!1)},o)}};z(Ue,t=>{e(C)||e(S)?t(Xe):t($e,!1)})}g(Ae),m(Pe,Ce),lt()}it(["change"]);export{Et as component};
