
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Parameters fit with pyABC &#8212; [ ASteCA ]</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=2dd1c7b5" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=810a7e51"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'contents/paramfit';</script>
    <script src="../_static/umami.js?v=3075c5f1"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Masses and binary fraction" href="masses_bfr.html" />
    <link rel="prev" title="Generate synthetic clusters" href="synthetic.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">[ ASteCA ]</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="user_guide.html">User Guide</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="cluster_mod.html">Cluster module</a></li>
<li class="toctree-l2"><a class="reference internal" href="membership_mod.html">Membership module</a></li>
<li class="toctree-l2"><a class="reference internal" href="isochrones_mod.html">Isochrones module</a></li>
<li class="toctree-l2"><a class="reference internal" href="synthetic_mod.html">Synthetic module</a></li>
<li class="toctree-l2"><a class="reference internal" href="likelihood_mod.html">Likelihood module</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="tutorials.html">Tutorials</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="structure.html">Structure analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="membership.html">Membership probabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="synthetic.html">Generate synthetic clusters</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Parameters fit with pyABC</a></li>
<li class="toctree-l2"><a class="reference internal" href="masses_bfr.html">Masses and binary fraction</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">API</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../build/api/asteca.Cluster.html">Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build/api/asteca.Membership.html">Membership</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build/api/asteca.Isochrones.html">Isochrones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build/api/asteca.Synthetic.html">Synthetic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build/api/asteca.Likelihood.html">Likelihood</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/asteca/ASteCA/main?urlpath=tree/docs/contents/paramfit.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/asteca/ASteCA/blob/main/docs/contents/paramfit.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/asteca/ASteCA" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/asteca/ASteCA/edit/main/docs/contents/paramfit.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/asteca/ASteCA/issues/new?title=Issue%20on%20page%20%2Fcontents/paramfit.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/contents/paramfit.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Parameters fit with pyABC</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-asteca-objects">Loading ASteCA objects</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-pyabc">Running pyABC</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-the-results">Extracting the results</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="parameters-fit-with-pyabc">
<span id="paramfit-ntbk"></span><h1>Parameters fit with pyABC<a class="headerlink" href="#parameters-fit-with-pyabc" title="Link to this heading">#</a></h1>
<p>This is a simple example of how we can use a package like <a class="reference external" href="https://pyabc.readthedocs.io/">pyABC</a> to estimate the fundamental parameters for an observed cluster. The user can combine <strong>ASteCA</strong> with any other package of their choosing, here’s a list with many Python-based <a class="reference external" href="https://gabriel-p.github.io/pythonMCMC/">MCMC and ABC packages</a>.</p>
<section id="loading-asteca-objects">
<h2>Loading ASteCA objects<a class="headerlink" href="#loading-asteca-objects" title="Link to this heading">#</a></h2>
<p>We start by instantiating an <a class="reference internal" href="../build/api/asteca.Isochrones.html#asteca.Isochrones" title="asteca.Isochrones"><span class="xref myst py py-class">Isochrones</span></a> object with a PARSEC isochrone. This is an example file but you can use whatever isochrone service fits your needs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asteca</span>

<span class="c1"># Load isochrones</span>
<span class="n">isochs</span> <span class="o">=</span> <span class="n">asteca</span><span class="o">.</span><span class="n">Isochrones</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s1">&#39;parsec&#39;</span><span class="p">,</span>
    <span class="n">isochs_path</span><span class="o">=</span><span class="s2">&quot;../_static/parsec/&quot;</span><span class="p">,</span>
    <span class="n">magnitude</span><span class="o">=</span><span class="s2">&quot;Gmag&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;G_BPmag&quot;</span><span class="p">,</span> <span class="s2">&quot;G_RPmag&quot;</span><span class="p">),</span>
    <span class="n">magnitude_effl</span><span class="o">=</span><span class="mf">6390.7</span><span class="p">,</span>
    <span class="n">color_effl</span><span class="o">=</span><span class="p">(</span><span class="mf">5182.58</span><span class="p">,</span> <span class="mf">7825.08</span><span class="p">),</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Instantiating isochrones
Model          : PARSEC
N_files        : 1
N_mets         : 3
N_ages         : 11
N_isochs       : 2000
z    range     : [0.01, 0.02]
loga range     : [7.0, 9.5]
Magnitude      : Gmag
Color          : G_BPmag-G_RPmag
Isochrone object generated
</pre></div>
</div>
</div>
</div>
<p>Next we instantiate a <a class="reference internal" href="../build/api/asteca.Synthetic.html#asteca.Synthetic" title="asteca.Synthetic"><span class="xref myst py py-class">Synthetic</span></a> object, passing the <code class="docutils literal notranslate"><span class="pre">isochs</span></code> object we just created (we are using all defaults for the arguments here):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create Synthetic cluster object</span>
<span class="n">synthcl</span> <span class="o">=</span> <span class="n">asteca</span><span class="o">.</span><span class="n">Synthetic</span><span class="p">(</span><span class="n">isochs</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">457304</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Instantiating synthetic
Default params : {&#39;met&#39;: 0.0152, &#39;loga&#39;: 8.0, &#39;alpha&#39;: 0.09, &#39;beta&#39;: 0.94, &#39;Rv&#39;: 3.1, &#39;DR&#39;: 0.0, &#39;Av&#39;: 0.2, &#39;dm&#39;: 9.0}
Extinction law : CCMO
Diff reddening : uniform
IMF            : chabrier_2014
Max init mass  : 10000
Gamma dist     : D&amp;K
Random seed    : 457304
Synthetic clusters object generated
</pre></div>
</div>
</div>
</div>
<p>Now we load our observed cluster into a <a class="reference internal" href="../build/api/asteca.Cluster.html#asteca.Cluster" title="asteca.Cluster"><span class="xref myst py py-class">Cluster</span></a> object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">obs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../_static/cluster.csv&quot;</span><span class="p">)</span>

<span class="n">my_cluster</span> <span class="o">=</span> <span class="n">asteca</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span>
    <span class="n">ra</span><span class="o">=</span><span class="n">obs_df</span><span class="p">[</span><span class="s2">&quot;RA_ICRS&quot;</span><span class="p">],</span>
    <span class="n">dec</span><span class="o">=</span><span class="n">obs_df</span><span class="p">[</span><span class="s2">&quot;DE_ICRS&quot;</span><span class="p">],</span> 
    <span class="n">magnitude</span><span class="o">=</span><span class="n">obs_df</span><span class="p">[</span><span class="s2">&quot;Gmag&quot;</span><span class="p">],</span>
    <span class="n">e_mag</span><span class="o">=</span><span class="n">obs_df</span><span class="p">[</span><span class="s2">&quot;e_Gmag&quot;</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="n">obs_df</span><span class="p">[</span><span class="s2">&quot;BP-RP&quot;</span><span class="p">],</span>
    <span class="n">e_color</span><span class="o">=</span><span class="n">obs_df</span><span class="p">[</span><span class="s2">&quot;e_BP-RP&quot;</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Instantiating cluster
Columns read   : RA, DEC, Magnitude, e_mag, Color, e_color
N_stars        : 2759
N_clust_min    : 25
N_clust_max    : 5000
Cluster object generated
</pre></div>
</div>
</div>
</div>
<p>We assume that the cluster file loaded in <code class="docutils literal notranslate"><span class="pre">obs_df</span></code> is composed of only the most probable members of the cluster. If not, you can refer to the <a class="reference internal" href="membership.html"><span class="doc std std-doc">Membership probabilities</span></a> tutorial to learn how to obtain the membership probabilities and select the most probable members.</p>
<p>Finally, we need to calibrate our <code class="docutils literal notranslate"><span class="pre">synthcl</span></code> object and instantiate a <a class="reference internal" href="../build/api/asteca.Likelihood.html#asteca.Likelihood" title="asteca.Likelihood"><span class="xref myst py py-class">Likelihood</span></a> object, which will be used to quantify how similar our observed cluster is to the generated synthetic clusters. For both operations we need to pass the <code class="docutils literal notranslate"><span class="pre">my_cluster</span></code> object we generated above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calibrate the `synthcl` object</span>
<span class="n">synthcl</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span><span class="n">my_cluster</span><span class="p">)</span>

<span class="c1"># Instantiate the likelihood</span>
<span class="n">likelihood</span> <span class="o">=</span> <span class="n">asteca</span><span class="o">.</span><span class="n">Likelihood</span><span class="p">(</span><span class="n">my_cluster</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrated observed cluster
N_stars_obs    : 2759
Max magnitude  : 19.00
Error distribution loaded

Likelihood object generated
</pre></div>
</div>
</div>
</div>
</section>
<section id="running-pyabc">
<h2>Running pyABC<a class="headerlink" href="#running-pyabc" title="Link to this heading">#</a></h2>
<p>We are now ready to begin the fundamental parameters estimation process with pyABC. The first step is to import pyABC and define the priors for the parameters that are being estimated, as well as a dictionary with the remaining fundamental parameters that are <em>not</em> being estimated and are thus fixed to a certain value.</p>
<p>Notice that the priors defined this way for pyABC require using the minimum value and the desired <em>range</em>, not the maximum value.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyabc</span>

<span class="n">met_min</span><span class="p">,</span> <span class="n">met_max</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span>
<span class="n">loga_min</span><span class="p">,</span> <span class="n">loga_max</span> <span class="o">=</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">9.5</span>
<span class="n">dm_min</span><span class="p">,</span> <span class="n">dm_max</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">10.5</span>
<span class="n">Av_min</span><span class="p">,</span> <span class="n">Av_max</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span>

<span class="c1"># Define a pyABC Distribution(). Uniform distributions are employed for all the parameters</span>
<span class="c1"># here but the user can of course change this as desired. See the pyABC docs for more</span>
<span class="c1"># information.</span>
<span class="n">priors</span> <span class="o">=</span> <span class="n">pyabc</span><span class="o">.</span><span class="n">Distribution</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;met&quot;</span><span class="p">:</span> <span class="n">pyabc</span><span class="o">.</span><span class="n">RV</span><span class="p">(</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="n">met_min</span><span class="p">,</span> <span class="n">met_max</span> <span class="o">-</span> <span class="n">met_min</span><span class="p">),</span>
        <span class="s2">&quot;loga&quot;</span><span class="p">:</span> <span class="n">pyabc</span><span class="o">.</span><span class="n">RV</span><span class="p">(</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="n">loga_min</span><span class="p">,</span> <span class="n">loga_max</span> <span class="o">-</span> <span class="n">loga_min</span><span class="p">),</span>
        <span class="s2">&quot;dm&quot;</span><span class="p">:</span> <span class="n">pyabc</span><span class="o">.</span><span class="n">RV</span><span class="p">(</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="n">dm_min</span><span class="p">,</span> <span class="n">dm_max</span> <span class="o">-</span> <span class="n">dm_min</span><span class="p">),</span>
        <span class="s2">&quot;Av&quot;</span><span class="p">:</span> <span class="n">pyabc</span><span class="o">.</span><span class="n">RV</span><span class="p">(</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="n">Av_min</span><span class="p">,</span> <span class="n">Av_max</span> <span class="o">-</span> <span class="n">Av_min</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>pyABC works by minimizing the distance between our data (the observed cluster) and synthetic data (the synthetic clusters). We will need two convenience functions to do this.</p>
<p>The first function required is <code class="docutils literal notranslate"><span class="pre">model()</span></code> which takes a dictionary with the fundamental parameters being estimated by pyABC, generates a synthetic cluster via the <code class="docutils literal notranslate"><span class="pre">generate()</span></code> method, and returns it as a dictionary. The returned variable is a dictionary simply because this is what pyABC expects; this is not a requirement of <strong>ASteCA</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="n">fit_params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a synthetic cluster.&quot;&quot;&quot;</span>
    <span class="c1"># Call generate method with the fit_params dictionary</span>
    <span class="n">synth_clust</span> <span class="o">=</span> <span class="n">synthcl</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">fit_params</span><span class="p">)</span>

    <span class="c1"># pyABC expects a dictionary from this function, so we return a</span>
    <span class="c1"># dictionary with a single element.</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">synth_clust</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>We then define a <code class="docutils literal notranslate"><span class="pre">distance()</span></code> function that returns the likelihood <code class="docutils literal notranslate"><span class="pre">lkl</span></code> between the observed and synthetic data, via the <code class="docutils literal notranslate"><span class="pre">likelihood</span></code> object. The likelihood value is normalized and inverted by <strong>ASteCA</strong> if the method used is <code class="docutils literal notranslate"><span class="pre">plr</span></code> (<a class="reference internal" href="likelihood_mod.html"><span class="doc std std-doc">Poisson Likelihood Ratio</span></a>, the default method) This is required because pyABC wants to <em>minimize</em> a distance and a likelihood needs to be <em>maximized</em>. This way the likelihood behaves like a distance.</p>
<p>Notice that this function receives two arguments from pyABC but we only require one, hence the second argument is dismissed. The function makes use of the dictionary generated by the <code class="docutils literal notranslate"><span class="pre">model()</span></code> function, containing the synthetic cluster.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">distance</span><span class="p">(</span><span class="n">synth_dict</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The likelihood returned works as a distance which means that the optimal value is 0.0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">likelihood</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">synth_dict</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We create an <a class="reference external" href="https://pyabc.readthedocs.io/en/latest/api/pyabc.inference.html#pyabc.inference.ABCSMC">ABCSMC</a> object with the <code class="docutils literal notranslate"><span class="pre">model</span></code> and <code class="docutils literal notranslate"><span class="pre">distance</span></code> functions, as well as the priors defined earlier. A population of 100 is usually enough. The tempfile defined below is required by pyABC.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define pyABC parameters</span>
<span class="n">pop_size</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">abc</span> <span class="o">=</span> <span class="n">pyabc</span><span class="o">.</span><span class="n">ABCSMC</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">priors</span><span class="p">,</span>
    <span class="n">distance</span><span class="p">,</span>
    <span class="n">population_size</span><span class="o">=</span><span class="n">pop_size</span>
<span class="p">)</span>

<span class="c1"># Define a temporary file required by pyABC</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="n">db_path</span> <span class="o">=</span> <span class="s2">&quot;sqlite:///&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span> <span class="s2">&quot;pyABC.db&quot;</span><span class="p">)</span>
<span class="n">abc</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ABC.Sampler INFO: Parallelize sampling on 8 processes.
ABC.History INFO: Start &lt;ABCSMC id=8, start_time=2025-04-28 11:05:20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyabc.storage.history.History at 0x7b82a3567dd0&gt;
</pre></div>
</div>
</div>
</details>
</div>
<p>Finally, we can run pyABC to perform Approximate Bayesian Inference on our parameters. We set a small number of populations here as an example. Running for ~5 minutes is usually enough (see pyABC’s documentation on how to set up a maximum running time):</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">abc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">minimum_epsilon</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">max_nr_populations</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ABC INFO: Calibration sample t = -1.
ABC INFO: t: 0, eps: 1.95391896e-01.
ABC INFO: Accepted: 100 / 191 = 5.2356e-01, ESS: 1.0000e+02.
ABC INFO: t: 1, eps: 1.19300951e-01.
ABC INFO: Accepted: 100 / 206 = 4.8544e-01, ESS: 6.4605e+01.
ABC INFO: t: 2, eps: 8.77885715e-02.
ABC INFO: Accepted: 100 / 211 = 4.7393e-01, ESS: 7.2239e+01.
ABC INFO: t: 3, eps: 7.04138311e-02.
ABC INFO: Accepted: 100 / 241 = 4.1494e-01, ESS: 8.2630e+00.
ABC INFO: t: 4, eps: 6.37649663e-02.
ABC INFO: Accepted: 100 / 206 = 4.8544e-01, ESS: 6.9823e+01.
ABC INFO: t: 5, eps: 5.16923350e-02.
ABC INFO: Accepted: 100 / 272 = 3.6765e-01, ESS: 8.5641e+01.
ABC INFO: t: 6, eps: 4.19125709e-02.
ABC INFO: Accepted: 100 / 295 = 3.3898e-01, ESS: 8.4727e+01.
ABC INFO: t: 7, eps: 3.48340129e-02.
ABC INFO: Accepted: 100 / 269 = 3.7175e-01, ESS: 6.7201e+01.
ABC INFO: t: 8, eps: 2.76012492e-02.
ABC INFO: Accepted: 100 / 292 = 3.4247e-01, ESS: 8.5830e+01.
ABC INFO: t: 9, eps: 2.34577053e-02.
ABC INFO: Accepted: 100 / 282 = 3.5461e-01, ESS: 7.8710e+01.
ABC INFO: t: 10, eps: 2.14400372e-02.
ABC INFO: Accepted: 100 / 272 = 3.6765e-01, ESS: 3.4105e+01.
ABC INFO: t: 11, eps: 2.00771783e-02.
ABC INFO: Accepted: 100 / 390 = 2.5641e-01, ESS: 7.2748e+01.
ABC INFO: t: 12, eps: 1.88689915e-02.
ABC INFO: Accepted: 100 / 491 = 2.0367e-01, ESS: 6.2440e+01.
ABC INFO: t: 13, eps: 1.81290621e-02.
ABC INFO: Accepted: 100 / 735 = 1.3605e-01, ESS: 5.6430e+01.
ABC INFO: t: 14, eps: 1.75497839e-02.
ABC INFO: Accepted: 100 / 1051 = 9.5147e-02, ESS: 5.5840e+01.
ABC INFO: t: 15, eps: 1.71326583e-02.
ABC INFO: Accepted: 100 / 1288 = 7.7640e-02, ESS: 3.1223e+01.
ABC INFO: t: 16, eps: 1.67048943e-02.
ABC INFO: Accepted: 100 / 1911 = 5.2329e-02, ESS: 5.9202e+01.
ABC INFO: t: 17, eps: 1.63733847e-02.
ABC INFO: Accepted: 100 / 1778 = 5.6243e-02, ESS: 5.3924e+01.
ABC INFO: t: 18, eps: 1.60277728e-02.
ABC INFO: Accepted: 100 / 3463 = 2.8877e-02, ESS: 1.7928e+01.
ABC INFO: t: 19, eps: 1.58940459e-02.
ABC INFO: Accepted: 100 / 8681 = 1.1519e-02, ESS: 3.0782e+01.
ABC INFO: Stop: Maximum number of generations.
ABC.History INFO: Done &lt;ABCSMC id=8, duration=0:00:35.091309, end_time=2025-04-28 11:05:55&gt;
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="extracting-the-results">
<h2>Extracting the results<a class="headerlink" href="#extracting-the-results" title="Link to this heading">#</a></h2>
<p>We are now ready to extract a few important results, along with our fundamental parameters’ estimations.</p>
<p>The first line shows the final minimized distance between our observed cluster and the synthetic clusters that were generated. Usually a value below 10% (&lt;0.1) means that a reasonable enough fit was found. Notice that this is true for an analysis like this one, where pyABC was used.</p>
<p>The following line extracts the DataFrame of the last run, and its associated weights. We use the weights to show the effective sample size. This value depends on the population size used above (<code class="docutils literal notranslate"><span class="pre">pop_size</span></code>) and should be large enough to allow decent mean/median/STDDEV values to be extracted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_dist</span> <span class="o">=</span> <span class="n">pyabc</span><span class="o">.</span><span class="n">inference_util</span><span class="o">.</span><span class="n">eps_from_hist</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final minimized distance: </span><span class="si">{:.2f}</span><span class="s2"> (</span><span class="si">{:.0f}</span><span class="s2">%)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">final_dist</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">final_dist</span><span class="p">))</span>

<span class="c1"># Extract last iteration and weights</span>
<span class="n">df</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">get_distribution</span><span class="p">()</span>

<span class="n">ESS</span> <span class="o">=</span> <span class="n">pyabc</span><span class="o">.</span><span class="n">weighted_statistics</span><span class="o">.</span><span class="n">effective_sample_size</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Effective sample size: </span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ESS</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final minimized distance: 0.02 (2%)
Effective sample size: 31
</pre></div>
</div>
</div>
</div>
<p>Finally, the estimations for each fitted parameter is extracted from the DataFrame using the associated weights (again, this is a <a class="reference external" href="https://pyabc.readthedocs.io/en/latest/api/pyabc.weighted_statistics.html#api-weighted-statistics">pyABC dependent method</a>; other packages will do this differently)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parameters estimation:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------&quot;</span><span class="p">)</span>
<span class="n">fit_params</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="c1"># Extract medians for the fitted parameters</span>
    <span class="n">_median</span> <span class="o">=</span> <span class="n">pyabc</span><span class="o">.</span><span class="n">weighted_statistics</span><span class="o">.</span><span class="n">weighted_median</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">fit_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_median</span>
    <span class="c1"># Extract STDDEV for the fitted parameters</span>
    <span class="n">_std</span> <span class="o">=</span> <span class="n">pyabc</span><span class="o">.</span><span class="n">weighted_statistics</span><span class="o">.</span><span class="n">weighted_std</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&lt;5}</span><span class="s2">: </span><span class="si">{:.3f}</span><span class="s2"> +/- </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">_median</span><span class="p">,</span> <span class="n">_std</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Parameters estimation:
----------------------
Av   : 0.442 +/- 0.061
dm   : 8.249 +/- 0.036
loga : 8.003 +/- 0.058
met  : 0.019 +/- 0.002
</pre></div>
</div>
</div>
</div>
<p>pyABC has many methods to visualize and analyze the results, see <a class="reference external" href="https://pyabc.readthedocs.io/en/latest/visualization.html#visualization-and-analysis">Visualization and analysis</a>. We show here just a few:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pyabc</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">set_figure_params</span><span class="p">(</span><span class="s2">&quot;pyabc&quot;</span><span class="p">)</span>  <span class="c1"># for beautified plots</span>

<span class="c1"># Matrix of 1d and 2d histograms over all parameters</span>
<span class="n">pyabc</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_histogram_matrix</span><span class="p">(</span><span class="n">history</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/550dc2a8d7200948838e29d3e13869ed36a276970f6819e5febd150d1dd5708d.png" src="../_images/550dc2a8d7200948838e29d3e13869ed36a276970f6819e5febd150d1dd5708d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Credible intervals over time</span>
<span class="n">pyabc</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_credible_intervals</span><span class="p">(</span><span class="n">history</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/58c898839dca58657b585c0839907ca97a1714691c9b6ba5f1ac2ff1fe31d0cc.png" src="../_images/58c898839dca58657b585c0839907ca97a1714691c9b6ba5f1ac2ff1fe31d0cc.png" />
</div>
</div>
<p>We can generate a CMD comparing our observed cluster with the “best fit” synthetic cluster found by pyABC. We start by updating the <code class="docutils literal notranslate"><span class="pre">fit_params</span></code> dictionary, which contains the median of the parameter distributions found by pyABC, to include those parameters that were not fitted and are stored in the <code class="docutils literal notranslate"><span class="pre">fixed_params</span></code> dictionary:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate the &quot;best fit&quot; synthetic cluster using these parameters</span>
<span class="n">synth_arr</span> <span class="o">=</span> <span class="n">synthcl</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">fit_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>and generate a side-by-side CMD plot showing also the theoretical isochrone associated to the “best fit” synthetic cluster:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">cmd_plot</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to generate a CMD plot&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;, N=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">mag</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mag</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Invert y axis</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="c1"># Observed cluster</span>
<span class="n">cmd_plot</span><span class="p">(</span><span class="n">my_cluster</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">my_cluster</span><span class="o">.</span><span class="n">mag</span><span class="p">,</span> <span class="s2">&quot;Observed stars&quot;</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span>

<span class="c1"># Synthetic cluster</span>
<span class="c1"># Boolean mask identifying the binary systems</span>
<span class="n">binary_msk</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">synth_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># Extract magnitude and color</span>
<span class="n">mag</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">synth_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">synth_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># Plot single systems</span>
<span class="n">cmd_plot</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="o">~</span><span class="n">binary_msk</span><span class="p">],</span> <span class="n">mag</span><span class="p">[</span><span class="o">~</span><span class="n">binary_msk</span><span class="p">],</span> <span class="s2">&quot;Single systems&quot;</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span>
<span class="c1"># Plot binary systems</span>
<span class="n">cmd_plot</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="n">binary_msk</span><span class="p">],</span> <span class="n">mag</span><span class="p">[</span><span class="n">binary_msk</span><span class="p">],</span> <span class="s2">&quot;Binary systems&quot;</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span>

<span class="c1"># Get isochrone associated to the synthetic cluster</span>
<span class="n">isoch_arr</span> <span class="o">=</span> <span class="n">synthcl</span><span class="o">.</span><span class="n">get_isochrone</span><span class="p">(</span><span class="n">fit_params</span><span class="p">)</span>
<span class="c1"># Plot the isochrone</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">isoch_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">isoch_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/782036efb3687edc84222ae9004c0d22213d179d4ec69d489e3db8ec7871e000.png" src="../_images/782036efb3687edc84222ae9004c0d22213d179d4ec69d489e3db8ec7871e000.png" />
</div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="synthetic.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Generate synthetic clusters</p>
      </div>
    </a>
    <a class="right-next"
       href="masses_bfr.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Masses and binary fraction</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-asteca-objects">Loading ASteCA objects</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-pyabc">Running pyABC</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-the-results">Extracting the results</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Gabriel I Perren
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Gabriel I Perren.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>