@name: CSRF登录授权测试
@description: 演示CSRF登录授权提供者的使用
@tags: [HTTP, API, 授权, CSRF, 示例]
@author: Felix
@date: 2024-05-20

# CSRF登录授权测试示例
# 演示CSRF登录授权提供者的使用

# 测试CSRF登录认证
[HTTP请求],客户端:'csrf_auth',配置:'''
        method: GET
        url: /headers
        captures:
            csrf_token: ["jsonpath", "$.headers.X-Csrf-Token"]
        asserts:
            - ["status", "eq", 200]
            - ["jsonpath", "$.headers.X-Csrf-Token", "exists"]
    '''

[打印],内容:'CSRF令牌: ${csrf_token}'

# 测试CSRF令牌过期后自动重新登录
[HTTP请求],客户端:'csrf_auth',配置:'''
        method: GET
        url: /headers
        headers:
            X-Csrf-Token: expired_token  # 模拟过期令牌
        captures:
            csrf_token: ["jsonpath", "$.headers.X-Csrf-Token"]
        asserts:
            - ["status", "eq", 200]
            - ["jsonpath", "$.headers.X-Csrf-Token", "exists"]
    '''

[打印],内容:'新的CSRF令牌: ${csrf_token}'

# 测试需要CSRF令牌的POST请求
[HTTP请求],客户端:'csrf_auth',配置:'''
        method: POST
        url: /anything
        json:
            test: "data"
        captures:
            headers: ["jsonpath", "$.headers"]
            json: ["jsonpath", "$.json"]
        asserts:
            - ["status", "eq", 200]
            - ["jsonpath", "$.headers.X-Csrf-Token", "exists"]
    '''

[打印],内容:'请求头: ${headers}'
[打印],内容:'请求体: ${json}'

# 测试禁用CSRF认证
[HTTP请求],客户端:'csrf_auth',配置:'''
        method: GET
        url: /headers
        disable_auth: true
        asserts:
            - ["status", "eq", 200]
    '''

[打印],内容:'CSRF登录授权测试完成' 