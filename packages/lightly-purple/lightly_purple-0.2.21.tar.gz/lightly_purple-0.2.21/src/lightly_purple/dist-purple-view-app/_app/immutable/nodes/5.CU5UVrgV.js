import{n as ye,a as v,c as B,t as I,r as Fe}from"../chunks/C1951IdI.js";import{p as se,i as N,d as F,c as D,r as He,a as A,b as je}from"../chunks/OpdB38Ru.js";import{P as Ae,c as Ie}from"../chunks/BBLiiV7J.js";import{c as E,e as ze,i as Le,f as ne,j as Ee,a as ke,d as Me,g as We,h as Ge,b as Re}from"../chunks/8eNpkxEe.js";import"../chunks/DZOxPCae.js";import{p as U,c as k,r as M,t as Y,a as J,f as C,j as t,y as oe,v as u,q as y,z as Oe,e as ae,l as q,s as ie}from"../chunks/CdjFANdp.js";import{u as Pe}from"../chunks/DP8I5Y6A.js";import{r as Te}from"../chunks/Cbydd1_z.js";import{G as Ve}from"../chunks/ryjTVRkZ.js";import{a as qe}from"../chunks/HhvvIgyN.js";import{S as Be}from"../chunks/Dyi-qQae.js";import{a as Ne}from"../chunks/DXC1p2cl.js";var Ce=ye('<svg style="position: absolute; top: 0; left: 0;"><!></svg>');function De(f,e){U(e,!0);const[s,_]=D(),r=()=>F(c,"$isHidden",s),d=se(e,"sampleImageObjectFit",3,"contain"),{isHidden:c}=qe();var a=Ce(),o=k(a);{var m=i=>{var h=B(),b=C(h);ze(b,17,()=>e.sample.annotations,Le,(j,z)=>{Be(j,{get annotation(){return t(z)},get showLabel(){return e.showLabel},get imageWidth(){return e.sample.width}})}),v(i,h)};N(o,i=>{r()||i(m)})}M(a),Y(()=>{E(a,"viewBox",`0 0 ${e.sample.width} ${e.sample.height}`),E(a,"preserveAspectRatio",d()==="contain"?"xMidYMid meet":"xMidYMid slice"),E(a,"width",e.containerWidth),E(a,"height",e.containerHeight)}),v(f,a),J(),_()}var Ue=I("<img>");function Ye(f,e){U(e,!0);const s=se(e,"objectFit",3,"contain"),_=He(e,["$$slots","$$events","$$legacy","sample","objectFit"]),{class:r,...d}=_,{getDatasetVersion:c}=ne();let a=y("");oe(async()=>{var i;(i=e.sample)!=null&&i.dataset_id&&u(a,A(await c(e.sample.dataset_id)))});var o=Ue();let m;Y(i=>m=ke(o,m,{src:`${Ae}${e.sample.file_path_abs}${t(a)?`?v=${t(a)}`:""}`,alt:e.sample.file_path_abs,class:i,decoding:"async",style:`--object-fit: ${s()??""}`,loading:"lazy",...d},"svelte-1c6bz0a"),[()=>Ee("sample-image rounded-lg bg-black",r)]),Fe(o),v(f,o),J()}const Je=async({dataset_id:f,offset:e=0,limit:s=10,annotationLabels:_,tagIds:r,min_width:d,max_width:c,min_height:a,max_height:o,textEmbedding:m=[]})=>{const i={data:[],error:void 0};try{const h=d!==void 0?{min_width:d,max_width:c,min_height:a,max_height:o}:{},b=await Ie.GET("/api/samples",{params:{query:{dataset_id:f,offset:e,limit:s,annotation_labels:_,tag_ids:r,text_embedding:m,...h}}});if(b.error)throw new Error(JSON.stringify(b.error,null,2));if(!b.data)throw new Error("No data");i.data=b.data}catch(h){i.error="Error loading samples: "+String(h)}return i};var Ke=I('<div class="relative"><div class="absolute right-7 top-1 z-10"><!></div> <a class="block"><!> <!></a></div>'),Qe=I('<div slot="noMore"></div>'),Xe=I('<div slot="noResults"></div>'),Ze=I('<div class="viewport flex-1 svelte-gzepom"><!></div>'),$e=I('<div class="flex h-full w-full items-center justify-center"><div>Loading...</div></div>');function et(f,e){U(e,!0);const[s,_]=D(),r=()=>F(b,"$infiniteLoaderIdentifier",s),d=()=>F(e.dimensions,"$dimensions",s),c=()=>F(e.selectedAnnotationFilter,"$selectedAnnotationFilter",s),a=()=>F(h,"$tagsSelected",s),o=()=>F(e.textEmbedding,"$textEmbedding",s),m=()=>F(re,"$selectedSampleIds",s),{getGridViewSampleRendering:i}=Me(),{tagsSelected:h}=Pe({dataset_id:e.dataset_id,kind:["sample"]});let b=Oe([e.selectedAnnotationFilter,h,e.dimensions,e.textEmbedding],([n,l,S,w])=>n.join(",")+Array.from(l).join(",")+S.min_width+S.max_width+S.min_height+S.max_height+(w?w.queryText:"")),j=y(0);const z=100;let p=y(A([])),H=y(null),K=y(!0),Q=y(!1);const{selectedSampleIds:re,toggleSampleSelection:le,getDatasetVersion:de}=ne();let G=y("cover"),R=y(0);oe(async()=>{await de(e.dataset_id),u(G,A(i)),u(Q,!0)}),ae(()=>{r(),u(p,A([])),u(j,0)}),ae(()=>{if(!t(H))return;u(R,A(t(H).clientHeight));const n=new ResizeObserver(()=>{t(H)&&u(R,A(t(H).clientHeight))});return n.observe(t(H)),()=>{n.disconnect()}});async function ce({detail:{loaded:n,complete:l}}){const S=t(K)?void 0:d(),w=await Je({dataset_id:e.dataset_id,limit:z,offset:t(j),annotationLabels:c().length>0?c():void 0,tagIds:a().size>0?Array.from(a()):void 0,textEmbedding:o()?o().embedding:void 0,...S});w.data.length?(u(j,t(j)+z),t(p).push(...w.data),u(K,!1),w.data.length<z?l():n()):l()}const X=16,me=We(),[ge,tt]=me;var Z=B(),ue=C(Z);{var ve=n=>{var l=Ze(),S=k(l);const w=q(()=>e.sampleHeight+X),_e=q(()=>e.sampleWidth+X);Ve(S,{get itemCount(){return t(p).length},get itemHeight(){return t(w)},get itemWidth(){return t(_e)},get height(){return t(R)},class:"overflow-none overflow-y-auto dark:[color-scheme:dark]",get style(){return`--sample-width: ${e.sampleWidth??""}px; --sample-height: ${e.sampleHeight??""}px;`},overScan:100,item:(O,g)=>{let x=()=>g==null?void 0:g().index,L=()=>g==null?void 0:g().style;var ee=B(),he=C(ee);{var pe=P=>{var W=Ke(),T=k(W),be=k(T);const Se=q(()=>m().has(t(p)[x()].sample_id));Ne(be,{onSelect:()=>le(t(p)[x()].sample_id),get isSelected(){return t(Se)}}),M(T);var V=ie(T,2),te=k(V);Ye(te,{get sample(){return t(p)[x()]},get objectFit(){return t(G)}});var we=ie(te,2);De(we,{get sample(){return t(p)[x()]},get containerWidth(){return e.sampleWidth},get sampleImageObjectFit(){return t(G)},get containerHeight(){return e.sampleHeight}}),M(V),M(W),Y(xe=>{Re(W,L()),E(V,"href",xe)},[()=>ge(Te.toSample(t(p)[x()].sample_id),void 0)]),v(P,W)};N(he,P=>{t(p)[x()]&&P(pe)})}v(O,ee)},footer:O=>{Ge(O,{get identifier(){return r()},$$events:{infinite:ce},$$slots:{noMore:(g,x)=>{var L=Qe();v(g,L)},noResults:(g,x)=>{var L=Xe();v(g,L)}}})},$$slots:{item:!0,footer:!0}}),M(l),je(l,$=>u(H,$),()=>t(H)),v(n,l)},fe=n=>{var l=$e();v(n,l)};N(ue,n=>{t(Q)?n(ve):n(fe,!1)})}v(f,Z),J(),_()}function ft(f,e){const[s,_]=D(),r=()=>F(i,"$boundedSampleSize",s),{datasetId:d,sampleSize:c,dimensions:a,selectedAnnotationFilter:o,globalStorage:{textEmbedding:m}}=e.data,i=c.sampleSize;et(f,{get sampleHeight(){return r().height},get sampleWidth(){return r().width},textEmbedding:m,dataset_id:d,selectedAnnotationFilter:o,dimensions:a}),_()}export{ft as component};
