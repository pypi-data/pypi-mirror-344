"use strict";(self.webpackChunktvb_ext_bucket=self.webpackChunktvb_ext_bucket||[]).push([[522],{522:(e,t,n)=>{n.r(t),n.d(t,{default:()=>W});var a=n(578),r=n(140),o=n(422),s=n(337),l=n(271),c=n.n(l),i=n(336);const u=({label:e,action:t,icon:n,onContextFinish:a})=>{const[r,o]=(0,l.useState)(!1),s=(0,l.useCallback)((async()=>{o(!0),await t(),a&&a(),o(!1)}),[]);return c().createElement("li",{onClick:s,className:"bucket-ContextMenu-item"},n&&c().createElement(n.react,null),c().createElement("p",{style:{paddingLeft:"0.5em"}},e),c().createElement("span",{className:"bucket-Spinner",style:{display:r?"inline-block":"none"}}))};var d=n(558),m=n(16);async function h(e="",t={}){const n=m.ServerConnection.makeSettings(),a=d.URLExt.join(n.baseUrl,"tvb_ext_bucket",e);let r;try{r=await m.ServerConnection.makeRequest(a,t,n)}catch(e){throw new m.ServerConnection.NetworkError(e)}let o=await r.text();if(o.length>0)try{o=JSON.parse(o)}catch(e){console.log("Not a JSON response body.",r)}if(!r.ok)throw new m.ServerConnection.ResponseError(r,o.message||o);return o}class b extends Error{}class p extends Error{}class f extends Error{}class v extends Error{}class g extends Error{}const w={current:null},k=e=>{let t="";for(let n=e.length-1;n>-1&&(t=e[n]+t,"."!==e[n]);n--);return t.startsWith(".")?t:""};class E{constructor(e){this._breadcrumbs=[],this._bucket=e.bucket,this._bucketEndpoint=e.bucketEndPoint,this._currentFiles=new Map}_buildBrowser(e){this._homeDirectory=new E.BucketDirectory("",e,this.bucket),this._currentDirectory=this._homeDirectory}get currentDirectory(){return this._currentDirectory}get bucket(){return this._bucket}set bucket(e){this._bucket=e}async getAvailableBuckets(){let e=[];try{e=await h("buckets")}catch(e){await(0,o.showErrorMessage)("ERROR","Could not get available buckets from server")}return e}ls(){return this.currentDirectory?this.currentDirectory.ls():[]}get breadcrumbs(){return this._breadcrumbs}async openBucket(){this._currentFiles.clear(),this._breadcrumbs=[];try{const e=await h(`${this._bucketEndpoint}?bucket=${this._bucket}`);e.success||await(0,o.showErrorMessage)("ERROR",e.message),this._buildBrowser(e.files)}catch(e){await(0,o.showErrorMessage)("ERROR",`Could not open bucket. ${e}`)}return this.currentDirectory}async cd(e){var t;if((!e||""===e)&&this._homeDirectory)return this._currentDirectory=this._homeDirectory,this._currentFiles.clear(),this._breadcrumbs=[],this._homeDirectory;const n=null===(t=this._currentDirectory)||void 0===t?void 0:t.directories.get(null!=e?e:"");if(!n)throw new v(`Can't cd to directory ${e}! Directory doesn't seem to exist.`);return this._currentDirectory=n,this._currentFiles.clear(),this._breadcrumbs.push(n),n}async goTo(e){const t=[...this._breadcrumbs];let n=t.pop();for(;void 0!==n&&n.name!==e;)n=t.pop();if(void 0===n)throw new b(`Could not find breadcrumb ${e}`);return t.push(n),this._breadcrumbs=t,this._currentDirectory=n,n}}function y(e,t){const n=(0,l.useMemo)((()=>`tvb-ext-bucket:${t}`),[]),[a,r]=(0,l.useState)(JSON.parse(localStorage.getItem(n)));return(0,l.useEffect)((()=>{const e=JSON.stringify(a);localStorage.setItem(n,e)}),[a]),[a,r,n]}!function(e){class t{constructor(e,t,n,a){this.directories=new Map,this.files=new Map,this.isFile=!1,this.name=e,this.bucket=n,this.absolutePath=a||"",this._buildContents(t)}_buildContents(e){const a=new Map;for(const t of e)if(t.includes("/")){const e=t.slice(0,t.indexOf("/")),n=t.slice(t.indexOf("/")+1),r=a.get(e);r?r.push(n):a.set(e,[n])}else{const e=new n(t,this.absolutePath?`${this.absolutePath}/${t}`:t,this.bucket);this.files.set(e.name,e)}a.forEach(((e,n)=>{const a=this.absolutePath?`${this.absolutePath}/${n}`:n,r=new t(n,e,this.bucket,a);this.directories.set(n,r)}))}get filesCount(){return this.files.size}get directoriesCount(){return this.directories.size}ls(){const e=[];for(const t of this.directories.values())e.push(t);for(const t of this.files.values())e.push(t);return e}async upload(e,t){if(!await this._confirmOverride(t))return;const n=h(`upload?source_file=${e}&bucket=${this.bucket}&destination=${this.absolutePath}&filename=${t}`);console.log("result: ",n)}async getUploadUrl(e){if(!await this._confirmOverride(e))return"#";const t=await h(`local_upload?to_bucket=${this.bucket}&with_name=${e}&to_path=${encodeURIComponent(this.absolutePath)}`);return t.success||await(0,o.showErrorMessage)("Error","Could not get an upload url for this file!"),t.url}async _confirmOverride(e){return!this.files.get(e)||(await(0,o.showDialog)({title:"Warning!",body:"A file with this name already exists in this directory. If you continue it will be overwritten!",buttons:[o.Dialog.cancelButton({label:"Cancel"}),o.Dialog.okButton({label:"Continue"})]})).button.accept}}e.BucketDirectory=t;class n{constructor(e,t,n){this.isFile=!0,this._name=e,this.bucket=n,this._absolutePath=t,this._validate()}get name(){return this._name}get absolutePath(){return this._absolutePath}async download(){var e;try{const t=this.absolutePath;let n=null===(e=w.current)||void 0===e?void 0:e.model.path;n||(n=""),console.log("downloading to: ",n);const a=await h(`download?file=${encodeURIComponent(t)}&download_destination=${encodeURIComponent(n)}&bucket=${this.bucket}`);await(0,o.showDialog)({title:a.success?"Success!":"Failed!",body:`File ${this.name} was ${a.success?"":"not"} downloaded! \n ${a.message?a.message:""}`,buttons:[o.Dialog.okButton({label:"OK"})]})}catch(e){await(0,o.showErrorMessage)("Something went wrong!",e)}}async getDownloadUrl(){let e="";try{e=(await h(`download_url?file=${this.absolutePath}&bucket=${this.bucket}`)).url}catch(e){await(0,o.showErrorMessage)("Failed",e)}return e}async delete(){try{return await h(`objects/${encodeURIComponent(this.bucket)}/${encodeURIComponent(this.absolutePath)}`,{method:"DELETE"})}catch(e){await(0,o.showErrorMessage)("Failed",e)}}async rename(e){if(k(e)!==k(this.name)&&!(await(0,o.showDialog)({title:"Warning!",body:"If you change the file extension, the file might become unusable!",buttons:[o.Dialog.cancelButton({label:"Cancel"}),o.Dialog.okButton({label:"Continue"})]})).button.accept)return;const t=await h(`rename?path=${encodeURIComponent(this.absolutePath)}&new_name=${e}&bucket=${encodeURIComponent(this.bucket)}`);if(!t.success)throw new Error(`Could not rename file ${this.name} to ${e}!`);this._name=t.newData.name,this._absolutePath=t.newData.path}_validate(){if(!this.absolutePath.endsWith(this.name))throw new p(`Provided absolute path (${this.absolutePath}) does not lead to the provided file name (${this.name})!`)}}e.BucketFile=n}(E||(E={}));const C=(0,l.createContext)(void 0),D=({children:e})=>{const[t,n]=y(0,"last-accessed-bucket"),[a,r]=y(x.None,"autocomplete-option"),o={fileBrowser:(0,l.useMemo)((()=>new E({bucketEndPoint:"buckets",bucket:""})),[]),lastBucket:t,setLastBucket:n,autocompleteOption:a,setAutocompleteOption:r};return c().createElement(C.Provider,{value:o},e)},_=()=>{const e=(0,l.useContext)(C);if(void 0===e)throw new g("useBucketContext must be used within a BucketContextProvider");return e};var x;!function(e){e.None="no-preference",e.LastAccessed="save-last",e.Guess="guess"}(x||(x={}));const S=({name:e,onContextFinish:t,renameAction:n,children:a})=>{const[r,s]=(0,l.useState)(!1),d=_().fileBrowser;(0,l.useEffect)((()=>{const e=()=>s(!1);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[]);const m=(0,l.useCallback)((e=>{e.preventDefault(),s((e=>!e))}),[s]),h=(0,l.useCallback)((async()=>{var t,n;const a=null===(t=d.currentDirectory)||void 0===t?void 0:t.files.get(e);a?await a.download():await(0,o.showErrorMessage)("Download failed!",`Can't find file ${e} in directory ${null===(n=d.currentDirectory)||void 0===n?void 0:n.name}`)}),[e]),b=(0,l.useCallback)((async()=>{var t,n;const a=null===(t=d.currentDirectory)||void 0===t?void 0:t.files.get(e);if(a){const t=await a.getDownloadUrl(),n=document.createElement("a");n.href=t,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}else await(0,o.showErrorMessage)("Download failed!",`Can't find file ${e} in directory ${null===(n=d.currentDirectory)||void 0===n?void 0:n.name}. Please refresh and try again!`)}),[e]),p=(0,l.useCallback)((async()=>{var t,n;const a=null===(t=d.currentDirectory)||void 0===t?void 0:t.files.get(e);if(a){const t=await a.delete();if(!t)return;await(0,o.showDialog)({title:t.success?"Success!":"Failed!",body:`File ${e} was ${t.success?"":"not"} deleted! \n ${t.message?t.message:""}`,buttons:[o.Dialog.okButton({label:"OK"})]})}else await(0,o.showErrorMessage)("Deletion failed!",`Can't find file ${e} in directory ${null===(n=d.currentDirectory)||void 0===n?void 0:n.name}. Please refresh and try again!`)}),[e]),f=(0,l.useCallback)((async()=>{var t;let n="";try{const a=null===(t=d.currentDirectory)||void 0===t?void 0:t.files.get(e);if(!a)return void await(0,o.showErrorMessage)("ERROR",`Could not get details on file ${e}. Please refresh and try again!`);n=await a.getDownloadUrl(),await(0,o.showDialog)({title:"Your share URL:",body:c().createElement(c().Fragment,null,c().createElement("a",{href:n,className:"bucket-ShareLink"},n),c().createElement("p",null,"Copy and paste this url in a browser to download the file!"),c().createElement("p",{style:{color:"red"}},"* If this bucket is private this link will expire very soon.")),buttons:[o.Dialog.okButton({label:"Close"})]})}catch(e){await(0,o.showErrorMessage)("ERROR",e)}}),[e]);return c().createElement("div",{onContextMenu:m,className:"bucket-ContextMenu-container"},a,c().createElement("div",{className:"bucket-ContextMenu","aria-label":"context-menu",onClick:e=>e.stopPropagation(),style:{display:r?"block":"none"}},c().createElement("ul",null,c().createElement(u,{label:"Download",action:h,icon:i.downloadIcon}),c().createElement(u,{label:"Local Download",action:b,icon:i.downloadIcon}),c().createElement(u,{label:"Delete",action:p,icon:i.closeIcon,onContextFinish:t}),c().createElement(u,{label:"Rename",action:()=>{n(),s(!1)},icon:i.editIcon}),c().createElement(u,{label:"Share download url",action:f,icon:i.linkIcon}))))},$=()=>c().createElement("span",{className:"bucket-DownloadAnimation"},c().createElement("i",{className:"fa fa-arrow-down"})),N=()=>c().createElement("span",{className:"bucket-UploadAnimation"},c().createElement(i.fileUploadIcon.react,null)),L=({children:e,file:t})=>{const[n,a]=(0,l.useState)(!1),r=(0,l.useCallback)((e=>e.clientX>20&&e.clientX<280),[]),o=(0,l.useCallback)((async e=>{e.preventDefault(),e.stopPropagation(),r(e)&&(a(!0),await t.download(),a(!1))}),[]);return c().createElement("div",{draggable:!n,onDragEnd:o,className:"align-flex-horizontal"},e,n&&c().createElement($,null))};function R({tag:e,metadata:t,onClick:n,onContextFinish:a}){const[r,s]=(0,l.useState)(!1),u=_().fileBrowser,d=(0,l.useRef)(null),[m,h,b]=(({hasLoader:e,displayInfo:t})=>{const[n,a]=(0,l.useState)(!1),[r,o]=(0,l.useState)(t||""),s={display:n?"flex":"none"};return[()=>c().createElement("div",{style:s,className:"bucket-Tooltip"},e&&c().createElement("span",{className:"bucket-Spinner"}),c().createElement("p",null,r)),o,a]})({hasLoader:!0});(0,l.useEffect)((()=>{var e;const t=async e=>{var n;e.stopPropagation(),"Enter"===e.key&&(e.preventDefault(),b(!0),h("Renaming file..."),await p(),b(!1),null===(n=d.current)||void 0===n||n.removeEventListener("keypress",t),s(!1))};return r&&(null===(e=d.current)||void 0===e||e.addEventListener("keypress",t)),()=>{var e;return null===(e=d.current)||void 0===e?void 0:e.removeEventListener("keypress",t)}}),[r]);const p=async()=>{var e;const n=null===(e=u.currentDirectory)||void 0===e?void 0:e.files.get(t.name);if(n)try{const e=d.current?d.current.value:t.name;await n.rename(e),await a()}catch(e){await(0,o.showErrorMessage)("Failed to rename",e)}else{const e=`File ${t.name} could not be found!`;(0,o.showErrorMessage)("ERROR",e).then((()=>console.error(e)))}};return c().createElement(I.Wrapper,{tag:e},t.isFile?c().createElement(i.fileIcon.react,{tag:"span",right:"7px",className:"jp-DirListing-itemIcon"}):c().createElement(i.folderIcon.react,{tag:"span",right:"7px",className:"jp-DirListing-itemIcon"}),t.isFile?c().createElement(S,{name:t.name,onContextFinish:a,renameAction:()=>s(!0)},c().createElement(m,null),c().createElement(L,{file:t},r?c().createElement("input",{"aria-label":"rename-input",defaultValue:t.name,ref:d}):c().createElement("p",{onClick:n},t.name))):c().createElement("p",{onClick:n,style:{cursor:"pointer"}},t.name))}var I;!function(e){e.Wrapper=({tag:e,children:t})=>c().createElement(c().Fragment,null,"li"===e?c().createElement("li",{className:"bucket-BrowserListItem"},t):c().createElement("div",null,t))}(I||(I={}));const P=e=>!1===e.show?c().createElement(c().Fragment,null):c().createElement("div",{className:"jp-SpinnerContent"});var F=n(694),B=n(526);const M=({show:e,finishAction:t})=>{const[n,a]=(0,l.useState)("default"),[r,s]=(0,l.useState)(!1),i=(0,l.useRef)(r);(0,l.useEffect)((()=>{i.current=r}),[r]);const u=(0,l.useRef)(null),d=_().fileBrowser,m=(0,l.useMemo)((()=>({title:"Not allowed!",error:"Please wait for the previous upload to finish!"})),[]),h=(0,l.useCallback)((e=>{var t;if(2===e.button)return;const n=e.target,a=null===(t=w.current)||void 0===t?void 0:t.selectedItems();if(null==a)return;const r=[];let o=!1,s=null==a?void 0:a.next();for(;s;)r.push(s),s.name===(null==n?void 0:n.innerText)&&(o=!0),s=null==a?void 0:a.next();if(!o)return void console.warn("Did not start a drag operation!");const l=r[0],c={source:l,action:async()=>{var e;const[t,n]=[l.path,l.name];await(null===(e=d.currentDirectory)||void 0===e?void 0:e.upload(t,n))}},i=new F.Drag({mimeData:new B.MimeData,source:c,proposedAction:"copy"});i.mimeData.setData("text/plain",JSON.stringify(l)),i.start(e.clientX,e.clientY).then((()=>console.log("drag ended")))}),[]),b=(0,l.useMemo)((()=>{const e={handleEvent:t=>{switch(console.log("handling: ",t.type),t.type){case"lm-dragenter":e._dragEnter(t);break;case"lm-dragover":e._dragOver(t);break;case"lm-drop":e._drop(t).then((()=>console.log("drop handled")));break;case"lm-dragleave":e._dragLeave(t)}},_dragEnter:e=>{e.preventDefault(),e.stopPropagation(),a("hover"),F.Drag.overrideCursor("pointer")},_dragOver:e=>{e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction,F.Drag.overrideCursor("pointer"),a("hover")},_dragLeave:e=>{e.preventDefault(),e.stopPropagation(),F.Drag.overrideCursor("auto"),a("default")},_drop:async e=>{e.preventDefault(),e.stopPropagation(),i.current?await(0,o.showErrorMessage)(m.title,m.error):(s(!0),e.source&&e.source.action?(await e.source.action(),await t()):console.warn("Did not upload file to bucket since drag initiator does not provide an action!"),F.Drag.overrideCursor("auto"),a("default"),s(!1))}};return e}),[]);(0,l.useEffect)((()=>{var e,t,n,a,r;null===(e=u.current)||void 0===e||e.addEventListener("lm-dragenter",b),null===(t=u.current)||void 0===t||t.addEventListener("lm-dragleave",b),null===(n=u.current)||void 0===n||n.addEventListener("lm-dragover",b),null===(a=u.current)||void 0===a||a.addEventListener("lm-drop",b);const o=null===(r=w.current)||void 0===r?void 0:r.node;return null==o||o.addEventListener("mousedown",h),()=>{var e,t,n,a;null==o||o.removeEventListener("mousedown",h),null===(e=u.current)||void 0===e||e.removeEventListener("lm-dragenter",b),null===(t=u.current)||void 0===t||t.removeEventListener("lm-dragleave",b),null===(n=u.current)||void 0===n||n.removeEventListener("lm-dragover",b),null===(a=u.current)||void 0===a||a.removeEventListener("lm-drop",b)}}),[]);const p=(0,l.useCallback)((e=>{e.preventDefault(),a("hover")}),[]),f=(0,l.useCallback)((e=>{e.preventDefault(),a("default")}),[]),v=(0,l.useCallback)((async e=>{var n,r;if(e.preventDefault(),e.stopPropagation(),i.current)await(0,o.showErrorMessage)(m.title,m.error);else{if(s(!0),e.dataTransfer.files&&e.dataTransfer.files[0])if(e.dataTransfer.files.length>1)await(0,o.showErrorMessage)("Unsupported","Currently you can only upload a file at a time!");else try{const a=e.dataTransfer.files[0],s=a.name,l=await(null===(n=d.currentDirectory)||void 0===n?void 0:n.getUploadUrl(s));if(!l)return;(await fetch(l,{method:"PUT",body:a})).ok&&(await(0,o.showDialog)({title:"Upload Success!",body:`${s} was uploaded to ${null===(r=d.currentDirectory)||void 0===r?void 0:r.absolutePath}/${s}`,buttons:[o.Dialog.okButton({label:"OK"})]}),await t())}catch(e){await(0,o.showErrorMessage)("Upload Failed",e)}s(!1),a("default")}}),[]);return c().createElement("div",{className:`bucket-DropZone ${n}`,ref:u,onDragOver:p,onDragLeave:f,onDrop:v,style:{display:e?"block":"none"}},r?c().createElement(c().Fragment,null,c().createElement("p",{className:"bucket-text-info"},"Uploading files..."),c().createElement(N,null)):c().createElement("p",{className:"bucket-text-info"},"Drop your files here for upload."))},O=(0,l.forwardRef)((({data:e,showList:t,setShowList:n},a)=>{const{error:r,loading:o,searchMatchingValues:s,setChosenValue:l}=e;return c().createElement("div",{ref:a},r&&c().createElement("p",{style:{color:"red"}},r),o?c().createElement("span",{className:"jp-Spinner"}):c().createElement(c().Fragment,null,c().createElement("span",{className:"error"},r.toString()),c().createElement("ul",{className:"available-buckets",style:{visibility:t?"visible":"hidden"}},s.map((e=>c().createElement("li",{onClick:t=>{l(e),n(!1)},key:e},e))))))}));function U(e,t,n){const[a,r]=(0,l.useState)(e),o=(0,l.useRef)(null),s=e=>{var a,s,l;const c=e.target;!function(e){if(!e||!("nodeType"in e))throw new TypeError("Node expected")}(c),(null===(s=null===(a=null==t?void 0:t.refToIgnore)||void 0===a?void 0:a.current)||void 0===s?void 0:s.contains(c))||o.current&&!(null===(l=null==o?void 0:o.current)||void 0===l?void 0:l.contains(c))&&r(void 0!==n&&n)};return(0,l.useEffect)((()=>(document.addEventListener("click",s,!0),()=>{document.removeEventListener("click",s,!0)})),[]),{ref:o,isComponentVisible:a,setIsComponentVisible:r}}const A=()=>{const{autocompleteOption:e,setAutocompleteOption:t}=_(),{ref:n,isComponentVisible:a,setIsComponentVisible:r}=U(!1);return c().createElement("span",{className:"bucket-Settings-container",ref:n},c().createElement("span",{onClick:e=>{r((e=>!e))},className:"bucket-Settings-toggle"},c().createElement(i.settingsIcon.react,null)),c().createElement("div",{className:"bucket-Settings",style:{display:a?"block":"none"}},c().createElement("h4",null,"Settings"),c().createElement("hr",null),c().createElement("div",{className:"bucket-Preferences-container",onChange:e=>{t(e.target.value)}},c().createElement("p",{title:"After setting an option refresh the page for the setting to have effect!"},"Auto-complete:"),c().createElement("div",null,c().createElement("input",{type:"radio",name:"bucket-preferences",id:"no-preference",value:x.None,defaultChecked:e===x.None||null===e}),c().createElement("label",{htmlFor:"no-preference",title:"On opening bucket extension, bucket name will not be completed automatically"},"No auto-complete")),c().createElement("div",null,c().createElement("input",{type:"radio",name:"bucket-preferences",id:"save-last",value:x.LastAccessed,defaultChecked:e===x.LastAccessed}),c().createElement("label",{htmlFor:"save-last",title:"On opening the bucket extension, bucket name will be autocompleted with the name of the last accessed bucket."},"Last accessed bucket")),c().createElement("div",null,c().createElement("input",{type:"radio",name:"bucket-preferences",id:"guess",value:x.Guess,defaultChecked:e===x.Guess}),c().createElement("label",{htmlFor:"guess",title:"On opening bucket extension, will try to autocomplete bucket name by guessing the bucket from collab."},"Estimated bucket")))))},V=()=>{const[e,t]=(0,l.useState)(null),[n,a]=(0,l.useState)(!1),{fileBrowser:r,lastBucket:s,setLastBucket:u,autocompleteOption:d}=_(),m=(()=>{const[e,t]=(0,l.useState)(!0),[n,a]=(0,l.useState)(""),[r,o]=(0,l.useState)([]),[s,c]=(0,l.useState)(""),[i,u]=(0,l.useState)(""),[d,m]=(0,l.useState)([]);return(0,l.useEffect)((()=>{let e=!0;return e&&h("buckets_list").then((e=>{o(e),m(e),t(!1)})).catch((e=>{a(e)})),()=>{e=!1}}),[]),(0,l.useEffect)((()=>{const e=r.filter((e=>e.includes(s)));m(e)}),[s]),(0,l.useEffect)((()=>{c(i)}),[i]),{loading:e,searchValue:s,setSearchValue:c,searchMatchingValues:d,error:n,chosenValue:i,setChosenValue:u}})(),{searchValue:b,setSearchValue:p,setChosenValue:f}=m,v=(0,l.useRef)(null),{isComponentVisible:g,setIsComponentVisible:w,ref:k}=U(!1,{refToIgnore:v}),E=(0,l.useCallback)((e=>()=>{a(!0),e().then((()=>{a(!1)}))}),[]),y=(0,l.useCallback)(E((async()=>{const e=await r.openBucket();e&&t(e),u(r.bucket)})),[r]),C=(0,l.useCallback)(E((async()=>{if(!r.currentDirectory)return;const e=await r.cd();t(e)})),[r]);return(0,l.useEffect)((()=>{r.bucket=b}),[b,r]),(0,l.useEffect)((()=>{d===x.Guess?async function(){const e=await h("guess_bucket");if(!e.success)throw new Error(e.message);return e.bucket}().then((e=>f(e))).catch((e=>{(0,o.showErrorMessage)("ERROR",e).then((()=>{console.warn("Did not estimate a bucket!"),f("")}))})):d===x.None||null===d?f(""):f(null!=s?s:"")}),[]),c().createElement(c().Fragment,null,c().createElement("div",null,c().createElement("div",{className:"bucket-logo"},c().createElement("span",{className:"collab-logo"}),c().createElement("span",{className:"bucket-logo-text"},"Bucket"),c().createElement(A,null)),c().createElement("span",{ref:v},c().createElement("input",{type:"text",value:b,"aria-label":"bucket-name-input",placeholder:"bucket-name",onChange:e=>p(e.target.value),onFocus:e=>w(!0)})),c().createElement("button",{onClick:y},"Connect!"),c().createElement(O,{data:m,showList:g,setShowList:w,ref:k})),c().createElement("div",{className:"bucket-BreadCrumbs"},c().createElement("span",{onClick:C},c().createElement(i.folderIcon.react,{tag:"span",className:"bucket-home"})),r.breadcrumbs.map(((e,n)=>c().createElement("span",{key:n,className:"bucket-BreadCrumbs-Item","aria-label":`breadcrumb-${n}`,onClick:E((async()=>{const e=await r.goTo(r.breadcrumbs[n].name);t(e)}))},0===n&&"/",e.name,"/")))),c().createElement(P,{show:n}),c().createElement("ul",{style:{display:n?"none":"block"},className:"scrollableY"},null==e?void 0:e.ls().map((e=>{let n=()=>{};return e.isFile||(n=E((async()=>{const n=await r.cd(e.name);t(n)}))),c().createElement(R,{tag:"li",metadata:e,key:e.name,onClick:n,onContextFinish:y})}))),c().createElement(M,{show:!n&&null!==e,finishAction:y}))};class T extends o.ReactWidget{constructor(){super(),this.addClass("tvb-bucketWidget")}render(){return c().createElement("div",{className:"bucket-container"},c().createElement(D,null,c().createElement(V,null)))}}const W={id:"tvb-ext-bucket:plugin",autoStart:!0,requires:[o.ICommandPalette,a.ILayoutRestorer,s.IConsoleTracker,a.ILabShell,r.IFileBrowserFactory],activate:(e,t,n,a,r,s)=>{console.log("JupyterLab extension tvb-ext-bucket is activated!");const l=s.defaultBrowser;w.current=l;const c="tvb-ext-bucket",i=new T;i.id=c,i.title.iconClass="bucket-CollabLogo jp-SideBar-tabIcon",i.title.caption="Bucket",r.add(i,"right",{rank:200});const u=new o.WidgetTracker({namespace:"bucket"});n.add(i,c),n.restore(u,{command:"tvbextbucket:open",name:()=>"bucket"})}}}}]);