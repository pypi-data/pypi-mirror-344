# CSToolbox (ChatSpeed Toolbox)

ç®€ä½“ä¸­æ–‡ | [English](README.MD)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

CSToolbox æ˜¯ [ChatSpeed](https://github.com/aidyou/chatspeed) çš„æ‰©å±•å·¥å…·é›†ï¼Œé€šè¿‡ MCP åè®®æä¾›ç½‘ç»œæœç´¢ã€ç½‘é¡µå†…å®¹çˆ¬å–å’Œå›¾è¡¨ç”Ÿæˆç­‰åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **ç½‘ç»œæœç´¢** - æ”¯æŒå¤šç§æœç´¢å¼•æ“ï¼ˆGoogleã€Bingã€ç™¾åº¦ç­‰ï¼‰
- ğŸ•·ï¸ **ç½‘é¡µçˆ¬å–** - ä»ç½‘é¡µæå–ç»“æ„åŒ–å†…å®¹ï¼ˆæ”¯æŒ Markdown/HTML æ ¼å¼ï¼‰
- ğŸ“Š **å›¾è¡¨ç”Ÿæˆ** - å¿«é€Ÿç”Ÿæˆå„ç±»æ•°æ®å¯è§†åŒ–å›¾è¡¨ï¼Œæ”¯æŒæ›²çº¿å›¾ã€æŸ±çŠ¶å›¾å’Œé¥¼å›¾
- ğŸ“„ **PDFå¤„ç†** - ä»PDF URL ä¸‹è½½æ–‡æ¡£å¹¶æå–æ–‡æœ¬å†…å®¹

## å¦‚ä½•ä½¿ç”¨

### mcp å®¢æˆ·ç«¯é…ç½®

``` json
{
  "mcpServers": {
    "cstoolbox": {
      "command": "uvx",
      "args": [
        "cstoolbox"
      ],
      "env": {
        "CS_LOG_LEVEL": "DEBUG",
        "CS_LOG_DIR": "logs",
        "CS_PROXY": "http://localhost:15154",
        "CS_BROWSER_TZ": "Asia/Shanghai",
        "CS_BROWSER_LANG": "zh-CN",
        "CS_REGION": "com",
        "CS_HEADLESS": "true",
        "CS_BROWSER_TYPE": "chromium",
        "CS_EXECUTABLE_PATH": "/Applications/Google Chrome.app/Contents/MacOS/Google Chrome",
        "CS_USER_DATA_DIR": "~/Library/Application Support/Google/Chrome"
      }
    }
  }
}
```

#### ç¯å¢ƒå˜é‡è¯´æ˜

- `CS_LOG_LEVEL`ï¼šæ—¥å¿—çº§åˆ«ï¼Œå¯é€‰å€¼ä¸º `DEBUG`ã€`INFO`ã€`WARNING`ã€`ERROR`ã€`CRITICAL`ï¼Œé»˜è®¤ä¸º `INFO`
- `CS_LOG_DIR`ï¼šæ—¥å¿—ç›®å½•ï¼Œé»˜è®¤ä¸º `logs`
- `CS_PROXY`ï¼šä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œæœ‰äº›åœ°åŒºæ— æ³•è®¿é—® `google.com` æˆ–è€… `bing.com` æœç´¢å¼•æ“ï¼Œå› æ­¤éœ€è¦è®¾ç½®ä»£ç†ï¼Œå¦å¤–ï¼Œæœ‰äº›ç½‘ç«™å¯¹ç”¨æˆ·æ‰€åœ¨åœ°åŒºæœ‰é™åˆ¶ï¼Œå¦‚æœæ²¡æœ‰ä»£ç†ä¹Ÿæ˜¯è®¿é—®ä¸äº†çš„
- `CS_BROWSER_TZ`ï¼šæ—¶åŒºï¼Œé»˜è®¤ä¸º `Etc/UTC`
- `CS_BROWSER_LANG`ï¼šæµè§ˆå™¨è¯­è¨€ï¼Œé»˜è®¤ä¸º `en-US`
- `CS_REGION`ï¼šæœç´¢å¼•æ“åŒºåŸŸï¼Œå¯é€‰å€¼ä¸º `com`ã€`cn`ã€`us`ã€`uk`ç­‰ï¼Œé»˜è®¤ä¸º `com`
- `CS_HEADLESS`ï¼šæ˜¯å¦å¯ç”¨æ— å¤´æ¨¡å¼ï¼Œé»˜è®¤ä¸º `true`
- `CS_BROWSER_TYPE`ï¼šæµè§ˆå™¨ç±»å‹ï¼Œå¯é€‰å€¼ä¸º `chromium`ã€`firefox`ã€`webkit`ï¼Œé»˜è®¤ä¸º `chromium`
- `CS_EXECUTABLE_PATH`ï¼šæµè§ˆå™¨å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤ä¸ºç©ºã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥æŒ‡å®šç³»ç»Ÿå·²å®‰è£…çš„æµè§ˆå™¨è·¯å¾„ï¼Œè¿™æ ·å°±å¯ä»¥åˆ©ç”¨ä½ ç³»ç»Ÿçš„æµè§ˆå™¨çš„çŠ¶æ€æ•°æ®ï¼ˆå¦‚ç™»å½•çŠ¶æ€ã€cookiesç­‰ï¼‰ã€‚å¦‚æœä½ æŒ‡å®šäº†`CS_EXECUTABLE_PATH`ï¼Œåˆ™å¾æ³¨æ„`CS_BROWSER_TYPE`ç±»å‹åŒ¹é…
- `CS_USER_DATA_DIR`ï¼šç”¨æˆ·æ•°æ®ç›®å½•ï¼Œå¦‚æœä½ æŒ‡å®šäº†`CS_EXECUTABLE_PATH`ï¼Œå»ºè®®å°†`CS_USER_DATA_DIR`è®¾ç½®ä¸ºæµè§ˆå™¨çš„ã€Œä¸ªäººèµ„æ–™è·¯å¾„ã€çš„ä¸Šä¸€çº§ã€‚

#### å¦‚ä½•è·å¾— chrome è·¯å¾„å’Œä¸ªäººèµ„æ–™è·¯å¾„

1. æ‰“å¼€ chrome æµè§ˆå™¨
2. åœ¨åœ°å€æ è¾“å…¥ `chrome://version/`
3. åœ¨ç•Œé¢ä¸Šä½ å¯ä»¥çœ‹åˆ°ç±»ä¼¼ã€Œå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ã€ï¼Œè·¯å¾„ç±»ä¼¼`/Applications/Google Chrome.app/Contents/MacOS/Google Chrome`ï¼Œè¿™ä¸ªè·¯å¾„å°±æ˜¯ä½ è¦è®¾ç½®çš„`CS_EXECUTABLE_PATH`
4. æ‰¾åˆ°ã€Œä¸ªäººèµ„æ–™è·¯å¾„ã€ï¼Œè·¯å¾„ç±»ä¼¼`/Users/xxx/Library/Application Support/Google/Chrome/Default`ï¼Œ`CS_USER_DATA_DIR`çš„å€¼å°±æ˜¯`/Users/xxx/Library/Application Support/Google/Chrome`ï¼ˆæ³¨æ„è·¯å¾„ä¸åŒ…å«æœ€åçš„`Default`ï¼‰ã€‚

#### âš ï¸æ³¨æ„äº‹é¡¹

- éƒ¨åˆ†åœ°åŒºä½¿ç”¨ `google` æˆ–è€… `bing` è¿›è¡Œç½‘ç»œæœç´¢æ—¶éœ€ç¡®ä¿ä»£ç†è®¾ç½®æ­£ç¡®
- `CS_EXECUTABLE_PATH`æœ€å¥½ä¸è¦è®¾ç½®æˆä½ å½“å‰æ­£åœ¨ä½¿ç”¨çš„æµè§ˆå™¨ï¼Œé‚£æ ·ä¼šå†²çªï¼Œä½ å¦‚æœä¹ æƒ¯äº†ä½¿ç”¨ `google chrome`ï¼Œåˆ™å¯ä»¥å®‰è£… [edge](https://www.microsoft.com/en-us/edge/download)ã€[brave](https://brave.com/download/) ç­‰ chromium å†…æ ¸çš„æµè§ˆå™¨ï¼Œåä¹‹å¦‚æœä½ ä¹ æƒ¯ä½¿ç”¨ `edge` æµè§ˆå™¨ï¼Œåˆ™å¼ºçƒˆå»ºè®®ä½ å®‰è£…ä¸ª [google chrome](https://www.google.com/intl/en_au/chrome/dr/download/)ã€‚

#### MCP é…ç½®æ¨è

``` json
{
  "mcpServers": {
    "cstoolbox": {
      "command": "uvx",
      "args": [
        "cstoolbox"
      ],
      "env": {
        "CS_PROXY": "http://{your-proxy-server}",
        "CS_HEADLESS": "false",
        "CS_BROWSER_TYPE": "chromium",
        "CS_EXECUTABLE_PATH": "/Applications/Google Chrome.app/Contents/MacOS/Google Chrome",
        "CS_USER_DATA_DIR": "~/Library/Application Support/Google/Chrome"
      }
    }
  }
}
```

### python è°ƒç”¨ç¤ºä¾‹

æ›´å¤š python è°ƒç”¨ç¤ºä¾‹è¯·å‚è€ƒ`tests/mcp_client.py`æ–‡ä»¶

```python
from pathlib import Path

from mcp import ClientSession, StdioServerParameters, types
from mcp.client.stdio import stdio_client

project_root = Path(__file__).resolve().parent.parent

# Create server parameters for stdio connection
server_params = StdioServerParameters(
    command="python",
    args=[f"{project_root}/src/cstoolbox/main.py"],  # Path to cstoolbox mcp main.py
    env={
        "CS_PROXY": "http://localhost:15154",
        "CS_BROWSER_TZ": "Asia/Shanghai",
        "CS_BROWSER_LANG": "zh-CN"
    },
)


# Optional: create a sampling callback
async def handle_sampling_message(
    message: types.CreateMessageRequestParams,
) -> types.CreateMessageResult:
    return types.CreateMessageResult(
        role="assistant",
        content=types.TextContent(
            type="text",
            text="Hello, world! from model",
        ),
        model="gpt-3.5-turbo",
        stopReason="endTurn",
    )


async def run():
    async with stdio_client(server_params) as (read, write):
        async with ClientSession(read, write, sampling_callback=handle_sampling_message) as session:
            # Initialize the connection
            await session.initialize()

            # List available tools
            tools = await session.list_tools()

            # Call a web search tool
            result = await session.call_tool(
                "web_search",
                arguments={"provider": "bing", "kw": "deepseek r2", "number": 10, "page": 1, "time_period": "month"},
            )
            print(result)

if __name__ == "__main__":
    import asyncio

    asyncio.run(run())

```

## å¼€å‘

1. å…‹éš†æºä»£ç ä»“åº“:

```bash
git clone https://github.com/aidyou/cstoolbox.git
cd cstoolbox
```

2. å®‰è£… uv
**Macos/Linux**

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

**Windows**ä½¿ç”¨`irm`ä¸‹è½½å¹¶å®‰è£…

```bash
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
```

3. åˆ›å»ºå¹¶æ¿€æ´»venvç¯å¢ƒ:

```bash
uv venv --python=python3.12
source .venv/bin/activate
```

4. å®‰è£…ä¾èµ–:

```bash
uv pip install .
```

5. å¯åŠ¨æµ‹è¯•:

```bash
mcp dev src/cstoolbox/main.py
```

ç°åœ¨ä½ å¯ä»¥é€šè¿‡`http://127.0.0.1:6274/#tools` è¿›è¡ŒåŠŸèƒ½æµ‹è¯•

6. http æ¥å£æµ‹è¯•
åœ¨`.vscode/launch.json`æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "http dev",
            "type": "debugpy",
            "request": "launch",
            "module": "cstoolbox.http_api",
            "args": [
            ],
            "console": "integratedTerminal",
            "env": {
                "PYTHONPATH": "${workspaceFolder}/src",
                "CS_BROWSER_TZ": "Asia/Shanghai",
                "CS_BROWSER_LANG": "zh-CN",
                "CS_LOG_LEVEL": "DEBUG",
                "CS_PROXY": "http://localhost:15154"
            },
            "python": "${workspaceFolder}/.venv/bin/python"
        }
    ]
}
```

`env`é…ç½®ä¸­`CS_*`è¯·æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œåœ¨ vscode ä¸­å¯åŠ¨è°ƒè¯•åå³å¯é€šè¿‡å¦‚ä¸‹æ¥å£è¿›è¡Œæµ‹è¯•ï¼š

- æœç´¢ï¼š `curl http://localhost:12321/chp/web_search?provider=google&kw=deepseek+r2&number=10&page=1`
- å†…å®¹æŠ“å–ï¼š`curl http://localhost:12321/chp/web_crawler?url=https://medium.com/@lbq999/deepseek-r2-is-around-the-corner-c449a41bfec6`

## åè®®

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT åè®®](LICENSE) å¼€æºï¼Œæ‚¨å¯ä»¥è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘æœ¬è½¯ä»¶ã€‚
