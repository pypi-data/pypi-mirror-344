"use strict";(self.webpackChunk_jovyanai_labextension=self.webpackChunk_jovyanai_labextension||[]).push([[583],{7973:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Me});var o=n(4970),r=n(8612),a=n(5338),l=n(3345),c=n.n(l),s=n(1623),i=n(7144);let d="wss://backend.jovyan-ai.com",u=null,m=!1,h=null,g=!1;const p=async e=>{console.debug("Initializing client from settings...");let t=null,n=null;try{if(t=await e.load("@jovyanai/labextension:plugin"),d=t.get("backendUrl").composite,n=t.get("authToken").composite,console.debug(`Loaded settings: backendUrl=${d}, authToken=${n?"***":"<empty>"}`),n)console.debug("Using auth token from settings.");else{console.debug("Auth token missing in settings, attempting to fetch from backend...");const e=await(async()=>{try{const e=i.ServerConnection.makeSettings(),t=await i.ServerConnection.makeRequest(`${e.baseUrl}jovyanai_token`,{method:"GET"},e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();return n&&n.token?(console.info("[JovyanAI] Fetched token from backend."),n.token):(console.info("[JovyanAI] Backend endpoint did not provide a token."),null)}catch(e){return console.error("Failed to fetch token from backend:",e),null}})();if(e){n=e;try{await t.set("authToken",e),console.debug("Saved fetched token to settings.")}catch(e){console.error("Failed to save fetched token to settings:",e)}}else console.warn("Could not retrieve auth token from settings or backend.")}console.debug("Creating new JovyanClient instance."),u=new s.JovyanClient(d,n||"",""),m=!1,h=null,g=!1,console.debug("JovyanClient instance created (not connected yet).")}catch(e){console.error("Failed to load settings or create client instance:",e),u=null,m=!1,h=null,g=!1}},v=async()=>{if(!u)throw console.error("getJovyanClient called before instance was successfully created."),new Error("JovyanClient instance not available. Initialization might have failed.");if(g)return console.debug("getJovyanClient: Already connected."),u;if(m&&h){console.debug("getJovyanClient: Connection in progress, waiting...");try{if(await h,g)return console.debug("getJovyanClient: Waited for connection, now connected."),u;throw console.warn("getJovyanClient: Waited for connection, but it failed."),new Error("Connection attempt failed.")}catch(e){throw console.error("getJovyanClient: Error while waiting for connection:",e),e}}console.debug("getJovyanClient: Not connected, initiating connection..."),m=!0;const e=u;h=(async()=>{try{return await e.connect(),console.debug("getJovyanClient: Connection and session successful."),g=!0,e}catch(e){throw console.error("getJovyanClient: Failed to connect/start session:",e),g=!1,h=null,e}finally{m=!1,console.debug("getJovyanClient: Connection attempt finished.")}})();try{return await h,e}catch(e){throw e}},C=()=>g,b=({onClick:e,text:t})=>{const[n,o]=(0,l.useState)(!1),r=/Mac/i.test(navigator.userAgent),a=r?"⌘K":"^K",s=r?"Cmd+K":"Ctrl+K";return c().createElement("div",{className:"jv-cell-ai-button-container"},c().createElement("button",{className:"jv-cell-ai-button",title:`Generate code ${a}`,onClick:e,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1)},t," ",c().createElement("span",{style:{fontSize:"0.8em"}},a)),n&&c().createElement("div",{className:"jv-cell-ai-tooltip"},"Open the prompt box to instruct AI (",s,")"))},y=({onClick:e,text:t})=>{const[n,o]=(0,l.useState)(!1);return c().createElement("div",{className:"jv-cell-fix-error-container"},c().createElement("button",{className:"jv-cell-fix-error-button",title:"Fix Error ⇧F",onClick:e,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1)},t," ",c().createElement("span",{style:{fontSize:"0.8em"}},"⇧F")),n&&c().createElement("div",{className:"jv-cell-fix-error-tooltip"},"Fix this error with AI (","Shift+F",")"))};var f=n(8880);const k=({onClick:e,disabled:t=!1,className:n,children:o})=>c().createElement("button",{onClick:e,disabled:t,className:n||"jv-default-button",style:{cursor:t?"not-allowed":"pointer",opacity:t?.6:1}},o),E=({isEnabled:e,placeholderEnabled:t,placeholderDisabled:n,initialInput:o,onSubmit:r,onCancel:a})=>{const[s,i]=(0,l.useState)(o||""),d=c().useRef(null),u=()=>{var e;const t=(null===(e=d.current)||void 0===e?void 0:e.getValue())||s;""!==t.trim()&&(r(t),i(""))};return c().createElement("div",{className:"jv-cell-ai-input-container"},c().createElement("div",{className:"jv-cell-ai-input-editor"},c().createElement(f.Editor,{defaultLanguage:"markdown",theme:"true"===document.body.getAttribute("data-jp-theme-light")?"vs":"vs-dark",value:s,onChange:e=>{void 0!==e&&i(e)},onMount:(e,t)=>{d.current=e,e.onKeyDown((async t=>{(()=>{const t=e.getContainerDomNode().querySelector(".editor-widget.suggest-widget.visible");return null!==t&&"true"===t.getAttribute("monaco-visible-content-widget")})()||("Escape"===t.code&&(t.preventDefault(),a()),"Enter"===t.code&&(t.preventDefault(),t.shiftKey?e.trigger("keyboard","type",{text:"\n"}):u()))})),e.focus()},options:{minimap:{enabled:!1},lineNumbers:"off",glyphMargin:!1,folding:!1,wordWrap:"on",wrappingIndent:"same",automaticLayout:!0,scrollBeyondLastLine:!1,readOnly:!e,placeholder:e?t:n}})),c().createElement("div",{className:"jv-cell-ai-input-buttons"},c().createElement(k,{onClick:u,disabled:!e||""===s.trim(),className:"jv-cell-ai-input-submit-button"},"Submit",c().createElement("span",{style:{fontSize:"0.7em",marginLeft:"5px"}},"Enter")),c().createElement(k,{onClick:a,className:"jv-cell-ai-input-cancel-button"},"Cancel",c().createElement("span",{style:{fontSize:"0.7em",marginLeft:"5px"}},"Escape"))))};var x=n(5024),w=n(195),A=n(5963),N=n(9576),S=n(9303);const _=({onClick:e,className:t,text:n,shortcut:o,tooltip:r})=>{const[a,s]=(0,l.useState)(!1);return c().createElement("div",{className:"jv-cell-diff-review-button-container"},c().createElement("button",{onClick:e,className:t,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),title:`${n} ${o}`},n," ",c().createElement("span",{style:{fontSize:"0.7em"}},o)),a&&c().createElement("div",{className:"tooltip"},r,c().createElement("br",null),"Shortcut: ",c().createElement("strong",null,o)))},j=({buttonsRef:e,onAcceptAndRun:t,onAccept:n,onReject:o})=>((0,l.useEffect)((()=>{e.current&&e.current.focus({preventScroll:!0})}),[]),c().createElement("div",{className:"jv-diff-review-buttons-container",tabIndex:0,ref:e,onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),e.shiftKey||e.metaKey||e.ctrlKey?e.shiftKey&&document.querySelector(".accept-and-run-button").click():document.querySelector(".accept-button").click()):"m"===e.key&&(e.metaKey||e.ctrlKey)?(e.preventDefault(),document.querySelector(".edit-prompt-button").click()):"Escape"===e.key&&(e.preventDefault(),document.querySelector(".reject-button").click())},onBlur:()=>{e.current&&e.current.focus({preventScroll:!0})}},c().createElement(_,{onClick:t,className:"accept-and-run-button",text:"Accept & Run",shortcut:"Shift + Enter",tooltip:"Accept the changes and run the code in the current cell."}),c().createElement(_,{onClick:o,className:"reject-button",text:"Reject",shortcut:"Escape",tooltip:"Reject the changes and revert to the original code."}),c().createElement(_,{onClick:n,className:"accept-button",text:"Accept",shortcut:"Enter",tooltip:"Accept the changes and keep the code in the current cell."})));var T=n(5926);const I=({activeCell:e,oldCode:t,generateCodeStream:n,acceptCodeHandler:o,rejectCodeHandler:r,editPromptHandler:a,acceptAndRunHandler:s,prompt:i,retryHandler:d})=>{const[u,m]=(0,l.useState)(null),[h,g]=(0,l.useState)(null),[p,v]=(0,l.useState)(""),[C,b]=(0,l.useState)(!1),[y,f]=(0,l.useState)("Thinking..."),k=(0,l.useRef)(null),[E,_]=(0,l.useState)(!1),[I,R]=(0,l.useState)(!1),D=(0,l.useRef)(null),P=(0,l.useRef)(!1);(0,l.useEffect)((()=>{if(e&&void 0!==t){const n=function(e,t,n,o=!1){const r=[(0,N.Hg)(),S.jupyterTheme,x.EditorView.editable.of(!1),w.EditorState.readOnly.of(!0),(0,x.highlightSpecialChars)()];o||r.push((0,A.unifiedMergeView)({original:t,mergeControls:!1,gutter:!1}));const a=new x.EditorView({state:w.EditorState.create({doc:n,extensions:r}),parent:e.editor.dom});return e.editor.dom.classList.add("hidden-editor"),o&&a.dom.classList.add("new-code-generation"),a.dom.classList.add("streaming-now"),e.host.appendChild(a.dom),a}(e.editor,t,t,""===t.trim());m(n)}e.node.scrollIntoView({behavior:"smooth",block:"center"})}),[e,t]),(0,l.useEffect)((()=>{(async()=>{try{R(!1),f("Thinking..."),v(""),b(!1),P.current=!1,g(n)}catch(e){console.error("Error generating code stream:",e),b(!0),R(!0),f("Error generating code. Please try again.")}})()}),[n]),(0,l.useEffect)((()=>(h&&(async()=>{P.current=!1,R(!1),D.current=setTimeout((()=>{P.current||(b(!0),R(!0),f("Error: Server took too long to respond. Please try again."))}),12e4);try{for await(const e of h)P.current||(P.current=!0,D.current&&(clearTimeout(D.current),D.current=null),f("Writing...")),v((t=>t+e));b(!0),P.current?f(""):I||(f("Received empty response."),R(!0))}catch(e){console.error("Error processing stream:",e),b(!0),R(!0),!D.current&&P.current?f("Error processing stream."):P.current||D.current||f("Error starting stream.")}finally{D.current&&(clearTimeout(D.current),D.current=null)}})(),()=>{D.current&&(clearTimeout(D.current),D.current=null)})),[h]),(0,l.useEffect)((()=>{C&&u&&(u.dom.classList.remove("streaming-now"),u.dispatch({changes:{from:0,to:u.state.doc.length,insert:p}}))}),[C,u,p]),(0,l.useEffect)((()=>{var n;if(!C&&e&&u){const e=t.split("\n"),o=p.split("\n");if(o.length>1){let t="";t=o.length<e.length?[...o.slice(0,-1),e[o.length-1]+"​",...e.slice(o.length)].join("\n"):p.split("\n").slice(0,-1).join("\n"),u.dispatch({changes:{from:0,to:u.state.doc.length,insert:t}});const r=u.dom.querySelectorAll(".cm-changedLine");r.length>0&&(null===(n=r[r.length-1].previousElementSibling)||void 0===n||n.classList.add("hidden-diff"))}}}),[p,C,e,u,t]);const F=()=>{const t=null==u?void 0:u.dom;t&&t.remove(),e.editor.editor.dom.classList.remove("hidden-editor");const n=k.current;n&&n.remove()};return c().createElement("div",null,y&&!E&&c().createElement("div",{className:"status-container"},!C&&!I&&!E&&c().createElement("div",{className:"spinner-container"},c().createElement("div",{className:"spinner-border"}),c().createElement("button",{className:"cancel-button",onClick:()=>{_(!0),b(!0),f(""),g(null),r(),F()},title:"Cancel request"},c().createElement(T.stopIcon.react,null))),c().createElement("p",{className:"status-element"},y),I&&C&&!E&&c().createElement("button",{className:"jp-mod-styled jp-mod-reject",onClick:()=>{d()},title:"Retry Request"},"Try Again")),u&&C&&!E&&!I&&c().createElement(j,{buttonsRef:k,onAcceptAndRun:()=>{s(p),F()},onAccept:()=>{o(p),F()},onReject:()=>{r(),F()},onEditPrompt:()=>{a(p),F()}}))},R=e=>{const t=[];if("code"===e.model.type){const n=e.model.outputs;for(let e=0;e<n.length;e++){const o=n.get(e);if(o){const e=o.toJSON();switch(e.output_type){case"execute_result":{const n={output_type:"execute_result",data:e.data};t.push(n);break}case"stream":{const n={output_type:"stream",name:String(e.name||"stdout"),text:Array.isArray(e.text)?e.text.map(String):[String(e.text||"")]};t.push(n);break}case"display_data":{const n={output_type:"display_data",data:e.data};t.push(n);break}case"error":{const n={output_type:"error",ename:String(e.ename||"Error"),evalue:String(e.evalue||"Unknown error"),traceback:Array.isArray(e.traceback)?e.traceback.map(String):[]};t.push(n);break}}}}}return{cell_type:e.model.type,source:e.model.sharedModel.source,outputs:t}};var D=n(7594),P=n(5256);const F=({settingRegistry:e,onConnected:t,onCancel:n})=>{const[o,r]=(0,l.useState)(""),[a,s]=(0,l.useState)(null),[i,d]=(0,l.useState)(!1),u=(0,l.useCallback)((async n=>{n.preventDefault(),d(!0),s(null);try{if(!o.trim())throw new Error("Token cannot be empty.");await e.set("@jovyanai/labextension:plugin","authToken",o),console.debug("Auth token setting updated.");const n=await v();try{if(!n.isConnected)throw console.error("Connection attempt finished, but client is not connected."),new Error("Connection failed. Please verify your token and network.");console.debug("Connection successful."),t&&t()}catch(e){console.error("Failed to connect:",e);const t=e.message&&e.message.includes("Connection failed")?e.message:"Connection failed. Please check your token and network.";throw new Error(t)}}catch(e){console.error("Failed to save token or connect:",e),s(e.message||"An unexpected error occurred.")}finally{d(!1)}}),[o,e,t]);return c().createElement("div",{className:"jp-AuthReminder-container"},c().createElement("h4",null,"Please enter your authentication token to proceed:"),c().createElement("p",null,"Your token is available in your Jovyan AI account ",c().createElement("a",{href:"https://jovyan-ai.com/account"},"here"),"."),c().createElement("form",{onSubmit:u,className:"jp-AuthReminder-form"},c().createElement("input",{type:"password",value:o,onChange:e=>r(e.target.value),placeholder:"Enter your token",disabled:i,className:"jp-AuthReminder-input"}),c().createElement("button",{type:"submit",disabled:i||!o.trim(),className:"jp-AuthReminder-button jp-AuthReminder-button-submit"},i?"Connecting...":"Connect"),c().createElement("button",{type:"button",onClick:n,disabled:i,className:"jp-AuthReminder-button"},"Cancel")),a&&c().createElement("p",{className:"jp-AuthReminder-error"},"Error: ",a))};function M(e){return new Promise((t=>{if(!e)return console.error("SettingRegistry not provided to showAuthReminderDialog."),void t(!0);const n=document.createElement("div"),o=(0,a.H)(n);let r=null,l=null,s=!1;const i=e=>{if(!s){s=!0,console.debug(`Auth Dialog close requested. Cancelled: ${e}`);try{o.unmount()}catch(e){console.warn("Error unmounting React root during close:",e)}r&&!r.isDisposed&&(r.dispose(),r=null),l&&!l.isDisposed&&(l.dispose(),l=null),t(e)}},d=c().createElement(F,{settingRegistry:e,onConnected:()=>{console.debug("AuthReminder reported connected."),i(!1)},onCancel:()=>{console.debug("AuthReminder cancelled by component."),i(!0)}});o.render(d),l=new P.Widget({node:n}),r=new D.Dialog({title:"Jovyan AI Authentication",body:l,buttons:[]}),r.disposed.connect((()=>{r=null,l&&!l.isDisposed&&l.dispose(),l=null})),l&&l.disposed.connect((()=>{l=null})),r.launch().then((()=>{console.debug("Dialog launch() promise resolved (dialog closed)."),s||(console.debug("Dialog closed implicitly. Treating as Cancel."),i(!0)),r=null,l=null})).catch((e=>{s?console.debug("Dialog launch promise rejected, likely due to explicit closure:",e):(console.error("Error during dialog lifecycle:",e),console.debug("Treating dialog error as Cancel."),i(!0)),r=null,l=null}))}))}class L{constructor(e,t){this.addCellActivateButton=()=>{this.removeAllActivateButtons();let e="Generate";"code"===this._cell.model.type&&this._cell.model.sharedModel.source&&(e="Modify");const t=document.createElement("div"),n=(0,a.H)(t),o=this._cell.node,r=()=>{this.addPromptInput(),t.remove()},l=c().createElement(b,{onClick:r,text:e});n.render(l),o.appendChild(t),o.hasAttribute("jv-activate-listener")||(o.addEventListener("keydown",(e=>{"k"===e.key&&e.metaKey&&(e.preventDefault(),r())})),o.setAttribute("jv-activate-listener","true"))},this._cell=e,this._notebookController=t}removeAllActivateButtons(){const e=document.querySelector(".jv-cell-ai-button-container");e&&e.remove()}removeCellActivateButton(){const e=this._cell.node.querySelector(".jv-cell-ai-button-container");e&&e.remove()}activate(){this.removeAllActivateButtons(),this.addCellActivateButton(),this.addFixErrorButton()}_checkIsErrorCell(){if("code"!==this._cell.model.type)return!1;const e=this._cell.model;if(0===e.sharedModel.outputs.length)return!1;for(const t of e.sharedModel.outputs)if("error"===t.output_type)return!0;return!1}addFixErrorButton(){if("code"!==this._cell.model.type)return;const e=this._cell.node.querySelector(".jv-cell-fix-error-container");e&&e.remove();const t=this._cell.node,n=t.querySelector(".jp-Cell-outputArea");if(!n)return;if(!this._checkIsErrorCell())return;const o=document.createElement("div"),r=(0,a.H)(o),l=async()=>{if(this._checkIsErrorCell())try{const e=await this.createCodeStream("Fix the error in the current cell.");if(!e)return console.debug("Fix error cancelled due to auth."),void this.activate();this.addDiffReview(e,"Fix the error in the current cell."),o.remove()}catch(e){console.error("Error during fix error action:",e),this.activate()}},s=c().createElement(y,{onClick:l,text:"Fix Error"});r.render(s),n.appendChild(o),t.hasAttribute("jv-fix-error-listener")||(t.addEventListener("keydown",(e=>{"F"===e.key&&e.shiftKey&&(e.preventDefault(),l())})),t.setAttribute("jv-fix-error-listener","true"))}addPromptInput(){if(this._cell.node.querySelector(".jv-cell-ai-input-container"))return void console.debug("Input container already exists, skipping add.");console.debug("Creating input container for cell:",this._cell.id);const e=document.createElement("div");e.style.position="relative",e.style.marginTop="10px",e.tabIndex=-1,e.style.outline="none";const t=c().createElement(E,{isEnabled:!0,placeholderEnabled:"Ask Jovyan",placeholderDisabled:"Input disabled",onSubmit:async e=>{try{const t=await this.createCodeStream(e);if(!t)return console.debug("Code generation cancelled due to auth."),this.removePromptInput(),void this.activate();this.addDiffReview(t,e),this.removePromptInput()}catch(e){console.error("Error during prompt submission:",e),this.activate()}},onCancel:()=>{console.debug("Prompt cancelled"),e.remove(),this.addCellActivateButton()}});(0,a.H)(e).render(t),this._notebookController.addElementAfterCellInput(this._cell,e),setTimeout((()=>{try{e.focus()}catch(e){console.error("Error focusing inputContainer:",e)}try{e.scrollIntoView({behavior:"smooth",block:"nearest"})}catch(e){console.error("Error scrolling inputContainer:",e)}}),0)}removePromptInput(){const e=this._cell.node.querySelector(".jv-cell-ai-input-container");e&&e.remove()}async createCodeStream(e){if(await v(),!C()){if(console.debug("Jovyan client not connected. Prompting for auth."),await M(this._notebookController.settingRegistry))return console.debug("Auth dialog cancelled by user."),null;if(!C())return console.warn("Auth dialog closed but client still not connected."),null}try{const t=(async e=>{const t=await v();let n=!1;const o=[];return t.generateCodeStream({currentCell:R(e.currentCell),previousCells:e.previousCells.map(R),nextCells:e.nextCells.map(R),prompt:e.userInput,language:e.language,stream:!0},(e=>{o.push(e)})).then((()=>{n=!0})).catch((e=>{throw console.error("Error generating code stream:",e),e})),async function*(){for(;!n||o.length>0;)if(o.length>0){const e=o.shift();e&&(yield e)}else await new Promise((e=>setTimeout(e,50)))}()})({currentCell:this._cell,previousCells:this._notebookController.getPreviousCells(this._cell),nextCells:this._notebookController.getNextCells(this._cell),userInput:e,language:this._notebookController.getLanguage()});return t}catch(e){return console.error("Error during code stream setup:",e),this.activate(),null}}addDiffReview(e,t){const n=document.createElement("div"),o=this._cell.node.querySelector(".jv-diff-review-container");o&&o.remove(),n.className="jv-diff-review-container";const r=(0,a.H)(n),l=c().createElement(I,{activeCell:this._cell,oldCode:this._cell.model.sharedModel.source,generateCodeStream:e,prompt:t,retryHandler:async()=>{const e=this._cell.node.querySelector(".jv-diff-review-container");e&&e.remove();try{const e=await this.createCodeStream(t);e?this.addDiffReview(e,t):(console.debug("Retry cancelled or failed."),this.activate())}catch(e){console.error("Error during retry:",e),this.activate()}},acceptCodeHandler:e=>{this._notebookController.writeCodeInCell(this._cell,e),this.activate()},rejectCodeHandler:()=>{this.activate()},editPromptHandler:e=>{this._notebookController.writeCodeInCell(this._cell,e),this.addPromptInput()},acceptAndRunHandler:e=>{this._notebookController.writeCodeInCell(this._cell,e),this._notebookController.runCell(this._cell),this.activate(),this._notebookController.insertCell(this._notebookController.currentCellIndex+1)}});r.render(l),this._notebookController.addElementAfterCellInput(this._cell,n)}}class B{constructor(e,t,n){this._notebookTracker=e,this._commands=t,this._settingRegistry=n}get settingRegistry(){return this._settingRegistry}get activeCell(){var e;return null===(e=this._notebookTracker.currentWidget)||void 0===e?void 0:e.content.activeCell}addElementAfterCellInput(e,t){const n=e.node,o=n.querySelector(".jp-Cell-inputWrapper");o?o.insertAdjacentElement("afterend",t):n.appendChild(t)}addElementInCellChild(e,t){e.node.appendChild(t)}writeCodeInCell(e,t){e.model.sharedModel.setSource(t)}runCell(e){const t=this._notebookTracker.currentWidget;t&&(t.content.activeCellIndex=t.content.widgets.indexOf(e),this._commands.execute("notebook:run-cell"))}insertCell(e,t){var n;const o=this._notebookTracker.currentWidget;o&&(null===(n=o.model)||void 0===n||n.sharedModel.insertCell(e,{cell_type:"code",source:t}))}get currentCell(){var e;return null===(e=this._notebookTracker.currentWidget)||void 0===e?void 0:e.content.activeCell}get currentCellIndex(){var e;return(null===(e=this._notebookTracker.currentWidget)||void 0===e?void 0:e.content.activeCellIndex)||0}getPreviousCells(e){var t;const n=null===(t=this._notebookTracker.currentWidget)||void 0===t?void 0:t.content,o=null==n?void 0:n.activeCellIndex;return void 0!==o&&n?n.widgets.slice(0,o):[]}getNextCells(e){var t;const n=null===(t=this._notebookTracker.currentWidget)||void 0===t?void 0:t.content,o=this.currentCellIndex;return void 0!==o&&n?n.widgets.slice(o+1):[]}getLanguage(){var e;const t=null===(e=this._notebookTracker.currentWidget)||void 0===e?void 0:e.model;return(null==t?void 0:t.defaultKernelLanguage)||"python"}runCommand(e){this._commands.execute(e)}getCurrentNotebookCells(){var e;const t=null===(e=this._notebookTracker.currentWidget)||void 0===e?void 0:e.content;return t?t.widgets.map((e=>e)):[]}getCurrentNotebookFileName(){var e,t;const n=null===(t=null===(e=this._notebookTracker.currentWidget)||void 0===e?void 0:e.context.contentsModel)||void 0===t?void 0:t.path;if(n){const e=n.split("/");return e[e.length-1]}return""}getCurrentNotebookFilePath(){var e,t;return(null===(t=null===(e=this._notebookTracker.currentWidget)||void 0===e?void 0:e.context.contentsModel)||void 0===t?void 0:t.path)||""}getCellById(e){var t;const n=null===(t=this._notebookTracker.currentWidget)||void 0===t?void 0:t.content;return n?n.widgets.find((t=>t.model.id===e)):null}getNotebookByPath(e){let t=null;return this._notebookTracker.forEach((n=>{n.context.path===e&&(t=n)})),t}}var J=n(5072),$=n.n(J),q=n(7825),H=n.n(q),K=n(7659),W=n.n(K),z=n(5056),V=n.n(z),U=n(540),O=n.n(U),G=n(1113),Y=n.n(G),Q=n(9504),X={};X.styleTagTransform=Y(),X.setAttributes=V(),X.insert=W().bind(null,"head"),X.domAPI=H(),X.insertStyleElement=O(),$()(Q.A,X),Q.A&&Q.A.locals&&Q.A.locals;var Z=n(9334),ee={};ee.styleTagTransform=Y(),ee.setAttributes=V(),ee.insert=W().bind(null,"head"),ee.domAPI=H(),ee.insertStyleElement=O(),$()(Z.A,ee),Z.A&&Z.A.locals&&Z.A.locals;const te=(0,l.createContext)(void 0),ne=()=>{const e=(0,l.useContext)(te);if(void 0===e)throw new Error("useNotebookController must be used within a NotebookControllerProvider");return e},oe=({title:e,onNewChat:t,onLoadChat:n})=>{const o=ne(),[r,a]=(0,l.useState)(!1),[s,i]=(0,l.useState)([]),d=(0,l.useRef)(null);return(0,l.useEffect)((()=>{const e=e=>{d.current&&!d.current.contains(e.target)&&a(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[d]),c().createElement("div",{className:"chat-header"},c().createElement("h2",null,e),c().createElement("div",{className:"header-controls"},c().createElement("button",{className:"header-button add-button",onClick:t,title:"New Chat"},c().createElement("span",null,"+")),c().createElement("div",{className:"history-container",ref:d},c().createElement("button",{className:"header-button history-button",onClick:async()=>{if(r)a(!1);else try{if(!C())return console.debug("Client not connected, skipping getChats"),i([]),void a(!0);const e=await v(),t=(await e.getChats()).sort(((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())).slice(0,10);i(t),a(!0)}catch(e){console.error("Failed to fetch chat history:",e)}},title:"Chat History"},c().createElement("span",null,"↻")),r&&s.length>0&&c().createElement("div",{className:"history-dropdown"},c().createElement("ul",null,s.map((e=>c().createElement("li",{key:e.id,onClick:()=>{return t=e.id,n(t),void a(!1);var t}},c().createElement("span",{className:"chat-title"},e.title||"Untitled Chat"),c().createElement("span",{className:"chat-time"},function(e){const t=new Date(e),n=new Date,o=Math.round((n.getTime()-t.getTime())/1e3),r=Math.round(o/60),a=Math.round(r/60),l=Math.round(a/24),c=Math.round(l/7),s=Math.round(l/30),i=Math.round(l/365);return o<60?`${o}s ago`:r<60?`${r}m ago`:a<24?`${a}h ago`:l<7?`${l}d ago`:c<4?`${c}w ago`:s<12?`${s}mo ago`:`${i}y ago`}(e.created_at))))))),r&&0===s.length&&c().createElement("div",{className:"history-dropdown"},c().createElement("p",null,"No chat history found."))),c().createElement("button",{className:"header-button close-button",onClick:()=>{o.runCommand("jovyanai:toggle-chat")},title:"Close Chat"},c().createElement("span",null,"×"))))};var re=n(1449),ae={};ae.styleTagTransform=Y(),ae.setAttributes=V(),ae.insert=W().bind(null,"head"),ae.domAPI=H(),ae.insertStyleElement=O(),$()(re.A,ae),re.A&&re.A.locals&&re.A.locals;const le=({contextName:e,contextType:t,onRemove:n})=>{const o="notebook"===t||"current-notebook-context"===t?T.notebookIcon:T.codeIcon;return c().createElement("div",{className:`context-badge ${t}`},c().createElement("span",{className:"context-badge-prefix"},c().createElement(o.react,{tag:"span",className:"context-badge-icon"})),c().createElement("span",{className:"context-badge-name"},e),"current-notebook-context"!==t&&c().createElement("button",{className:"context-badge-remove",onClick:e=>{e.stopPropagation(),n()}},"×"))},ce=e=>{const t=[];if("code"===e.model.type){const n=e.model.outputs;for(let e=0;e<n.length;e++){const o=n.get(e);if(o){const e=o.toJSON();switch(e.output_type){case"execute_result":{const n={output_type:"execute_result",data:e.data};t.push(n);break}case"stream":{const n={output_type:"stream",name:String(e.name||"stdout"),text:Array.isArray(e.text)?e.text.map(String):[String(e.text||"")]};t.push(n);break}case"display_data":{const n={output_type:"display_data",data:e.data};t.push(n);break}case"error":{const n={output_type:"error",ename:String(e.ename||"Error"),evalue:String(e.evalue||"Unknown error"),traceback:Array.isArray(e.traceback)?e.traceback.map(String):[]};t.push(n);break}}}}}return{cell_type:e.model.type,source:e.model.sharedModel.source,outputs:t}};class se{constructor(e,t){this.type="notebook-cell",this.id=e,this.notebookId=t}getDisplayName(e){const t=e.getCellById(this.id);if(t){const n=e.getCurrentNotebookCells().indexOf(t);return`cell ${n>=0?n+1:"?".toString()}`}return"Unknown Cell"}getContextDataForApi(e){const t=e.getCellById(this.id);return t?ce(t):null}}class ie{constructor(e){this.type="notebook",this.id=e}getDisplayName(e){return this.id.split("/").pop()||this.id}getContextDataForApi(e){return e.getCurrentNotebookCells().map((e=>ce(e)))}}class de{constructor(e){this.notebookController=e}addContext(e,t){return e.some((e=>e.id===t.id))?e:[...e,t]}addCurrentCellContext(e){const t=this.notebookController.getCurrentNotebookFilePath(),n=this.notebookController.activeCell;if(n){const o=new se(n.model.id,t);if(!e.some((e=>e.id===o.id&&"notebook-cell"===e.type)))return console.debug("Controller adding current cell context",o.id),[...e,o];console.debug("Controller: Current cell context already exists",o.id)}else console.warn("Controller: No active cell found to add context for.");return e}addCurrentNotebookContext(e){const t=this.notebookController.getCurrentNotebookFilePath();if(t){const n=new ie(t);return this.addContext(e,n)}return e}removeContext(e,t){return e.filter((e=>e.id!==t.id))}hasCurrentCellInContext(e){var t;const n=null===(t=this.notebookController.activeCell)||void 0===t?void 0:t.model.id;return!!n&&e.some((e=>e.id===n&&"notebook-cell"===e.type))}getContextName(e){return this.notebookController?e.getDisplayName(this.notebookController):"Context"}getContextDataForApi(e,t){if(!this.notebookController)return console.error("NotebookController not available in ChatContextController logic"),{currentNotebook:[],selectedCells:[]};const n=new ie(this.notebookController.getCurrentNotebookFilePath());return{currentNotebook:t?n.getContextDataForApi(this.notebookController):[],selectedCells:e.filter((e=>"notebook-cell"===e.type)).map((e=>e.getContextDataForApi(this.notebookController))).filter((e=>null!==e))}}}const ue=(0,l.createContext)(void 0),me=({children:e})=>{const t=ne(),[n,o]=(0,l.useState)([]),[r,a]=(0,l.useState)(!0),[s,i]=(0,l.useState)(""),d=(0,l.useMemo)((()=>new de(t)),[t]);(0,l.useEffect)((()=>{if(t&&t._notebookTracker){const e=t._notebookTracker,n=async(e,t)=>{var n;let r="";if(t)try{await t.context.ready;const e=null===(n=t.context.contentsModel)||void 0===n?void 0:n.path;if(e){const t=e.split("/");r=t[t.length-1]}}catch(e){console.error("Error waiting for panel context or getting path:",e),r=""}else r="";r!==s&&(o((e=>e.filter((e=>"notebook-cell"!==e.type)))),i(r))},r=e.currentWidget;return r&&n(e,r),e.currentChanged.connect(n),()=>{if(null==t?void 0:t._notebookTracker)try{t._notebookTracker.currentChanged.disconnect(n)}catch(e){console.warn("Error disconnecting from tracker signal:",e)}}}console.debug("Notebook controller or tracker not found initially."),i("")}),[t]);const u=(0,l.useCallback)((()=>{o((e=>d.addCurrentNotebookContext(e)))}),[d]),m=(0,l.useCallback)((e=>{o((t=>d.addContext(t,e)))}),[d]),h=(0,l.useCallback)((()=>{o((e=>d.addCurrentCellContext(e)))}),[d]),g=(0,l.useCallback)((e=>{o((t=>d.removeContext(t,e)))}),[d]),p=(0,l.useCallback)((()=>d.hasCurrentCellInContext(n)),[d,n]),v=(0,l.useCallback)((e=>d.getContextName(e)),[d]),C=(0,l.useCallback)((()=>d.getContextDataForApi(n,r)),[d,n,r]),b=(0,l.useCallback)((e=>{a(e)}),[]);(0,l.useEffect)((()=>{const e=()=>{console.debug("Received jovyanai:addCurrentCellContext event, calling callback."),h()};return document.body.addEventListener("jovyanai:addCurrentCellContext",e),console.debug("ChatContextProvider mounted, listening for jovyanai:addCurrentCellContext event."),()=>{document.body.removeEventListener("jovyanai:addCurrentCellContext",e),console.debug("ChatContextProvider unmounted, removing listener for jovyanai:addCurrentCellContext event.")}}),[h]);const y=(0,l.useMemo)((()=>({activeContexts:n,currentNotebookInContext:r,currentNotebookFileName:s,addContext:m,addCurrentCellContext:h,hasCurrentCellInContext:p,removeContext:g,getContextName:v,getContextDataForApi:C,addCurrentNotebookContext:u,setCurrentNotebookInContext:b})),[n,r,s,m,h,p,g,v,C,u,b]);return c().createElement(ue.Provider,{value:y},e)},he=()=>{const e=(0,l.useContext)(ue);if(!e)throw new Error("useChatContext must be used within a ChatContextProvider");return e},ge=({disabled:e=!1})=>{const[t,n]=(0,l.useState)(!1),o=(0,l.useRef)(null),r=(0,l.useRef)(null),a=he();(0,l.useEffect)((()=>{const e=e=>{o.current&&!o.current.contains(e.target)&&r.current&&!r.current.contains(e.target)&&n(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]);const s=a.currentNotebookInContext,i=a.hasCurrentCellInContext();return c().createElement("div",{className:"context-badges"}," ",c().createElement("button",{type:"button",className:"add-context-button",onClick:e=>{e.stopPropagation(),n(!t)},ref:r,disabled:e},"@"),t&&c().createElement("div",{className:"context-menu",ref:o},c().createElement("div",{className:"context-menu-item "+(i?"disabled":""),onClick:i?void 0:()=>{try{a.addCurrentCellContext()}catch(e){console.error("Error creating cell context:",e)}n(!1)},style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},c().createElement("span",null,"This Cell"),i&&c().createElement("span",{style:{marginLeft:"10px"}},"✓"))),s&&c().createElement(le,{key:"current-notebook-context",contextName:a.currentNotebookFileName,contextType:"current-notebook-context",onRemove:()=>{}}),a.activeContexts.map((e=>{const t=`${e.type}-${a.getContextName(e)}`;return c().createElement(le,{key:t,contextName:a.getContextName(e),contextType:e.type,onRemove:()=>(e=>{a.removeContext(e)})(e)})})))};var pe=n(1837),ve={};ve.styleTagTransform=Y(),ve.setAttributes=V(),ve.insert=W().bind(null,"head"),ve.domAPI=H(),ve.insertStyleElement=O(),$()(pe.A,ve),pe.A&&pe.A.locals&&pe.A.locals;const Ce=({onSendMessage:e,onCancel:t,disabled:n=!1})=>{const[o,r]=(0,l.useState)(""),a=(0,l.useRef)(null),s=he(),i=ne(),d=async t=>{if(t.preventDefault(),!o.trim()||n)return;const l=await v();if(await l.connect(),!C()){if(console.debug("Chat submit: Jovyan client not connected. Prompting for auth."),await M(null==i?void 0:i.settingRegistry))return void console.debug("Chat submit: Auth dialog cancelled by user.");if(!C())return void console.warn("Chat submit: Auth dialog closed but client still not connected.")}const c={role:"user",content:o.trim(),contexts:s.activeContexts};await e(c),r(""),a.current&&(a.current.style.height="24px")};return c().createElement("div",{className:"chat-input-container"},c().createElement("form",{onSubmit:d,className:"chat-form"},c().createElement(ge,{disabled:n}),c().createElement("div",{className:"input-wrapper"},c().createElement("textarea",{ref:a,className:"chat-textarea",value:o,onChange:e=>{r(e.target.value);const t=e.target;t.style.height="24px";const n=Math.min(t.scrollHeight,200);t.style.height=`${n}px`},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),o.trim()&&!n&&d(e)),e.shiftKey&&(e.metaKey||e.ctrlKey)&&"Backspace"===e.key&&n&&(e.preventDefault(),t())},placeholder:"Ask, learn, brainstorm",disabled:n})),c().createElement("div",{className:"input-controls"},c().createElement("div",{className:"send-container"},c().createElement("span",{className:"model-name"},"gemini-2.5-pro"),n?c().createElement("button",{type:"button",className:"chat-input-cancel-button",onClick:t},"Cancel Run"):c().createElement("button",{type:"submit",className:"send-button",disabled:!o.trim()},"Send ",c().createElement("span",{className:"enter-icon"},"↵"))))))};var be=n(1812),ye=n(6839),fe={};fe.styleTagTransform=Y(),fe.setAttributes=V(),fe.insert=W().bind(null,"head"),fe.domAPI=H(),fe.insertStyleElement=O(),$()(ye.A,fe),ye.A&&ye.A.locals&&ye.A.locals;const ke=({code:e,language:t})=>{const[n,o]=(0,l.useState)(!1),r=(0,l.useRef)(null),a=(0,l.useRef)(),s=ne();return(0,l.useEffect)((()=>{if(r.current){a.current&&a.current.destroy();const n=[S.jupyterTheme,x.EditorView.editable.of(!1),w.EditorState.readOnly.of(!0),x.EditorView.lineWrapping];"python"===t&&n.push((0,N.Hg)());const o=w.EditorState.create({doc:e,extensions:n}),l=new x.EditorView({state:o,parent:r.current});return a.current=l,()=>{l.destroy(),a.current=void 0}}}),[e,t]),c().createElement("div",{className:"code-block"},c().createElement("div",{className:"code-header"},c().createElement("span",{className:"language-tag"},t),c().createElement("div",{className:"code-header-buttons"},c().createElement("button",{onClick:()=>{navigator.clipboard.writeText(e).then((()=>{o(!0),setTimeout((()=>o(!1)),2e3)}))},className:"code-action-button",title:"Copy code"},n?c().createElement(be.Check,{size:14}):c().createElement(be.Clipboard,{size:14})),c().createElement("button",{onClick:()=>{const t=s.currentCell;t&&s.writeCodeInCell(t,e)},className:"code-action-button",title:"Apply to active cell"},c().createElement(be.Play,{size:14})),c().createElement("button",{onClick:()=>{const t=s.currentCellIndex;s.insertCell(t+1,e)},className:"code-action-button",title:"Insert cell below"},c().createElement(be.Plus,{size:14})))),c().createElement("div",{className:"code-content",ref:r}))};var Ee=n(8201),xe={};xe.styleTagTransform=Y(),xe.setAttributes=V(),xe.insert=W().bind(null,"head"),xe.domAPI=H(),xe.insertStyleElement=O(),$()(Ee.A,xe),Ee.A&&Ee.A.locals&&Ee.A.locals;const we=({children:e})=>{const[t,n]=(0,l.useState)(!1),o=c().Children.toArray(e).join("");return c().createElement("code",{className:"inline-code-container"},c().createElement("span",{className:"inline-code-text"},e),c().createElement("button",{onClick:e=>{e.stopPropagation(),navigator.clipboard.writeText(o).then((()=>{n(!0),setTimeout((()=>n(!1)),1500)}))},className:"inline-code-copy-button",title:"Copy code"},t?c().createElement(be.Check,{size:12}):c().createElement(be.Clipboard,{size:12})))};var Ae=n(2192),Ne={};Ne.styleTagTransform=Y(),Ne.setAttributes=V(),Ne.insert=W().bind(null,"head"),Ne.domAPI=H(),Ne.insertStyleElement=O(),$()(Ae.A,Ne),Ae.A&&Ae.A.locals&&Ae.A.locals;var Se=n(6249),_e=n.n(Se),je=n(110),Te=n.n(je);const Ie=({message:e,isThinking:t})=>{const n=he();return t?c().createElement("div",{className:"message assistant thinking"},c().createElement("div",{className:"message-content"},c().createElement("div",{className:"thinking-indicator"},"Thinking",c().createElement("span",{className:"dot"},"."),c().createElement("span",{className:"dot"},"."),c().createElement("span",{className:"dot"},".")))):c().createElement("div",{className:`message ${e.role}`},"user"===e.role&&e.contexts&&e.contexts.length>0&&c().createElement("div",{className:"message-header"},e.contexts.map(((e,t)=>c().createElement("span",{key:t,className:`context-tag ${e.type}`},"@",n.getContextName(e))))),c().createElement("div",{className:"message-content"},(o=e.content,c().createElement(_e(),{remarkPlugins:[Te()],components:{code({node:e,className:t,children:n,...o}){const r=/language-(\w+)/.exec(t||"");if(r){const e=String(n).replace(/\n$/,""),t=r[1];return c().createElement(ke,{code:e,language:t})}return c().createElement(we,{...o},n)}}},o))));var o},Re=()=>{const[e,t]=(0,l.useState)([]),[n,o]=(0,l.useState)(null),[r,a]=(0,l.useState)(!1),[s,i]=(0,l.useState)(!1),d=(0,l.useRef)(null),u=he(),[m,h]=(0,l.useState)("");(0,l.useEffect)((()=>{(async()=>{const e=await(async()=>{if(!C())return console.debug("Client not connected, skipping getLastChat"),null;const e=await v(),t=await e.getChats();if(t.length>0){const n=t.sort(((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()))[0],o=await e.getMessages(n.id);if(o.length>0)return{chat:n,messages:o}}})();if(!e)return console.debug("No last chat found, skipping loadLatestChat"),void h("New Chat");if(console.debug("Get latest chat",e),e){o(e.chat.id);const n=e.messages.sort(((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime())).map((e=>({role:e.sender,content:e.content})));t(n),h(e.chat.title||e.messages[0].content.split(" ").slice(0,3).map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")),(await v()).setCurrentChatId(e.chat.id)}})(),g("off")}),[]);const g=e=>{var t;const n=null===(t=d.current)||void 0===t?void 0:t.parentElement;if(n)if("on"===e)n.style.paddingBottom="100vh";else{const e="80px";n.style.paddingBottom=e;const t=n.children[n.children.length-3];if(t&&t.clientHeight){const o=`calc(100vh - ${t.offsetTop}px - ${t.clientHeight}px - 100px)`;n.style.paddingBottom=`max(${e}, ${o})`,console.debug("Calculated paddingBottom:",n.style.paddingBottom)}else console.debug("Could not find last user message box or its height for padding calculation.")}};(0,l.useEffect)((()=>{e.length>0&&"user"===e[e.length-1].role?p():e.length>0&&!1===r&&(g("off"),requestAnimationFrame((()=>{var e;null===(e=d.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})))}),[e.length]);const p=()=>{requestAnimationFrame((()=>{if(d.current){const e=d.current.parentElement;if(console.debug("Scroll messages",e),!e)return;const t=d.current.previousElementSibling;if(console.debug("Scroll messages",t),!t)return void e.scrollTo({top:0,behavior:"smooth"});const n=t.offsetTop-100;console.debug("Scroll messages",n),e.scrollTo({top:n,behavior:"smooth"})}}))};return c().createElement("div",{className:"chat-container"},c().createElement(oe,{title:m,onNewChat:()=>{t([]),o(null),a(!1),i(!1),h("New Chat")},onLoadChat:async e=>{console.debug("Loading chat",e);const n=await v();n.setCurrentChatId(e);const r=(await n.getMessages(e)).sort(((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime())).map((e=>({role:e.sender,content:e.content})));t(r),o(e)}}),c().createElement("div",{className:"chat-content"},c().createElement("div",{className:"messages-container"},[...e.map((e=>({type:"message",data:e})))].map(((e,t)=>"message"===e.type?c().createElement(Ie,{key:t,message:e.data}):null)),s&&c().createElement(Ie,{message:{role:"assistant",content:""},isThinking:!0}),c().createElement("div",{ref:d}))),c().createElement(Ce,{onSendMessage:async e=>{a(!0),t((t=>[...t,e])),i(!0),a(!1),g("on");const r=await v();if(await r.connect(),!n){console.debug("Creating new chat");const t=e.content.split(" ").slice(0,3).map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "),n=await r.createChat(t);h(t),o(n.id),r.setCurrentChatId(n.id)}console.debug("Current chat ID",n);const l=u.getContextDataForApi();console.debug("Context data",l);let c="",s=!1;r.sendChatUserMessageStream(e.content,l,(e=>{if(s)c+=e,t((e=>{const t=[...e],n=t.findIndex((e=>"assistant"===e.role&&!0===e.isStreaming));return-1!==n&&(t[n].content=c),t}));else{i(!1),a(!0),s=!0;const n={role:"assistant",content:e,isStreaming:!0};t((e=>[...e,n])),c=e}})).then((async()=>{t((e=>e.map((e=>"assistant"===e.role&&!0===e.isStreaming?{...e,content:c,isStreaming:!1}:e)))),a(!1)})).catch((e=>{console.error("Error streaming chat message:",e),i(!1),a(!1),t((e=>e.filter((e=>!("assistant"===e.role&&!0===e.isStreaming)))))})).finally((()=>{i(!1),a(!1),g("off")}))},onCancel:async()=>{console.debug("Cancel requested"),a(!1),i(!1),t((e=>e.filter((e=>!("assistant"===e.role&&!0===e.isStreaming)))))},disabled:r||s}))};var De=n(5872),Pe={};Pe.styleTagTransform=Y(),Pe.setAttributes=V(),Pe.insert=W().bind(null,"head"),Pe.domAPI=H(),Pe.insertStyleElement=O(),$()(De.A,Pe),De.A&&De.A.locals&&De.A.locals;const Fe={id:"@jovyanai/labextension:plugin",description:"A JupyterLab extension to integrate Jovyan AI",autoStart:!0,requires:[o.INotebookTracker],optional:[r.ISettingRegistry],activate:async(e,t,n)=>{if(console.debug("JupyterLab extension @jovyanai/labextension is activated! Hello!"),n&&(await p(n),n.load("@jovyanai/labextension:plugin").then((e=>{e.changed.connect((async()=>{await p(n)}))})).catch((e=>{console.error("Failed to load settings for @jovyanai/labextension:",e)}))),n){const r=new B(t,e.commands,n);t.activeCellChanged.connect(((e,t)=>{t&&new L(t,r).activate()})),o.NotebookActions.executed.connect(((e,t)=>{const n=t.cell;console.debug("Cell executed",n),n&&new L(n,r).addFixErrorButton()})),function(e){const{app:t,notebookController:n}=e,o=document.createElement("div");o.id="jupyterlab-chat-extension-root",o.className="jupyterlab-chat-extension";const r=new P.Widget({node:o});r.id="jupyterlab-chat-assistant-widget";const l=new T.LabIcon({name:"jovyan::chat",svgstr:'<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000"\n preserveAspectRatio="xMidYMid meet">\n\n<g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"\nfill="#000000" stroke="none">\n<path d="M0 2560 l0 -2560 2560 0 2560 0 0 2560 0 2560 -2560 0 -2560 0 0\n-2560z m3595 1212 c47 -24 96 -73 120 -122 26 -50 29 -173 5 -226 -68 -157\n-287 -205 -416 -91 -107 93 -123 250 -39 362 74 96 225 131 330 77z m-516\n-149 c-10 -38 -19 -68 -19 -69 0 -1 -46 -4 -102 -7 -314 -19 -725 -201 -1033\n-459 -440 -367 -641 -812 -493 -1091 84 -156 259 -225 543 -214 190 8 372 48\n537 119 40 17 49 26 58 57 29 102 34 189 35 546 0 336 -2 373 -18 402 -20 38\n-70 66 -149 83 l-58 13 0 92 0 92 38 7 c20 3 163 6 318 6 209 0 285 -3 297\n-13 16 -11 17 -48 15 -490 -2 -262 1 -477 5 -477 5 0 82 73 171 163 172 172\n247 271 312 412 50 108 78 224 72 300 l-5 61 58 32 58 32 10 -37 c45 -161 -38\n-428 -206 -663 -81 -112 -259 -295 -399 -409 l-101 -82 -7 -53 c-16 -143 -96\n-342 -181 -454 -91 -120 -232 -210 -400 -252 -77 -20 -305 -41 -375 -35 -19 2\n-50 4 -67 4 l-33 1 0 119 0 120 48 5 c189 22 278 56 367 138 55 52 106 118 89\n118 -4 0 -48 -13 -98 -29 -146 -46 -271 -64 -446 -64 -178 0 -263 18 -389 79\n-175 86 -281 265 -281 475 0 260 162 572 439 849 378 377 911 631 1338 639\nl72 1 -20 -67z"/>\n</g>\n</svg>\n'});r.title.icon=l,r.title.caption="Jovyan AI Chat Assistant",r.title.closable=!0,r.title.className="jp-mod-opacity-50",new D.WidgetTracker({namespace:"jupyterlab-chat-extension"}).add(r),t.shell.add(r,"right",{activate:!1}),(0,a.H)(o).render(c().createElement(te.Provider,{value:n},c().createElement(me,{children:c().createElement(Re)}))),t.commands.addCommand("jovyanai:toggle-chat",{label:"Toggle Chat Assistant",execute:()=>{const e=t.shell,n=Array.from(e.widgets("right")).find((e=>"jupyterlab-chat-assistant-widget"===e.id)),o=(null==n?void 0:n.isVisible)||!1,a=r.node.querySelector("#chat-input");return o?e.collapseRight():(e.activateById(r.id),requestAnimationFrame((()=>{a?a.focus():console.warn("Chat input element (#chat-input) not found for focusing after activation.")}))),null}}),t.commands.addKeyBinding({command:"jovyanai:toggle-chat",keys:["Alt B"],selector:"body"}),t.commands.addCommand("jovyanai:addCurrentCellContext",{label:"Add Current Cell to Chat Context",execute:()=>{const e=n.currentCell;if(e){r.isVisible||(console.debug("Chat panel not visible. Activating chat panel."),t.shell.activateById(r.id)),console.debug("Dispatching jovyanai:addCurrentCellContext event for cell:",e.model.id);const n=new CustomEvent("jovyanai:addCurrentCellContext");document.body.dispatchEvent(n)}else console.warn("No active cell found to add to context.");return null}}),t.commands.addKeyBinding({command:"jovyanai:addCurrentCellContext",keys:["Alt L"],selector:"body"})}({app:e,notebookController:r})}else console.warn("ISettingRegistry not found, Jovyan AI features disabled.")}},Me=Fe}}]);